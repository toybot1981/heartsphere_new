package com.heartsphere.memory.repository;

import com.heartsphere.memory.model.MemoryType;
import com.heartsphere.memory.model.character.CharacterSelfMemory;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.mongodb.repository.MongoRepository;
import org.springframework.data.mongodb.repository.Query;
import org.springframework.stereotype.Repository;

import java.util.List;

/**
 * 角色自身记忆Repository
 * 
 * @author HeartSphere
 * @date 2025-12-29
 */
@Repository
public interface CharacterSelfMemoryRepository extends MongoRepository<CharacterSelfMemory, String> {
    
    /**
     * 根据角色ID查找
     */
    List<CharacterSelfMemory> findByCharacterId(String characterId);
    
    /**
     * 根据角色ID和类型查找
     */
    List<CharacterSelfMemory> findByCharacterIdAndType(String characterId, MemoryType type);
    
    /**
     * 根据角色ID分页查找
     */
    Page<CharacterSelfMemory> findByCharacterId(String characterId, Pageable pageable);
    
    /**
     * 根据角色ID和类型分页查找
     */
    Page<CharacterSelfMemory> findByCharacterIdAndType(String characterId, MemoryType type, Pageable pageable);
    
    /**
     * 文本搜索
     */
    @Query("{ 'characterId': ?0, '$text': { '$search': ?1 } }")
    List<CharacterSelfMemory> searchByCharacterIdAndText(String characterId, String query, Pageable pageable);
}



