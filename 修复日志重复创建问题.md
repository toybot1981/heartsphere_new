# 修复日志重复创建问题

## 问题描述
在网站打开的情况下，会出现不断创建同一个日志的情况。

## 根本原因
1. **缺少重复检测**: 在创建日志前没有检查服务器上是否已存在相同的日志
2. **状态更新不及时**: 同步成功后，本地状态没有及时更新，导致自动同步重复处理
3. **多个同步路径**: `handleLocalDataChange` 和 `useJournalHandlers` 都可能触发同步，造成重复
4. **自动同步重复处理**: 自动同步服务会定期同步所有待同步的实体，如果状态没有正确更新，会重复创建

## 修复方案

### 1. 在 `syncEntity` 中添加重复检测 ✅
- 对于日志类型，在创建前先检查服务器上是否已存在相同的日志
- 检查条件：标题、内容相同，时间戳在1分钟内
- 如果找到重复，使用服务器上的日志，而不是创建新的

### 2. 在 `handleLocalDataChange` 中添加状态检查 ✅
- 检查实体是否已经同步过（syncStatus === 1）
- 如果已同步，直接返回，不重复同步

### 3. 在 `syncAllPendingEntities` 中添加重复检测 ✅
- 对于日志类型，检查是否有其他相同内容的待同步日志
- 如果发现重复，跳过其中一个

### 4. 统一使用 `syncService.syncEntity` ✅
- 修改 `useJournalHandlers` 使用 `syncService.syncEntity` 而不是直接调用 API
- 这样可以利用统一的重复检测和状态管理

## 修改的文件

1. **frontend/services/sync/SyncService.ts**
   - `syncEntity`: 添加日志重复检测逻辑
   - `handleLocalDataChange`: 添加状态检查
   - `syncAllPendingEntities`: 添加重复检测

2. **frontend/hooks/useJournalHandlers.ts**
   - `handleAddJournalEntry`: 使用 `syncService.syncEntity` 而不是直接调用 API

## 验证

请检查以下内容：
- [ ] 创建日志后，不会重复创建
- [ ] 自动同步不会重复创建已存在的日志
- [ ] 刷新页面后，不会重复创建日志
- [ ] 控制台日志显示正确的重复检测信息

## 测试场景

1. **场景1**: 创建新日志
   - 预期：只创建一次，不会重复

2. **场景2**: 创建日志后立即刷新页面
   - 预期：不会重复创建

3. **场景3**: 创建日志后等待自动同步
   - 预期：自动同步不会重复创建

4. **场景4**: 快速连续创建多个相同内容的日志
   - 预期：只创建第一个，其他被检测为重复
