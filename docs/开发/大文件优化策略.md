# å®¢æˆ·ç«¯å¤§æ–‡ä»¶ä¼˜åŒ–ç­–ç•¥

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ç”Ÿæˆæ—¥æœŸ**: 2025-01-22  
**ç›®æ ‡**: ä¼˜åŒ–è¶…è¿‡1000è¡Œçš„æ–‡ä»¶ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½

---

## ğŸ“Š å¤§æ–‡ä»¶ç»Ÿè®¡

| æ–‡ä»¶ | è¡Œæ•° | ç±»å‹ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| `admin/AdminScreen.tsx` | 3158 | ç»„ä»¶ | P0 |
| `services/api.ts` | 2299 | æœåŠ¡ | P0 |
| `services/gemini.ts` | 1490 | æœåŠ¡ | P1 |
| `components/InitializationWizard.tsx` | 1223 | ç»„ä»¶ | P1 |
| `mobile/MobileApp.tsx` | 1215 | ç»„ä»¶ | P1 |
| `App.tsx` | 1114 | ç»„ä»¶ | P1 |

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

1. **å¯ç»´æŠ¤æ€§**: å°†å¤§æ–‡ä»¶æ‹†åˆ†ä¸ºæ›´å°ã€æ›´ä¸“æ³¨çš„æ¨¡å—
2. **å¯è¯»æ€§**: æé«˜ä»£ç å¯è¯»æ€§å’Œç†è§£æ€§
3. **å¯æµ‹è¯•æ€§**: ä¾¿äºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
4. **æ€§èƒ½**: å‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“å’Œå†…å­˜å ç”¨
5. **ä»£ç å¤ç”¨**: æå–å…¬å…±é€»è¾‘ï¼Œå‡å°‘é‡å¤ä»£ç 

---

## ğŸ“‹ è¯¦ç»†ä¼˜åŒ–ç­–ç•¥

### 1. admin/AdminScreen.tsx (3158è¡Œ) - P0

#### å½“å‰é—®é¢˜
- æ–‡ä»¶è¿‡å¤§ï¼ŒåŒ…å«æ‰€æœ‰ç®¡ç†åå°åŠŸèƒ½
- çŠ¶æ€ç®¡ç†å¤æ‚ï¼Œå¤§é‡ useState
- å¤šä¸ªåŠŸèƒ½æ¨¡å—æ··åœ¨ä¸€èµ·
- éš¾ä»¥æµ‹è¯•å’Œç»´æŠ¤

#### ä¼˜åŒ–ç­–ç•¥

**1.1 æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†ç»„ä»¶**

```
admin/
â”œâ”€â”€ AdminScreen.tsx (ä¸»ç»„ä»¶ï¼Œ< 300è¡Œ)
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ AdminLogin.tsx âœ… (å·²å­˜åœ¨)
â”‚   â”œâ”€â”€ AdminSidebar.tsx âœ… (å·²å­˜åœ¨)
â”‚   â”œâ”€â”€ DashboardView.tsx âœ… (å·²å­˜åœ¨)
â”‚   â”œâ”€â”€ ErasManagement.tsx âœ… (å·²å­˜åœ¨)
â”‚   â”œâ”€â”€ MainStoriesManagement.tsx âœ… (å·²å­˜åœ¨)
â”‚   â”œâ”€â”€ UsersManagement.tsx âœ… (å·²å­˜åœ¨)
â”‚   â”œâ”€â”€ CharactersManagement.tsx (æ–°å»º)
â”‚   â”œâ”€â”€ ScenariosManagement.tsx (æ–°å»º)
â”‚   â”œâ”€â”€ InviteCodesManagement.tsx (æ–°å»º)
â”‚   â”œâ”€â”€ SettingsManagement.tsx (æ–°å»º)
â”‚   â”œâ”€â”€ ResourcesManagement.tsx (æ–°å»º)
â”‚   â”œâ”€â”€ SubscriptionPlansManagement.tsx (æ–°å»º)
â”‚   â”œâ”€â”€ EmailConfigManagement.tsx (æ–°å»º)
â”‚   â””â”€â”€ NotionConfigManagement.tsx (æ–°å»º)
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useAdminAuth.ts (è®¤è¯é€»è¾‘)
â”‚   â”œâ”€â”€ useAdminData.ts (æ•°æ®åŠ è½½)
â”‚   â”œâ”€â”€ useAdminCRUD.ts (CRUDæ“ä½œ)
â”‚   â”œâ”€â”€ useImageUpload.ts (å›¾ç‰‡ä¸Šä¼ )
â”‚   â””â”€â”€ useAdminSettings.ts (è®¾ç½®ç®¡ç†)
â””â”€â”€ utils/
    â”œâ”€â”€ adminFormHelpers.ts (è¡¨å•è¾…åŠ©å‡½æ•°)
    â””â”€â”€ adminDataTransformers.ts (æ•°æ®è½¬æ¢)
```

**1.2 æå–è‡ªå®šä¹‰ Hooks**

```typescript
// hooks/useAdminAuth.ts
export const useAdminAuth = () => {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [adminToken, setAdminToken] = useState<string | null>(null);
  // ... è®¤è¯é€»è¾‘
  return { isAuthenticated, adminToken, login, logout };
};

// hooks/useAdminCRUD.ts
export const useAdminCRUD = (resource: string, token: string) => {
  const [items, setItems] = useState<any[]>([]);
  const [loading, setLoading] = useState(false);
  // ... CRUDé€»è¾‘
  return { items, loading, create, update, delete: deleteItem, refresh };
};

// hooks/useImageUpload.ts
export const useImageUpload = () => {
  const [isUploading, setIsUploading] = useState(false);
  const [uploadError, setUploadError] = useState('');
  // ... ä¸Šä¼ é€»è¾‘
  return { isUploading, uploadError, uploadImage };
};
```

**1.3 æ‹†åˆ†çŠ¶æ€ç®¡ç†**

```typescript
// ä½¿ç”¨ Context æˆ–çŠ¶æ€ç®¡ç†åº“
// contexts/AdminStateContext.tsx
export const AdminStateProvider = ({ children }) => {
  const [activeSection, setActiveSection] = useState('dashboard');
  const [viewMode, setViewMode] = useState<'list' | 'edit' | 'create'>('list');
  // ... å…¶ä»–çŠ¶æ€
  return (
    <AdminStateContext.Provider value={{ ... }}>
      {children}
    </AdminStateContext.Provider>
  );
};
```

**1.4 ä¼˜åŒ–åçš„ä¸»ç»„ä»¶ç»“æ„**

```typescript
// AdminScreen.tsx (ç®€åŒ–å)
export const AdminScreen: React.FC<AdminScreenProps> = (props) => {
  const { isAuthenticated, adminToken, login } = useAdminAuth();
  const { activeSection, setActiveSection } = useAdminNavigation();
  
  if (!isAuthenticated) {
    return <AdminLogin onLogin={login} />;
  }
  
  return (
    <AdminStateProvider>
      <div className="admin-container">
        <AdminSidebar activeSection={activeSection} onSelect={setActiveSection} />
        <main className="admin-content">
          {activeSection === 'dashboard' && <DashboardView />}
          {activeSection === 'eras' && <ErasManagement />}
          {activeSection === 'characters' && <CharactersManagement />}
          {/* ... å…¶ä»–æ¨¡å— */}
        </main>
      </div>
    </AdminStateProvider>
  );
};
```

**é¢„æœŸæ•ˆæœ**:
- ä¸»æ–‡ä»¶å‡å°‘åˆ° < 300è¡Œ
- æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºç»´æŠ¤
- æé«˜ä»£ç å¤ç”¨æ€§
- ä¾¿äºå•å…ƒæµ‹è¯•

---

### 2. services/api.ts (2299è¡Œ) - P0

#### å½“å‰é—®é¢˜
- åŒ…å«æ‰€æœ‰APIå®šä¹‰
- å·²ç»éƒ¨åˆ†æ¨¡å—åŒ–ï¼ˆapi/ç›®å½•ï¼‰ï¼Œä½†ä¸»æ–‡ä»¶ä»åŒ…å«å¤§é‡ä»£ç 
- éœ€è¦å®Œå…¨è¿ç§»åˆ°æ¨¡å—åŒ–ç»“æ„

#### ä¼˜åŒ–ç­–ç•¥

**2.1 ç»§ç»­æ¨¡å—åŒ–è¿ç§»**

å½“å‰å·²è¿ç§»çš„æ¨¡å—ï¼š
- âœ… `api/scene` (eraApi)
- âœ… `api/character` (characterApi)
- âœ… `api/script` (scriptApi, presetScriptApi, systemScriptApi)
- âœ… `api/mainStory` (userMainStoryApi, presetMainStoryApi, systemMainStoryApi)

**éœ€è¦è¿ç§»çš„æ¨¡å—**:

```
services/
â”œâ”€â”€ api.ts (ä¸»å…¥å£ï¼Œåªåšå¯¼å‡ºï¼Œ< 100è¡Œ)
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ index.ts (ç»Ÿä¸€å¯¼å‡º)
â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”œâ”€â”€ request.ts âœ… (å·²å­˜åœ¨)
â”‚   â”‚   â”œâ”€â”€ tokenStorage.ts âœ… (å·²å­˜åœ¨)
â”‚   â”‚   â””â”€â”€ crudFactory.ts âœ… (å·²å­˜åœ¨)
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ admin.ts (adminApi)
â”‚   â”‚   â”œâ”€â”€ users.ts (usersç®¡ç†)
â”‚   â”‚   â”œâ”€â”€ config.ts (é…ç½®ç®¡ç†)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ auth.ts (authApi)
â”‚   â”‚   â”œâ”€â”€ wechat.ts (wechatApi)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”œâ”€â”€ profile.ts (userProfileApi)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ world/
â”‚   â”‚   â”œâ”€â”€ world.ts (worldApi)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ journal/
â”‚   â”‚   â”œâ”€â”€ journal.ts (journalApi)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ membership/
â”‚   â”‚   â”œâ”€â”€ membership.ts (membershipApi)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ resource/
â”‚   â”‚   â”œâ”€â”€ resource.ts (resourceApi)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ notes/
â”‚   â”‚   â”œâ”€â”€ notion.ts (noteSyncApi)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ payment/
â”‚   â”‚   â”œâ”€â”€ payment.ts (paymentApi)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â””â”€â”€ image/
â”‚       â”œâ”€â”€ image.ts (imageApi)
â”‚       â””â”€â”€ types.ts
â””â”€â”€ recycleBin/
    â”œâ”€â”€ recycleBin.ts (recycleBinApi)
    â””â”€â”€ types.ts
```

**2.2 è¿ç§»ç¤ºä¾‹**

```typescript
// services/api/admin/admin.ts
export const adminApi = {
  login: (username: string, password: string) => {
    return request<AdminLoginResponse>('/admin/auth/login', {
      method: 'POST',
      body: JSON.stringify({ username, password }),
      headers: { 'Content-Type': 'application/json' },
    });
  },
  // ... å…¶ä»–æ–¹æ³•
};

// services/api/admin/users.ts
export const adminUsersApi = {
  getAll: (token: string, page: number = 0, size: number = 20, search?: string) => {
    // ... å®ç°
  },
  // ... å…¶ä»–æ–¹æ³•
};

// services/api/index.ts (ç»Ÿä¸€å¯¼å‡º)
export { adminApi } from './admin/admin';
export { adminUsersApi } from './admin/users';
export { authApi } from './auth/auth';
export { wechatApi } from './auth/wechat';
// ... å…¶ä»–å¯¼å‡º

// services/api.ts (ä¸»å…¥å£ï¼Œç®€åŒ–)
export * from './api';
export { tokenStorage } from './api/base/tokenStorage';
```

**é¢„æœŸæ•ˆæœ**:
- ä¸»æ–‡ä»¶å‡å°‘åˆ° < 100è¡Œ
- æ¯ä¸ªAPIæ¨¡å—ç‹¬ç«‹ï¼ŒèŒè´£æ¸…æ™°
- ä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- æé«˜ä»£ç å¯æµ‹è¯•æ€§

---

### 3. services/gemini.ts (1490è¡Œ) - P1

#### å½“å‰é—®é¢˜
- å•ä¸ªå¤§ç±»åŒ…å«æ‰€æœ‰AIæœåŠ¡é€»è¾‘
- å¤šæ¨¡å‹æ”¯æŒæ··åœ¨ä¸€èµ·
- æ–¹æ³•è¿‡å¤šï¼ŒèŒè´£ä¸æ¸…

#### ä¼˜åŒ–ç­–ç•¥

**3.1 æŒ‰åŠŸèƒ½æ‹†åˆ†æœåŠ¡ç±»**

```
services/
â”œâ”€â”€ gemini.ts (ä¸»å…¥å£ï¼Œ< 100è¡Œ)
â”œâ”€â”€ ai/
â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”œâ”€â”€ AIServiceBase.ts (åŸºç¡€æœåŠ¡ç±»)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ GeminiProvider.ts (Geminiå®ç°)
â”‚   â”‚   â”œâ”€â”€ OpenAIProvider.ts (OpenAIå®ç°)
â”‚   â”‚   â”œâ”€â”€ QwenProvider.ts (Qwenå®ç°)
â”‚   â”‚   â”œâ”€â”€ DoubaoProvider.ts (Doubaoå®ç°)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ GeminiService.ts (ä¸»æœåŠ¡ç±»)
â”‚   â”œâ”€â”€ fallback/
â”‚   â”‚   â”œâ”€â”€ MultiModelFallback.ts (å¤šæ¨¡å‹äº’å¤‡)
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ promptBuilders.ts (æç¤ºè¯æ„å»º)
â”‚       â”œâ”€â”€ historyFormatters.ts (å†å²æ ¼å¼åŒ–)
â”‚       â””â”€â”€ responseParsers.ts (å“åº”è§£æ)
```

**3.2 æå–åŸºç¡€æœåŠ¡ç±»**

```typescript
// services/ai/base/AIServiceBase.ts
export abstract class AIServiceBase {
  abstract sendMessage(character: Character, message: string): Promise<string>;
  abstract sendMessageStream(character: Character, message: string): AsyncGenerator<string>;
  abstract generateDailyGreeting(entries: JournalEntry[]): Promise<string>;
  // ... å…¶ä»–æŠ½è±¡æ–¹æ³•
}

// services/ai/providers/GeminiProvider.ts
export class GeminiProvider extends AIServiceBase {
  // Geminiç‰¹å®šå®ç°
}

// services/ai/GeminiService.ts
export class GeminiService {
  private providers: Map<string, AIServiceBase> = new Map();
  private fallback: MultiModelFallback;
  
  constructor() {
    this.providers.set('gemini', new GeminiProvider());
    this.providers.set('openai', new OpenAIProvider());
    // ... å…¶ä»–provider
    this.fallback = new MultiModelFallback(this.providers);
  }
  
  async sendMessageStream(character: Character, message: string) {
    return this.fallback.sendMessageStream(character, message);
  }
}
```

**é¢„æœŸæ•ˆæœ**:
- ä¸»æ–‡ä»¶å‡å°‘åˆ° < 200è¡Œ
- æ¯ä¸ªproviderç‹¬ç«‹ï¼Œæ˜“äºæ‰©å±•
- å¤šæ¨¡å‹äº’å¤‡é€»è¾‘æ¸…æ™°
- ä¾¿äºå•å…ƒæµ‹è¯•

---

### 4. components/InitializationWizard.tsx (1223è¡Œ) - P1

#### å½“å‰é—®é¢˜
- åŒ…å«å®Œæ•´çš„åˆå§‹åŒ–æµç¨‹
- å¤šä¸ªæ­¥éª¤æ··åœ¨ä¸€èµ·
- çŠ¶æ€ç®¡ç†å¤æ‚

#### ä¼˜åŒ–ç­–ç•¥

**4.1 æŒ‰æ­¥éª¤æ‹†åˆ†ç»„ä»¶**

```
components/
â”œâ”€â”€ InitializationWizard.tsx (ä¸»ç»„ä»¶ï¼Œ< 200è¡Œ)
â””â”€â”€ initialization/
    â”œâ”€â”€ Step1SceneSelection.tsx (åœºæ™¯é€‰æ‹©)
    â”œâ”€â”€ Step2CharacterSelection.tsx (è§’è‰²é€‰æ‹©)
    â”œâ”€â”€ Step3ProfileSetup.tsx (èµ„æ–™è®¾ç½®)
    â”œâ”€â”€ WizardNavigation.tsx (å¯¼èˆªç»„ä»¶)
    â””â”€â”€ hooks/
        â”œâ”€â”€ useWizardState.ts (å‘å¯¼çŠ¶æ€)
        â”œâ”€â”€ useSceneSelection.ts (åœºæ™¯é€‰æ‹©é€»è¾‘)
        â””â”€â”€ useCharacterSelection.ts (è§’è‰²é€‰æ‹©é€»è¾‘)
```

**4.2 ä½¿ç”¨æ­¥éª¤ç»„ä»¶**

```typescript
// InitializationWizard.tsx
const STEPS = [
  { id: 'scenes', component: Step1SceneSelection },
  { id: 'characters', component: Step2CharacterSelection },
  { id: 'profile', component: Step3ProfileSetup },
];

export const InitializationWizard: React.FC<Props> = (props) => {
  const { currentStep, nextStep, prevStep, stepData } = useWizardState();
  const CurrentStepComponent = STEPS[currentStep].component;
  
  return (
    <div className="wizard">
      <WizardNavigation currentStep={currentStep} totalSteps={STEPS.length} />
      <CurrentStepComponent
        data={stepData[currentStep]}
        onNext={nextStep}
        onPrev={prevStep}
        onUpdate={(data) => updateStepData(currentStep, data)}
      />
    </div>
  );
};
```

**é¢„æœŸæ•ˆæœ**:
- ä¸»æ–‡ä»¶å‡å°‘åˆ° < 200è¡Œ
- æ¯ä¸ªæ­¥éª¤ç‹¬ç«‹ï¼Œæ˜“äºç»´æŠ¤
- çŠ¶æ€ç®¡ç†æ¸…æ™°
- ä¾¿äºæµ‹è¯•æ¯ä¸ªæ­¥éª¤

---

### 5. mobile/MobileApp.tsx (1215è¡Œ) - P1

#### å½“å‰é—®é¢˜
- ç§»åŠ¨ç«¯æ‰€æœ‰åŠŸèƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶
- ä¸PCç«¯App.tsxæœ‰å¤§é‡é‡å¤ä»£ç 
- çŠ¶æ€ç®¡ç†å¤æ‚

#### ä¼˜åŒ–ç­–ç•¥

**5.1 æå–å…¬å…±é€»è¾‘**

```
mobile/
â”œâ”€â”€ MobileApp.tsx (ä¸»ç»„ä»¶ï¼Œ< 300è¡Œ)
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useMobileState.ts (ç§»åŠ¨ç«¯çŠ¶æ€)
â”‚   â”œâ”€â”€ useMobileNavigation.ts (å¯¼èˆªé€»è¾‘)
â”‚   â””â”€â”€ useMobileData.ts (æ•°æ®åŠ è½½)
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ MobileRealWorld.tsx âœ… (å·²å­˜åœ¨)
â”‚   â”œâ”€â”€ MobileSceneSelection.tsx âœ… (å·²å­˜åœ¨)
â”‚   â”œâ”€â”€ MobileCharacterSelection.tsx âœ… (å·²å­˜åœ¨)
â”‚   â””â”€â”€ MobileScenarioBuilder.tsx âœ… (å·²å­˜åœ¨)
â””â”€â”€ components/
    â””â”€â”€ MobileBottomNav.tsx âœ… (å·²å­˜åœ¨)
```

**5.2 ä¸PCç«¯å…±äº«é€»è¾‘**

```typescript
// æå–åˆ° shared/hooks/
// hooks/useAppState.ts (PCå’Œç§»åŠ¨ç«¯å…±äº«)
export const useAppState = () => {
  // å…±äº«çš„çŠ¶æ€ç®¡ç†é€»è¾‘
};

// mobile/MobileApp.tsx
export const MobileApp: React.FC<Props> = (props) => {
  const { gameState, dispatch } = useGameState(); // å…±äº«Context
  const { currentScreen, navigateTo } = useMobileNavigation();
  
  return (
    <div className="mobile-app">
      {currentScreen === 'realWorld' && <MobileRealWorld />}
      {currentScreen === 'scenes' && <MobileSceneSelection />}
      {/* ... å…¶ä»–å±å¹• */}
      <MobileBottomNav currentScreen={currentScreen} onNavigate={navigateTo} />
    </div>
  );
};
```

**é¢„æœŸæ•ˆæœ**:
- ä¸»æ–‡ä»¶å‡å°‘åˆ° < 300è¡Œ
- ä¸PCç«¯å…±äº«æ›´å¤šä»£ç 
- å‡å°‘é‡å¤é€»è¾‘
- æé«˜ä¸€è‡´æ€§

---

### 6. App.tsx (1114è¡Œ) - P1

#### å½“å‰é—®é¢˜
- å·²ç»ä»2171è¡Œä¼˜åŒ–åˆ°1114è¡Œ
- ä»æœ‰è¿›ä¸€æ­¥ä¼˜åŒ–ç©ºé—´
- éƒ¨åˆ†é€»è¾‘å¯ä»¥ç»§ç»­æå–

#### ä¼˜åŒ–ç­–ç•¥

**6.1 ç»§ç»­æå–Hooks**

å·²æå–çš„hooksï¼š
- âœ… useAuthHandlers
- âœ… useJournalHandlers
- âœ… useCharacterHandlers
- âœ… useScriptHandlers
- âœ… useEraHandlers
- âœ… useDataLoader
- âœ… useNavigationHandlers
- âœ… useDeviceMode
- âœ… useMailCheck
- âœ… useCharacterSelectionScroll

**å¯ä»¥ç»§ç»­æå–çš„hooks**:
```typescript
// hooks/useScreenRenderer.ts
export const useScreenRenderer = () => {
  const { gameState } = useGameState();
  const renderScreen = useCallback(() => {
    switch (gameState.currentScreen) {
      case 'entryPoint': return <EntryPoint />;
      case 'realWorld': return <RealWorldScreen />;
      // ... å…¶ä»–å±å¹•
    }
  }, [gameState.currentScreen]);
  return renderScreen;
};

// hooks/useModalRenderer.ts
export const useModalRenderer = () => {
  const { modals } = useModalState();
  // ... æ¨¡æ€æ¡†æ¸²æŸ“é€»è¾‘
};
```

**6.2 æ‹†åˆ†å±å¹•ç»„ä»¶**

```typescript
// App.tsx (è¿›ä¸€æ­¥ç®€åŒ–)
export const App: React.FC = () => {
  const { gameState } = useGameState();
  const renderScreen = useScreenRenderer();
  const renderModals = useModalRenderer();
  
  return (
    <GameStateProvider>
      <div className="app">
        {renderScreen()}
        {renderModals()}
        <GlobalDialogs />
      </div>
    </GameStateProvider>
  );
};
```

**é¢„æœŸæ•ˆæœ**:
- ä¸»æ–‡ä»¶å‡å°‘åˆ° < 500è¡Œ
- é€»è¾‘æ›´æ¸…æ™°
- æ›´æ˜“äºæµ‹è¯•

---

## ğŸ“… å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šé«˜ä¼˜å…ˆçº§ï¼ˆ1-2å‘¨ï¼‰

1. **admin/AdminScreen.tsx** (P0)
   - [ ] åˆ›å»ºåŠŸèƒ½æ¨¡å—ç»„ä»¶
   - [ ] æå–è‡ªå®šä¹‰hooks
   - [ ] æ‹†åˆ†çŠ¶æ€ç®¡ç†
   - **é¢„è®¡æ—¶é—´**: 3-5å¤©

2. **services/api.ts** (P0)
   - [ ] è¿ç§»adminApiåˆ°api/admin/
   - [ ] è¿ç§»authApiåˆ°api/auth/
   - [ ] è¿ç§»å…¶ä»–APIæ¨¡å—
   - **é¢„è®¡æ—¶é—´**: 2-3å¤©

### ç¬¬äºŒé˜¶æ®µï¼šä¸­ä¼˜å…ˆçº§ï¼ˆ2-3å‘¨ï¼‰

3. **services/gemini.ts** (P1)
   - [ ] åˆ›å»ºåŸºç¡€æœåŠ¡ç±»
   - [ ] æ‹†åˆ†provider
   - [ ] å®ç°å¤šæ¨¡å‹äº’å¤‡
   - **é¢„è®¡æ—¶é—´**: 3-4å¤©

4. **components/InitializationWizard.tsx** (P1)
   - [ ] æ‹†åˆ†æ­¥éª¤ç»„ä»¶
   - [ ] æå–hooks
   - [ ] ä¼˜åŒ–çŠ¶æ€ç®¡ç†
   - **é¢„è®¡æ—¶é—´**: 2-3å¤©

5. **mobile/MobileApp.tsx** (P1)
   - [ ] æå–å…¬å…±é€»è¾‘
   - [ ] ä¼˜åŒ–å±å¹•ç»„ä»¶
   - [ ] ä¸PCç«¯å…±äº«ä»£ç 
   - **é¢„è®¡æ—¶é—´**: 2-3å¤©

6. **App.tsx** (P1)
   - [ ] ç»§ç»­æå–hooks
   - [ ] ä¼˜åŒ–ç»„ä»¶ç»“æ„
   - **é¢„è®¡æ—¶é—´**: 1-2å¤©

---

## âœ… ä¼˜åŒ–æ£€æŸ¥æ¸…å•

### ä»£ç è´¨é‡
- [ ] æ‰€æœ‰æ–‡ä»¶ < 1000è¡Œ
- [ ] æ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€
- [ ] å‡å°‘é‡å¤ä»£ç 
- [ ] æé«˜ä»£ç å¤ç”¨æ€§

### æ€§èƒ½ä¼˜åŒ–
- [ ] ä½¿ç”¨React.memoä¼˜åŒ–ç»„ä»¶
- [ ] ä½¿ç”¨useCallbackå’ŒuseMemo
- [ ] å‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“
- [ ] ä¼˜åŒ–çŠ¶æ€æ›´æ–°

### å¯æµ‹è¯•æ€§
- [ ] æ¯ä¸ªæ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•
- [ ] æå–çš„hookså¯å•å…ƒæµ‹è¯•
- [ ] ç»„ä»¶ä¾èµ–æ³¨å…¥æ¸…æ™°

### å¯ç»´æŠ¤æ€§
- [ ] æ–‡ä»¶ç»“æ„æ¸…æ™°
- [ ] å‘½åè§„èŒƒç»Ÿä¸€
- [ ] æ³¨é‡Šå®Œå–„
- [ ] ç±»å‹å®šä¹‰å®Œæ•´

---

## ğŸ“Š é¢„æœŸæ”¶ç›Š

### ä»£ç é‡å‡å°‘
- **admin/AdminScreen.tsx**: 3158è¡Œ â†’ < 300è¡Œ (å‡å°‘90%)
- **services/api.ts**: 2299è¡Œ â†’ < 100è¡Œ (å‡å°‘95%)
- **services/gemini.ts**: 1490è¡Œ â†’ < 200è¡Œ (å‡å°‘87%)
- **components/InitializationWizard.tsx**: 1223è¡Œ â†’ < 200è¡Œ (å‡å°‘84%)
- **mobile/MobileApp.tsx**: 1215è¡Œ â†’ < 300è¡Œ (å‡å°‘75%)
- **App.tsx**: 1114è¡Œ â†’ < 500è¡Œ (å‡å°‘55%)

### å…¶ä»–æ”¶ç›Š
- âœ… æé«˜ä»£ç å¯è¯»æ€§
- âœ… æé«˜ä»£ç å¯ç»´æŠ¤æ€§
- âœ… æé«˜ä»£ç å¯æµ‹è¯•æ€§
- âœ… å‡å°‘bugé£é™©
- âœ… æé«˜å¼€å‘æ•ˆç‡
- âœ… ä¾¿äºå›¢é˜Ÿåä½œ

---

## ğŸ¯ ä¼˜åŒ–åŸåˆ™

1. **å•ä¸€èŒè´£åŸåˆ™**: æ¯ä¸ªæ–‡ä»¶/ç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
2. **DRYåŸåˆ™**: ä¸é‡å¤ä»£ç ï¼Œæå–å…¬å…±é€»è¾‘
3. **å…³æ³¨ç‚¹åˆ†ç¦»**: UIã€é€»è¾‘ã€æ•°æ®åˆ†ç¦»
4. **æ¸è¿›å¼é‡æ„**: é€æ­¥ä¼˜åŒ–ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
5. **å‘åå…¼å®¹**: ä¿æŒAPIæ¥å£ä¸å˜

---

**æ–‡æ¡£ç»´æŠ¤**: å»ºè®®æ¯æ¬¡ä¼˜åŒ–åæ›´æ–°æ­¤æ–‡æ¡£  
**æœ€åæ›´æ–°**: 2025-01-22


