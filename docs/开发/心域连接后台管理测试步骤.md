# 心域连接后台管理测试步骤

## 前置准备

### 1. 启动后端服务

```bash
cd backend
mvn spring-boot:run
```

或者使用 IDE 运行主类：
- 主类位置: `com.heartsphere.HeartSphereApplication`
- 默认端口: `8081`

### 2. 启动前端服务

```bash
cd frontend
npm install  # 如果还没有安装依赖
npm start
```

或者使用 Vite：
```bash
npm run dev
```

默认端口: `3001` 或 `3000`

### 3. 验证服务状态

#### 检查后端服务
```bash
curl http://localhost:8081/api/health
```

#### 检查前端服务
打开浏览器访问: `http://localhost:3001`

## 测试步骤

### 第一步：管理员登录测试

1. 打开浏览器访问管理后台: `http://localhost:3001/admin.html`
2. 使用管理员账号登录
3. 验证登录成功后跳转到管理界面

**预期结果**: 
- ✅ 登录成功
- ✅ 获取到管理员 Token
- ✅ 跳转到管理界面

### 第二步：共享配置管理测试

1. 在管理界面中点击"心域连接管理"
2. 选择"共享配置管理"标签页
3. 测试以下功能：

#### 2.1 加载共享配置列表
- **操作**: 页面自动加载或点击"刷新"按钮
- **预期结果**: 
  - ✅ 显示加载动画
  - ✅ 成功加载数据或显示空状态
  - ✅ 如果有数据，显示在表格中

#### 2.2 筛选功能
- **操作**: 
  - 选择不同的状态筛选（已启用/已禁用/已暂停）
  - 选择不同的共享类型（全部/世界/场景）
  - 输入搜索关键词
- **预期结果**: 
  - ✅ 筛选条件生效
  - ✅ 列表数据更新
  - ✅ 显示筛选后的结果或空状态提示

#### 2.3 操作功能
- **操作**: 
  - 点击"启用"、"禁用"、"暂停"或"删除"按钮
  - 确认操作
- **预期结果**: 
  - ✅ 显示确认对话框
  - ✅ 操作按钮显示"处理中..."状态
  - ✅ 操作成功后显示成功提示
  - ✅ 列表自动刷新

#### 2.4 错误处理测试
- **操作**: 
  - 断开网络连接
  - 尝试加载数据
- **预期结果**: 
  - ✅ 显示错误状态组件
  - ✅ 显示网络错误提示
  - ✅ 提供重试按钮

### 第三步：连接请求管理测试

1. 选择"连接请求管理"标签页
2. 测试以下功能：

#### 3.1 加载连接请求列表
- **操作**: 页面自动加载
- **预期结果**: 
  - ✅ 显示加载动画
  - ✅ 成功加载数据或显示空状态

#### 3.2 审核功能
- **操作**: 
  - 找到状态为"待处理"的请求
  - 点击"通过"或"拒绝"按钮
  - 确认操作（拒绝时需要输入原因）
- **预期结果**: 
  - ✅ 显示确认对话框
  - ✅ 操作按钮显示"处理中..."状态
  - ✅ 操作成功后显示成功提示
  - ✅ 列表自动刷新，状态更新

### 第四步：访问记录管理测试

1. 选择"访问记录管理"标签页
2. 测试以下功能：

#### 4.1 加载访问记录
- **操作**: 页面自动加载
- **预期结果**: 
  - ✅ 显示加载动画
  - ✅ 成功加载数据或显示空状态

#### 4.2 导出功能
- **操作**: 点击"导出数据"按钮
- **预期结果**: 
  - ✅ 下载 CSV 文件
  - ✅ 文件包含访问记录数据

### 第五步：留言管理测试

1. 选择"留言管理"标签页
2. 测试以下功能：

#### 5.1 加载留言列表
- **操作**: 页面自动加载
- **预期结果**: 
  - ✅ 显示加载动画
  - ✅ 成功加载数据或显示空状态

#### 5.2 审核和删除功能
- **操作**: 
  - 找到待审核的留言
  - 点击"通过"、"拒绝"或"删除"按钮
  - 确认操作
- **预期结果**: 
  - ✅ 显示确认对话框
  - ✅ 操作成功后显示成功提示
  - ✅ 列表自动刷新

### 第六步：数据统计测试

1. 选择"数据统计"标签页
2. 测试以下功能：

#### 6.1 加载统计数据
- **操作**: 页面自动加载
- **预期结果**: 
  - ✅ 显示加载动画
  - ✅ 成功加载统计数据
  - ✅ 显示各种统计卡片（用户统计、共享统计、连接统计等）

#### 6.2 时间筛选
- **操作**: 
  - 选择开始日期和结束日期
  - 点击"查询"按钮
- **预期结果**: 
  - ✅ 根据时间范围筛选数据
  - ✅ 统计数据更新

### 第七步：异常处理测试

1. 选择"异常处理"标签页
2. 测试以下功能：

#### 7.1 切换标签页
- **操作**: 在"异常记录"和"投诉记录"之间切换
- **预期结果**: 
  - ✅ 标签页切换正常
  - ✅ 数据加载正常

#### 7.2 处理异常/投诉
- **操作**: 
  - 找到待处理的异常或投诉
  - 点击"处理"按钮
  - 输入处理结果
- **预期结果**: 
  - ✅ 显示输入对话框
  - ✅ 处理成功后显示成功提示
  - ✅ 列表自动刷新

## API 直接测试

### 使用 curl 测试 API

#### 1. 登录获取 Token
```bash
TOKEN=$(curl -X POST http://localhost:8081/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"your_password"}' \
  | jq -r '.data.token')

echo "Token: $TOKEN"
```

#### 2. 测试获取共享配置列表
```bash
curl -X GET "http://localhost:8081/api/admin/heartsphere-connection/share-configs?page=0&size=20" \
  -H "Authorization: Bearer $TOKEN" \
  | jq .
```

#### 3. 测试获取统计数据
```bash
curl -X GET "http://localhost:8081/api/admin/heartsphere-connection/statistics/overview" \
  -H "Authorization: Bearer $TOKEN" \
  | jq .
```

## 测试检查清单

### 功能测试
- [ ] 管理员登录功能正常
- [ ] 共享配置列表加载正常
- [ ] 共享配置筛选功能正常
- [ ] 共享配置操作（启用/禁用/暂停/删除）正常
- [ ] 连接请求列表加载正常
- [ ] 连接请求审核功能正常
- [ ] 访问记录列表加载正常
- [ ] 访问记录导出功能正常
- [ ] 留言列表加载正常
- [ ] 留言审核和删除功能正常
- [ ] 统计数据加载正常
- [ ] 统计数据时间筛选正常
- [ ] 异常处理功能正常
- [ ] 投诉处理功能正常

### 用户体验测试
- [ ] 加载状态显示正常
- [ ] 空状态提示友好
- [ ] 错误状态显示正常
- [ ] 错误重试功能正常
- [ ] 操作按钮加载状态正常
- [ ] 操作成功/失败提示正常
- [ ] 分页功能正常
- [ ] 数据刷新正常

### 错误处理测试
- [ ] 网络错误处理正常
- [ ] 401 未授权错误处理正常
- [ ] 403 权限不足错误处理正常
- [ ] 404 资源不存在错误处理正常
- [ ] 500 服务器错误处理正常

### 性能测试
- [ ] 页面加载速度合理（< 2秒）
- [ ] 数据加载速度合理（< 1秒）
- [ ] 操作响应速度合理（< 1秒）
- [ ] 大量数据时性能正常

## 常见问题排查

### 1. 后端服务无法启动
- 检查端口 8081 是否被占用
- 检查数据库连接配置
- 查看后端日志错误信息

### 2. 前端无法连接后端
- 检查后端服务是否运行
- 检查 API_BASE_URL 配置
- 检查 CORS 配置

### 3. 登录失败
- 检查管理员账号是否存在
- 检查密码是否正确
- 查看后端日志错误信息

### 4. API 返回 401 错误
- 检查 Token 是否有效
- 检查 Token 是否过期
- 重新登录获取新 Token

### 5. 数据加载失败
- 检查数据库是否有数据
- 检查 API 端点是否正确
- 查看浏览器控制台错误信息
- 查看后端日志错误信息

## 测试报告模板

```
测试日期: [日期]
测试人员: [姓名]
测试环境: [环境信息]

功能测试结果:
- 共享配置管理: ✅/❌
- 连接请求管理: ✅/❌
- 访问记录管理: ✅/❌
- 留言管理: ✅/❌
- 数据统计: ✅/❌
- 异常处理: ✅/❌

发现的问题:
1. [问题描述]
2. [问题描述]

建议:
1. [建议内容]
2. [建议内容]
```

## 下一步

测试完成后，根据测试结果：
1. 修复发现的问题
2. 优化用户体验
3. 完善错误处理
4. 添加缺失的功能
5. 性能优化


