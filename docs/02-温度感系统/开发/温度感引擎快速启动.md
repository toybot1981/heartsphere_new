# æ¸©åº¦æ„Ÿå¼•æ“å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸ¯ å¼•æ“å®šä½

**æ¸©åº¦æ„Ÿå¼•æ“ï¼ˆTemperature Engineï¼‰**æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€å¯æ’æ‹”çš„æ¨¡å—ç³»ç»Ÿï¼Œè´Ÿè´£ï¼š
- è®¡ç®—ç³»ç»Ÿæ¸©åº¦æ„Ÿ
- è°ƒèŠ‚UIã€äº¤äº’ã€å†…å®¹ä»¥åŒ¹é…ç›®æ ‡æ¸©åº¦æ„Ÿ
- åˆ†æç”¨æˆ·æƒ…ç»ªï¼Œæä¾›æƒ…æ„ŸåŒ–å“åº”
- æ”¯æŒä¸ªæ€§åŒ–é€‚é…

---

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šåˆ›å»ºæ ¸å¿ƒå¼•æ“ï¼ˆ2åˆ†é’Ÿï¼‰

åˆ›å»ºæ–‡ä»¶ï¼š`frontend/services/temperature-engine/core/TemperatureEngine.ts`

```typescript
import { EventSystem } from '../events/EventSystem';
import { ConfigManager } from '../config/ConfigManager';
import { TemperatureCalculator } from '../calculator/TemperatureCalculator';
import { TemperatureAdjuster } from '../adjusters/TemperatureAdjuster';
import { PluginManager } from '../plugins/PluginManager';

export class TemperatureEngine {
  private eventSystem: EventSystem;
  private configManager: ConfigManager;
  private calculator: TemperatureCalculator;
  private adjuster: TemperatureAdjuster;
  private pluginManager: PluginManager;
  private isRunning: boolean = false;
  
  constructor(config?: Partial<TemperatureEngineConfig>) {
    this.configManager = new ConfigManager(config);
    this.eventSystem = new EventSystem();
    this.calculator = new TemperatureCalculator(this.configManager, this.eventSystem);
    this.adjuster = new TemperatureAdjuster(this.configManager, this.eventSystem);
    this.pluginManager = new PluginManager(this.configManager, this.eventSystem);
  }
  
  async start(): Promise<void> {
    if (this.isRunning) return;
    
    // åˆå§‹åŒ–æ’ä»¶
    await this.pluginManager.init();
    
    this.isRunning = true;
    this.eventSystem.emit('engineStarted');
  }
  
  async stop(): Promise<void> {
    if (!this.isRunning) return;
    
    await this.pluginManager.destroy();
    this.isRunning = false;
    this.eventSystem.emit('engineStopped');
  }
  
  // è®¡ç®—æ¸©åº¦æ„Ÿ
  async calculateTemperature(context: TemperatureContext): Promise<TemperatureScore> {
    return await this.calculator.calculate(context);
  }
  
  // è°ƒèŠ‚æ¸©åº¦æ„Ÿ
  async adjustTemperature(target: TemperatureLevel, options?: AdjustOptions): Promise<void> {
    return await this.adjuster.adjust(target, options);
  }
  
  // åˆ†ææƒ…ç»ª
  async analyzeEmotion(input: EmotionInput): Promise<EmotionAnalysis> {
    return await this.calculator.analyzeEmotion(input);
  }
  
  // äº‹ä»¶ç›‘å¬
  on(event: string, listener: Function): void {
    this.eventSystem.on(event, listener);
  }
  
  off(event: string, listener: Function): void {
    this.eventSystem.off(event, listener);
  }
}
```

### æ­¥éª¤2ï¼šåˆ›å»ºReact Hookï¼ˆ2åˆ†é’Ÿï¼‰

åˆ›å»ºæ–‡ä»¶ï¼š`frontend/services/temperature-engine/hooks/useTemperatureEngine.ts`

```typescript
import { useEffect, useRef } from 'react';
import { TemperatureEngine } from '../core/TemperatureEngine';

export function useTemperatureEngine(config?: Partial<TemperatureEngineConfig>) {
  const engineRef = useRef<TemperatureEngine | null>(null);
  
  useEffect(() => {
    // åˆ›å»ºå¼•æ“å®ä¾‹
    const engine = new TemperatureEngine(config);
    engineRef.current = engine;
    
    // å¯åŠ¨å¼•æ“
    engine.start();
    
    // æ¸…ç†
    return () => {
      engine.stop();
    };
  }, []);
  
  return engineRef.current;
}
```

### æ­¥éª¤3ï¼šåœ¨Appä¸­ä½¿ç”¨ï¼ˆ1åˆ†é’Ÿï¼‰

```typescript
// App.tsx
import { useTemperatureEngine } from './services/temperature-engine/hooks/useTemperatureEngine';

function App() {
  const engine = useTemperatureEngine({
    enabled: true,
    temperature: { default: 'warm' },
  });
  
  useEffect(() => {
    if (!engine) return;
    
    // ç›‘å¬æ¸©åº¦æ„Ÿå˜åŒ–
    engine.on('temperatureChanged', (temperature) => {
      console.log('æ¸©åº¦æ„Ÿ:', temperature.level, temperature.score);
    });
    
    // ç›‘å¬æƒ…ç»ªæ£€æµ‹
    engine.on('emotionDetected', (emotion) => {
      console.log('æƒ…ç»ª:', emotion.type);
    });
  }, [engine]);
  
  return <div>...</div>;
}
```

---

## ğŸ“‹ æ ¸å¿ƒAPIä½¿ç”¨

### 1. è®¡ç®—æ¸©åº¦æ„Ÿ

```typescript
const temperature = await engine.calculateTemperature({
  userEmotion: 'happy',
  context: {
    timeOfDay: 'morning',
    conversationLength: 10,
  },
  history: conversationHistory,
});

console.log(temperature.score);  // 75
console.log(temperature.level);  // 'warm'
```

### 2. è°ƒèŠ‚æ¸©åº¦æ„Ÿ

```typescript
// è°ƒèŠ‚UI
await engine.adjustTemperature('warm', {
  elements: ['button', 'card'],
  animation: true,
});

// è°ƒèŠ‚å†…å®¹
const warmMessage = await engine.adjustContent({
  original: 'ä½ å¥½',
  targetTemperature: 'warm',
});
```

### 3. åˆ†ææƒ…ç»ª

```typescript
const emotion = await engine.analyzeEmotion({
  text: 'æˆ‘ä»Šå¤©å¾ˆå¼€å¿ƒï¼',
  context: currentContext,
});

console.log(emotion.type);        // 'happy'
console.log(emotion.confidence);  // 0.85
```

---

## ğŸ”Œ æ’ä»¶ä½¿ç”¨

### æ³¨å†Œå†…ç½®æ’ä»¶

```typescript
// å¼•æ“ä¼šè‡ªåŠ¨åŠ è½½å†…ç½®æ’ä»¶
const engine = new TemperatureEngine({
  plugins: {
    enabled: ['greeting', 'expression', 'dialogue'],
  },
});
```

### åˆ›å»ºè‡ªå®šä¹‰æ’ä»¶

```typescript
const customPlugin = {
  id: 'custom-greeting',
  name: 'è‡ªå®šä¹‰é—®å€™',
  version: '1.0.0',
  
  onInit: (engine) => {
    console.log('æ’ä»¶åˆå§‹åŒ–');
  },
  
  onTemperatureChange: (temperature) => {
    if (temperature.level === 'warm') {
      // è‡ªå®šä¹‰é€»è¾‘
    }
  },
};

engine.registerPlugin(customPlugin);
```

---

## ğŸ¨ åœ¨ChatWindowä¸­é›†æˆ

```typescript
// ChatWindow.tsx
import { useTemperatureEngine } from '../services/temperature-engine/hooks/useTemperatureEngine';

function ChatWindow() {
  const engine = useTemperatureEngine();
  
  const handleSendMessage = async (message: string) => {
    // åˆ†ææƒ…ç»ª
    const emotion = await engine?.analyzeEmotion({
      text: message,
      context: getCurrentContext(),
    });
    
    // è®¡ç®—æ¸©åº¦æ„Ÿ
    const temperature = await engine?.calculateTemperature({
      userEmotion: emotion?.type || 'neutral',
      context: getCurrentContext(),
    });
    
    // å‘é€æ¶ˆæ¯
    sendMessage(message);
  };
  
  const handleReceiveMessage = async (message: string) => {
    // è°ƒèŠ‚å†…å®¹æ¸©åº¦æ„Ÿ
    const warmMessage = await engine?.adjustContent({
      original: message,
      targetTemperature: 'warm',
    });
    
    displayMessage(warmMessage);
  };
  
  return <div>...</div>;
}
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

```typescript
const engine = new TemperatureEngine({
  // åŸºç¡€é…ç½®
  enabled: true,
  mode: 'auto', // 'auto' | 'manual' | 'hybrid'
  
  // æ¸©åº¦æ„Ÿé…ç½®
  temperature: {
    default: 'warm',
    range: { min: 0, max: 100 },
    sensitivity: 'medium',
  },
  
  // åŠŸèƒ½é…ç½®
  features: {
    emotionAnalysis: true,
    contextAwareness: true,
    uiAdjustment: true,
    characterAdjustment: true,
  },
  
  // æ€§èƒ½é…ç½®
  performance: {
    updateInterval: 1000,
    cacheEnabled: true,
    lazyLoad: true,
  },
  
  // æ’ä»¶é…ç½®
  plugins: {
    enabled: ['greeting', 'expression'],
  },
});
```

---

## ğŸ“ å®Œæ•´æ–‡ä»¶ç»“æ„

```
frontend/services/temperature-engine/
â”œâ”€â”€ index.ts                    # ä¸»å…¥å£
â”œâ”€â”€ core/                       # æ ¸å¿ƒå¼•æ“
â”‚   â””â”€â”€ TemperatureEngine.ts
â”œâ”€â”€ calculator/                 # æ¸©åº¦æ„Ÿè®¡ç®—
â”‚   â”œâ”€â”€ EmotionAnalyzer.ts
â”‚   â””â”€â”€ TemperatureScorer.ts
â”œâ”€â”€ adjusters/                  # æ¸©åº¦æ„Ÿè°ƒèŠ‚
â”‚   â”œâ”€â”€ UIAdjuster.ts
â”‚   â””â”€â”€ ContentAdjuster.ts
â”œâ”€â”€ plugins/                    # æ’ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ PluginManager.ts
â”‚   â””â”€â”€ builtin/
â”œâ”€â”€ config/                     # é…ç½®ç³»ç»Ÿ
â”‚   â””â”€â”€ ConfigManager.ts
â”œâ”€â”€ events/                     # äº‹ä»¶ç³»ç»Ÿ
â”‚   â””â”€â”€ EventSystem.ts
â””â”€â”€ hooks/                      # React Hooks
    â””â”€â”€ useTemperatureEngine.ts
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. é˜…è¯»[æ¸©åº¦æ„Ÿå¼•æ“æ¶æ„è®¾è®¡](./æ¸©åº¦æ„Ÿå¼•æ“æ¶æ„è®¾è®¡.md)
2. å®æ–½æ ¸å¿ƒå¼•æ“ï¼ˆé˜¶æ®µä¸€ï¼‰
3. å®æ–½è®¡ç®—å±‚ï¼ˆé˜¶æ®µäºŒï¼‰
4. å®æ–½è°ƒèŠ‚å±‚ï¼ˆé˜¶æ®µä¸‰ï¼‰
5. é›†æˆåˆ°åº”ç”¨

---

**å¼€å§‹æ—¶é—´**ï¼šç°åœ¨  
**é¢„è®¡å®Œæˆ**ï¼š2-3å‘¨  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

