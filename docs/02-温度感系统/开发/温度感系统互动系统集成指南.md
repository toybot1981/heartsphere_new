# 温度感系统互动系统集成指南

**完成日期**: 2025-12-28  
**功能**: 互动系统集成到 ChatWindow 的完整指南

---

## ✅ 集成步骤

### 1. 导入必要的组件和类型

在 `ChatWindow.tsx` 文件顶部添加：

```typescript
import { InteractionButtons, CommentList } from './interaction';
import { ContentType } from '../services/interaction-system/types/InteractionTypes';
```

### 2. 添加状态管理

在组件状态声明部分添加：

```typescript
const [showCommentsFor, setShowCommentsFor] = useState<string | null>(null);
```

### 3. 在消息中添加互动按钮

在消息渲染部分，找到消息内容区域，在音频播放按钮下方添加：

```tsx
{/* 互动按钮 */}
{!isCinematic && (
  <div className="mt-3 flex items-center gap-2">
    <InteractionButtons
      contentType={ContentType.MESSAGE}
      contentId={msg.id}
      userId={typeof userProfile?.id === 'number' ? userProfile.id : 0}
      showLike={true}
      showComment={true}
      showShare={true}
      showFavorite={true}
      onCommentClick={() => setShowCommentsFor(showCommentsFor === msg.id ? null : msg.id)}
    />
  </div>
)}
```

### 4. 添加评论列表模态对话框

在组件底部，表情选择器和卡片制作工具之后添加：

```tsx
{/* 评论列表 */}
{showCommentsFor && (
  <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50" onClick={() => setShowCommentsFor(null)}>
    <div onClick={(e) => e.stopPropagation()}>
      <CommentList
        contentType={ContentType.MESSAGE}
        contentId={showCommentsFor}
        userId={typeof userProfile?.id === 'number' ? userProfile.id : 0}
        onClose={() => setShowCommentsFor(null)}
      />
    </div>
  </div>
)}
```

---

## 🎨 UI 位置

### 互动按钮位置

- **位置**: 消息内容下方，音频播放按钮旁边
- **显示条件**: 仅在非电影模式下显示
- **样式**: 适配暗色主题

### 评论列表位置

- **位置**: 居中模态对话框
- **背景**: 半透明黑色遮罩
- **触发**: 点击评论按钮

---

## 🔧 功能说明

### 互动按钮功能

1. **点赞按钮**
   - 点击切换点赞状态
   - 显示点赞数
   - 已点赞时显示粉色背景

2. **评论按钮**
   - 点击打开评论列表
   - 显示评论数

3. **分享按钮**
   - 点击复制链接到剪贴板
   - 显示分享数

4. **收藏按钮**
   - 点击切换收藏状态
   - 显示收藏数
   - 已收藏时显示黄色背景

### 评论列表功能

1. **显示评论**
   - 显示所有评论
   - 显示用户头像和名称
   - 显示评论时间

2. **添加评论**
   - 底部输入框
   - 按 Enter 或点击发送

3. **回复评论**
   - 点击回复按钮
   - 展开回复输入框
   - 支持多级回复

4. **删除评论**
   - 仅自己的评论可删除
   - 点击删除按钮

---

## 📝 注意事项

### 类型安全

- `userId` 需要确保是 `number` 类型
- 使用 `typeof userProfile?.id === 'number' ? userProfile.id : 0` 确保类型正确

### 状态管理

- `showCommentsFor` 存储当前显示评论的消息ID
- 点击评论按钮时切换状态
- 点击关闭或背景时清空状态

### 性能优化

- 互动按钮使用条件渲染
- 评论列表使用模态对话框，避免影响主界面

---

## 🎯 完成检查

确保以下内容已正确集成：

- [x] 导入 InteractionButtons 和 CommentList
- [x] 导入 ContentType
- [x] 添加 showCommentsFor 状态
- [x] 在消息中添加互动按钮
- [x] 添加评论列表模态对话框
- [x] 处理 userId 类型转换

---

**完成人**: AI助手  
**完成时间**: 2025-12-28

