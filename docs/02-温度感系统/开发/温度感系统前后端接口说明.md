# æ¸©åº¦æ„Ÿç³»ç»Ÿå‰åç«¯æ¥å£è¯´æ˜

**å®Œæˆæ—¥æœŸ**: 2025-12-28

---

## ğŸ“Š å½“å‰çŠ¶æ€

### âœ… åç«¯æ¥å£ï¼ˆå·²å®ç°ï¼‰

åç«¯å·²å®ç°å®Œæ•´çš„æƒ…ç»ªAPIæ¥å£ï¼š

**åŸºç¡€è·¯å¾„**: `/api/emotions`

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| åˆ†ææƒ…ç»ª | POST | `/api/emotions/analyze` | åˆ†æç”¨æˆ·æƒ…ç»ªå¹¶ä¿å­˜ |
| è·å–å½“å‰æƒ…ç»ª | GET | `/api/emotions/current` | è·å–ç”¨æˆ·æœ€è¿‘çš„æƒ…ç»ª |
| è·å–æƒ…ç»ªå†å² | GET | `/api/emotions/history` | è·å–æƒ…ç»ªå†å²è®°å½• |
| è·å–æƒ…ç»ªè¶‹åŠ¿ | GET | `/api/emotions/trend` | è·å–æƒ…ç»ªè¶‹åŠ¿åˆ†æ |
| è·å–æƒ…ç»ªç»Ÿè®¡ | GET | `/api/emotions/statistics` | è·å–æƒ…ç»ªç»Ÿè®¡æ•°æ® |

**è®¤è¯**: æ‰€æœ‰æ¥å£éœ€è¦ç”¨æˆ·è®¤è¯ï¼ˆ`@AuthenticationPrincipal UserDetails`ï¼‰

---

### âš ï¸ å‰ç«¯æ¥å£ï¼ˆå½“å‰çŠ¶æ€ï¼‰

**å‰ç«¯æƒ…ç»ªç³»ç»Ÿ**ï¼š
- âœ… ä½¿ç”¨ `LocalEmotionStorage`ï¼ˆlocalStorageï¼‰
- âŒ **æœªè°ƒç”¨åç«¯API**
- âœ… ä½¿ç”¨ `AIEmotionAnalyzer`ï¼ˆè°ƒç”¨å‰ç«¯AIæœåŠ¡ï¼‰

**å‰ç«¯è®°å¿†ç³»ç»Ÿ**ï¼š
- âœ… ä½¿ç”¨ `LocalMemoryStorage`ï¼ˆlocalStorageï¼‰
- âŒ **æœªè°ƒç”¨åç«¯API**
- âœ… ä½¿ç”¨ `AIMemoryExtractor`ï¼ˆè°ƒç”¨å‰ç«¯AIæœåŠ¡ï¼‰

---

## ğŸ” æ¥å£è¯¦æƒ…

### åç«¯æ¥å£è¯¦æƒ…

#### 1. åˆ†ææƒ…ç»ª

**è¯·æ±‚**:
```http
POST /api/emotions/analyze
Content-Type: application/json
Authorization: Bearer <token>

{
  "text": "ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬",
  "source": "conversation",
  "context": "å¯é€‰ä¸Šä¸‹æ–‡"
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "primaryEmotion": "happy",
    "secondaryEmotions": ["excited"],
    "intensity": "moderate",
    "confidence": 0.85,
    "emotionTags": ["å·¥ä½œå‹åŠ›"],
    "keyPhrases": ["éå¸¸å¼€å¿ƒ"],
    "reasoning": "åˆ†æç†ç”±"
  }
}
```

#### 2. è·å–å½“å‰æƒ…ç»ª

**è¯·æ±‚**:
```http
GET /api/emotions/current
Authorization: Bearer <token>
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "userId": 1,
    "emotionType": "happy",
    "emotionIntensity": "moderate",
    "confidence": 0.85,
    "timestamp": "2025-12-28T10:00:00"
  }
}
```

#### 3. è·å–æƒ…ç»ªå†å²

**è¯·æ±‚**:
```http
GET /api/emotions/history?startDate=2025-12-01T00:00:00&endDate=2025-12-28T23:59:59
Authorization: Bearer <token>
```

**å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "userId": 1,
      "emotionType": "happy",
      "emotionIntensity": "moderate",
      "confidence": 0.85,
      "timestamp": "2025-12-28T10:00:00"
    }
  ]
}
```

#### 4. è·å–æƒ…ç»ªè¶‹åŠ¿

**è¯·æ±‚**:
```http
GET /api/emotions/trend?period=week
Authorization: Bearer <token>
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "period": "week",
    "dominantEmotion": "happy",
    "emotionDistribution": {
      "happy": 10,
      "sad": 2,
      "calm": 5
    },
    "averageConfidence": 0.82
  }
}
```

#### 5. è·å–æƒ…ç»ªç»Ÿè®¡

**è¯·æ±‚**:
```http
GET /api/emotions/statistics?startDate=2025-12-01T00:00:00
Authorization: Bearer <token>
```

**å“åº”**:
```json
{
  "success": true,
  "data": [
    ["happy", 10],
    ["sad", 2],
    ["calm", 5]
  ]
}
```

---

## ğŸ”„ å‰åç«¯é›†æˆçŠ¶æ€

### å½“å‰å®ç°

**å‰ç«¯**:
- ä½¿ç”¨ `LocalEmotionStorage`ï¼ˆlocalStorageï¼‰å­˜å‚¨æƒ…ç»ªè®°å½•
- ä½¿ç”¨ `LocalMemoryStorage`ï¼ˆlocalStorageï¼‰å­˜å‚¨è®°å¿†
- ä½¿ç”¨å‰ç«¯AIæœåŠ¡è¿›è¡Œæƒ…ç»ªåˆ†æå’Œè®°å¿†æå–

**åç«¯**:
- æä¾›å®Œæ•´çš„RESTful APIæ¥å£
- ä½¿ç”¨MySQLæ•°æ®åº“å­˜å‚¨æƒ…ç»ªè®°å½•
- é›†æˆAIæœåŠ¡è¿›è¡Œæƒ…ç»ªåˆ†æ
- é›†æˆè®°å¿†ç³»ç»Ÿï¼ˆé€šè¿‡`TemperatureMemoryService`ï¼‰

### é—®é¢˜

**å‰åç«¯æœªé›†æˆ**ï¼š
- å‰ç«¯æƒ…ç»ªç³»ç»Ÿæ²¡æœ‰è°ƒç”¨åç«¯API
- å‰ç«¯è®°å¿†ç³»ç»Ÿæ²¡æœ‰è°ƒç”¨åç«¯API
- æ•°æ®å­˜å‚¨åœ¨ä¸åŒä½ç½®ï¼ˆå‰ç«¯localStorage vs åç«¯æ•°æ®åº“ï¼‰

---

## ğŸ’¡ é›†æˆå»ºè®®

### æ–¹æ¡ˆ1: å‰ç«¯è°ƒç”¨åç«¯APIï¼ˆæ¨èï¼‰

**ä¿®æ”¹å‰ç«¯å­˜å‚¨å®ç°**ï¼š

1. **åˆ›å»ºåç«¯å­˜å‚¨é€‚é…å™¨**:
   - `BackendEmotionStorage` - å®ç° `IEmotionStorage` æ¥å£
   - `BackendMemoryStorage` - å®ç° `IMemoryStorage` æ¥å£

2. **ä¿®æ”¹Hooké…ç½®**:
   ```typescript
   // useEmotionSystem.ts
   const storage = config.useBackend 
     ? new BackendEmotionStorage() 
     : new LocalEmotionStorage();
   ```

3. **APIè°ƒç”¨å®ç°**:
   ```typescript
   // BackendEmotionStorage.ts
   async save(record: EmotionRecord): Promise<void> {
     await fetch('/api/emotions/analyze', {
       method: 'POST',
       headers: { 'Content-Type': 'application/json' },
       body: JSON.stringify(record)
     });
   }
   ```

### æ–¹æ¡ˆ2: ä¿æŒå½“å‰å®ç°

**ä¼˜ç‚¹**:
- æ— éœ€ç½‘ç»œè¯·æ±‚ï¼Œå“åº”å¿«
- ç¦»çº¿å¯ç”¨
- å®ç°ç®€å•

**ç¼ºç‚¹**:
- æ•°æ®ä¸æŒä¹…åŒ–ï¼ˆæµè§ˆå™¨æ¸…ç†åä¸¢å¤±ï¼‰
- æ— æ³•è·¨è®¾å¤‡åŒæ­¥
- æ— æ³•è¿›è¡ŒæœåŠ¡å™¨ç«¯åˆ†æ

---

## ğŸ“ æ€»ç»“

### åç«¯æ¥å£
- âœ… **å·²å®ç°**: å®Œæ•´çš„RESTful API
- âœ… **åŠŸèƒ½**: æƒ…ç»ªåˆ†æã€å­˜å‚¨ã€æŸ¥è¯¢ã€ç»Ÿè®¡
- âœ… **è®¤è¯**: Spring Securityé›†æˆ
- âœ… **æ•°æ®åº“**: MySQLå­˜å‚¨

### å‰ç«¯æ¥å£
- âœ… **å·²å®ç°**: æœ¬åœ°å­˜å‚¨ï¼ˆlocalStorageï¼‰
- âŒ **æœªé›†æˆ**: æœªè°ƒç”¨åç«¯API
- âœ… **åŠŸèƒ½**: æƒ…ç»ªåˆ†æã€è®°å¿†æå–ï¼ˆä½¿ç”¨å‰ç«¯AIï¼‰

### å»ºè®®
- **å¼€å‘é˜¶æ®µ**: å¯ä»¥ç»§ç»­ä½¿ç”¨æœ¬åœ°å­˜å‚¨
- **ç”Ÿäº§ç¯å¢ƒ**: å»ºè®®é›†æˆåç«¯APIï¼Œå®ç°æ•°æ®æŒä¹…åŒ–å’Œè·¨è®¾å¤‡åŒæ­¥

---

**å®Œæˆäºº**: AIåŠ©æ‰‹  
**å®Œæˆæ—¶é—´**: 2025-12-28

