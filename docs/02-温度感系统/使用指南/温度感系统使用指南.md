# 心域温度感系统使用指南

## 概述

本文档介绍如何使用心域的温度感系统，包括UI组件、角色情感表达和对话优化等功能。

## 目录结构

```
frontend/
├── components/
│   ├── ui/                    # 基础UI组件
│   │   ├── Button.tsx         # 温暖感按钮组件
│   │   ├── Input.tsx          # 输入框组件
│   │   ├── Card.tsx           # 卡片组件
│   │   ├── EmptyState.tsx     # 空状态组件
│   │   ├── Loading.tsx         # 加载状态组件
│   │   ├── ErrorState.tsx     # 错误状态组件
│   │   ├── Toast.tsx          # Toast通知组件
│   │   └── Transition.tsx     # 页面过渡组件
│   ├── character/             # 角色相关组件
│   │   ├── Character.tsx       # 角色主组件
│   │   ├── Expression.tsx      # 表情系统
│   │   └── Action.tsx         # 动作系统
│   └── examples/             # 示例组件
│       └── TemperatureDemo.tsx # 温度感系统演示
├── services/
│   ├── GreetingService.ts      # 问候服务
│   └── DialogueService.ts     # 对话服务
└── src/
    └── tokens.css             # CSS变量和全局样式
```

## 快速开始

### 1. 导入全局样式

在你的入口文件（如 `index.tsx`）中导入全局样式：

```tsx
import './tokens.css';
```

### 2. 使用UI组件

#### Button 组件

```tsx
import { Button } from './components/ui/Button';

// 主要按钮
<Button variant="primary">主要操作</Button>

// 次要按钮
<Button variant="secondary">次要操作</Button>

// 文本按钮
<Button variant="text">文本按钮</Button>

// 带加载状态
<Button loading={true}>提交中...</Button>

// 不同尺寸
<Button size="sm">小按钮</Button>
<Button size="md">中按钮</Button>
<Button size="lg">大按钮</Button>
```

#### Input 组件

```tsx
import { Input } from './components/ui/Input';

// 基本用法
<Input
  label="用户名"
  placeholder="请输入用户名"
  value={value}
  onChange={handleChange}
/>

// 带错误提示
<Input
  label="邮箱"
  error="邮箱格式不正确"
  value={email}
  onChange={handleEmailChange}
/>

// 带字符计数
<Input
  label="简介"
  value={bio}
  onChange={handleBioChange}
  showCount
  maxLength={200}
/>
```

#### Card 组件

```tsx
import { Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter } from './components/ui/Card';

<Card hover>
  <CardHeader>
    <CardTitle>卡片标题</CardTitle>
    <CardDescription>卡片描述文字</CardDescription>
  </CardHeader>
  <CardContent>
    {/* 卡片内容 */}
  </CardContent>
  <CardFooter>
    <Button>操作按钮</Button>
  </CardFooter>
</Card>
```

#### EmptyState 组件

```tsx
import { EmptyState, EmptyStateMessages } from './components/ui/EmptyState';

// 自定义空状态
<EmptyState
  title="没有内容"
  description="开始创建你的第一个内容吧"
  actionLabel="创建"
  onAction={handleCreate}
/>

// 使用预设模板
<EmptyState {...EmptyStateMessages.noCharacters} onAction={handleCreate} />
```

#### Loading 组件

```tsx
import { Loading, getRandomLoadingMessage } from './components/ui/Loading';

// 基本加载
<Loading />

// 带提示信息
<Loading message={getRandomLoadingMessage('thinking')} />

// 不同尺寸
<Loading size="sm" />
<Loading size="md" />
<Loading size="lg" />

// 全屏加载
<Loading fullScreen message="正在加载..." />
```

#### Toast 通知

```tsx
import { useToast } from './components/ui/Toast';

function MyComponent() {
  const { success, error, warning, info } = useToast();
  
  const handleSuccess = () => {
    success('操作成功！');
  };
  
  const handleError = () => {
    error('操作失败！');
  };
  
  const handleWarning = () => {
    warning('请注意：...');
  };
  
  const handleInfo = () => {
    info('提示信息');
  };
  
  return (
    <div>
      <Button onClick={handleSuccess}>成功</Button>
      <Button onClick={handleError}>错误</Button>
      <Button onClick={handleWarning}>警告</Button>
      <Button onClick={handleInfo}>信息</Button>
    </div>
  );
}
```

#### Transition 组件

```tsx
import { FadeIn, SlideIn, ScaleIn, StaggeredList } from './components/ui/Transition';

// 淡入动画
<FadeIn>
  <div>内容</div>
</FadeIn>

// 滑入动画
<SlideIn direction="right">
  <div>内容</div>
</SlideIn>

// 缩放动画
<ScaleIn>
  <div>内容</div>
</ScaleIn>

// 列表交错动画
<StaggeredList staggerDelay={100}>
  <div>项目1</div>
  <div>项目2</div>
  <div>项目3</div>
</StaggeredList>
```

### 3. 使用角色组件

```tsx
import { Character, useCharacterController } from './components/character';

function MyComponent() {
  const controller = useCharacterController();
  
  const handleUserMessage = (message: string) => {
    // 处理用户消息，自动更新表情和动作
    controller.processMessage(message);
  };
  
  const handleUserEmotion = (emotion: string) => {
    // 处理用户情绪
    controller.processEmotion(emotion);
  };
  
  return (
    <Character
      size={120}
      onExpressionChange={(exp) => console.log('Expression:', exp)}
      onActionComplete={(action) => console.log('Action:', action)}
    />
  );
}
```

### 4. 使用对话服务

```tsx
import GreetingService from './services/GreetingService';
import DialogueService from './services/DialogueService';
import type { UserEmotion } from './services/GreetingService';

// 生成问候
function MyComponent() {
  const [greeting, setGreeting] = useState('');
  
  useEffect(() => {
    const context = GreetingService.buildGreetingContext({
      userEmotion: 'happy',
      isHoliday: false,
    });
    
    const greeting = GreetingService.selectGreeting(context);
    setGreeting(greeting);
  }, []);
  
  return <div>{greeting}</div>;
}

// 处理对话
function DialogueComponent() {
  const [dialogueHistory, setDialogueHistory] = useState([]);
  
  const handleMessage = (message: string) => {
    // 添加用户消息
    setDialogueHistory(prev => [...prev, { role: 'user', content: message }]);
    
    // 生成AI回应
    const response = DialogueService.processEmotionalResponse(message, 'happy');
    
    // 添加AI回应
    setDialogueHistory(prev => [...prev, { role: 'assistant', content: response }]);
  };
  
  // 结束对话
  const handleEndDialogue = () => {
    const endingMessage = DialogueService.generateEndingMessage('caring', true);
    const memories = DialogueService.analyzeDialogue(dialogueHistory, 'happy');
    
    console.log('对话结束消息:', endingMessage);
    console.log('对话记忆:', memories);
  };
  
  return (
    <div>
      {/* 对话界面 */}
    </div>
  );
}
```

## 主题和样式

### 使用CSS变量

```css
/* 直接使用CSS变量 */
.my-component {
  color: var(--text-primary);
  background: var(--bg-primary);
  border-color: var(--color-warm-pink);
}

/* 使用渐变 */
.gradient-button {
  background: var(--gradient-primary);
}

/* 使用阴影 */
.my-card {
  box-shadow: var(--shadow-md);
}
```

### 使用Tailwind类

```tsx
// 使用自定义颜色
<div className="bg-warm-pink text-white">温暖粉色</div>
<div className="bg-calm-blue text-white">宁静蓝色</div>

// 使用渐变
<div className="bg-gradient-to-r from-warm-pink to-warm-pink-light">渐变背景</div>

// 使用阴影
<div className="shadow-md">中等阴影</div>
<div className="shadow-primary">主色调阴影</div>

// 使用圆角
<div className="rounded-lg">大圆角</div>
<div className="rounded-xl">超大圆角</div>

// 使用动画
<div className="animate-fade-in">淡入动画</div>
<div className="animate-float">浮动动画</div>
```

## 高级功能

### 表情系统

```tsx
import { CharacterExpression, matchExpressionByText, useExpressionManager } from './components/character/Expression';

// 手动设置表情
const expressionManager = useExpressionManager();
expressionManager.setExpression('happy');

// 根据文本自动匹配表情
const text = "我今天很开心！";
const expression = matchExpressionByText(text); // 返回 'happy'

// 根据情绪匹配表情
const expression = matchExpressionByEmotion('happy'); // 返回 'happy'
```

### 动作系统

```tsx
import { useActionManager } from './components/character/Action';

const actionManager = useActionManager();

// 触发动作
actionManager.triggerAction('waving');  // 挥手
actionManager.triggerAction('nodding'); // 点头
actionManager.triggerAction('thinking'); // 思考

// 处理上下文
actionManager.processContext('greeting');  // 打招呼
actionManager.processContext('user_typing'); // 用户输入中

// 根据文本处理动作
actionManager.processText('是的，我明白了'); // 触发点头
```

### 自定义表情触发规则

```tsx
import { ExpressionTriggerRule } from './components/character/Expression';

const customTriggers: ExpressionTriggerRule[] = [
  {
    keywords: ['超赞', '牛逼', '厉害'],
    emotions: ['excited', 'proud'],
    context: ['celebration'],
    priority: 10,
    expression: 'happy',
    cooldown: 5000,
  },
  {
    keywords: ['累了', '疲惫'],
    emotions: ['tired', 'exhausted'],
    context: ['fatigue'],
    priority: 8,
    expression: 'comforting',
    cooldown: 4000,
  },
];

// 将自定义规则添加到系统
// 注意：这需要修改 Expression.tsx 文件中的 DefaultExpressionTriggers
```

## 最佳实践

### 1. 情感化设计

- ✅ 使用温暖的色彩（粉色、米色、蓝色）
- ✅ 使用柔和的阴影和圆角
- ✅ 添加友好的提示信息
- ✅ 使用表情符号增加温度感

### 2. 交互反馈

- ✅ 所有操作都要有反馈（按钮点击、输入验证等）
- ✅ 使用加载状态告知用户正在处理
- ✅ 使用Toast通知提供即时反馈
- ✅ 使用动画过渡提升体验

### 3. 个性化体验

- ✅ 根据时间问候用户
- ✅ 根据用户情绪调整回应
- ✅ 记住用户的偏好和重要时刻
- ✅ 提供个性化的对话内容

### 4. 性能优化

- ✅ 使用CSS动画而非JavaScript动画
- ✅ 懒加载组件和资源
- ✅ 优化图片大小和格式
- ✅ 使用requestAnimationFrame处理动画

## 调试和测试

### 查看完整示例

运行演示组件查看所有功能：

```tsx
import { TemperatureDemo } from './components/examples/TemperatureDemo';

function App() {
  return <TemperatureDemo />;
}
```

### 测试角色情感表达

```tsx
// 测试表情
const { setExpression } = useExpressionManager();
['happy', 'sad', 'thinking', 'neutral'].forEach(exp => {
  setExpression(exp);
});

// 测试动作
const { triggerAction } = useActionManager();
['waving', 'nodding', 'thinking'].forEach(action => {
  triggerAction(action);
});
```

## 常见问题

### Q: 如何自定义颜色方案？

A: 修改 `tokens.css` 中的CSS变量，或者修改 `tailwind.config.js` 中的颜色配置。

### Q: 如何添加新的表情？

A: 在 `Expression.tsx` 中添加新的表情类型、配置和触发规则。

### Q: 如何添加新的动作？

A: 在 `Action.tsx` 中添加新的动作类型、配置和动画定义。

### Q: 如何集成AI模型？

A: 在 `DialogueService.ts` 中修改 `processEmotionalResponse` 方法，集成你的AI API。

## 更新日志

### V1.0.0 (2025-12-28)
- ✅ 完成基础UI组件（Button、Input、Card等）
- ✅ 完成角色表情系统
- ✅ 完成角色动作系统
- ✅ 完成问候系统
- ✅ 完成对话优化系统
- ✅ 完成温度感设计系统（色彩、字体、动画）

## 支持

如有问题或建议，请联系开发团队。

