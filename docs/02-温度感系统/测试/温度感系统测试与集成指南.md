# 温度感系统测试与集成指南

**完成日期**: 2025-12-28  
**状态**: ✅ 测试代码已完成

---

## 📋 测试文件

### 后端测试

#### 1. 单元测试

**EmotionServiceTest.java**
- ✅ 测试AI增强的情绪分析
- ✅ 测试降级到基础分析
- ✅ 测试保存情绪记录
- ✅ 测试获取情绪历史
- ✅ 测试获取当前情绪
- ✅ 测试获取情绪统计

**TemperatureMemoryServiceTest.java**
- ✅ 测试从情绪记录提取记忆
- ✅ 测试情绪模式记忆提取
- ✅ 测试强烈情绪记忆提取
- ✅ 测试根据情绪检索记忆
- ✅ 测试获取情绪模式
- ✅ 测试情绪趋势分析

#### 2. API测试

**EmotionControllerTest.java**
- ✅ 测试POST /api/emotions/analyze
- ✅ 测试GET /api/emotions/current
- ✅ 测试GET /api/emotions/history
- ✅ 测试GET /api/emotions/trend
- ✅ 测试GET /api/emotions/statistics

#### 3. 集成测试

**EmotionMemoryIntegrationTest.java**
- ✅ 测试情绪分析与记忆提取集成
- ✅ 测试记忆检索
- ✅ 测试情绪趋势分析

### 前端测试

**EmotionMemoryDemo.tsx**
- ✅ 情绪分析演示
- ✅ 记忆提取演示
- ✅ 个性化回应演示
- ✅ 情绪趋势查看
- ✅ 情绪统计查看

---

## 🚀 运行测试

### 后端测试

```bash
# 运行所有测试
cd backend
./mvnw test

# 运行情绪系统测试
./mvnw test -Dtest=EmotionServiceTest

# 运行记忆服务测试
./mvnw test -Dtest=TemperatureMemoryServiceTest

# 运行API测试
./mvnw test -Dtest=EmotionControllerTest

# 运行集成测试
./mvnw test -Dtest=EmotionMemoryIntegrationTest
```

### 前端测试

```bash
# 启动开发服务器
cd frontend
npm run dev

# 访问演示页面
# 在应用中添加 EmotionMemoryDemo 组件
```

---

## 🔧 集成步骤

### 1. 数据库迁移

```bash
# 运行数据库迁移脚本
mysql -u root -p heartsphere < backend/src/main/resources/db/migration/V1__create_emotion_records_table.sql
```

### 2. 后端配置

确保以下服务已配置：
- ✅ AIService（用于AI增强分析）
- ✅ MemoryManager（用于记忆管理）
- ✅ LongMemoryService（用于长期记忆）

### 3. 前端集成

在`ChatWindow.tsx`中已集成：
- ✅ 情绪系统自动分析
- ✅ 记忆系统自动提取
- ✅ 个性化问候生成
- ✅ 记忆上下文增强

### 4. 使用集成工具

```typescript
import { EmotionMemoryIntegration } from './services/emotion-system/integration';

const integration = new EmotionMemoryIntegration({
  userId: 1,
  emotionSystem,
  memorySystem,
});

// 处理用户消息
const result = await integration.processUserMessage(
  '我今天非常开心！',
  EmotionSource.CONVERSATION
);
```

---

## 📊 测试场景

### 场景1: 基础情绪分析

**输入**: "我今天非常开心！"

**预期结果**:
- 情绪类型: happy
- 强度: moderate/strong
- 置信度: > 0.7
- 提取记忆: 情绪模式记忆或情感经历记忆

### 场景2: 消极情绪分析

**输入**: "今天工作很累，心情不好"

**预期结果**:
- 情绪类型: sad/tired
- 强度: moderate
- 置信度: > 0.6
- 提取记忆: 情感经历记忆（如果是强烈情绪）

### 场景3: 记忆检索

**操作**: 检索与"happy"情绪相关的记忆

**预期结果**:
- 返回相关记忆列表
- 按重要性排序
- 包含情绪模式和情感经历

### 场景4: 情绪趋势分析

**操作**: 分析一周的情绪趋势

**预期结果**:
- 返回趋势数据
- 包含情绪分布
- 包含平均置信度

---

## ✅ 验证清单

### 后端验证

- [ ] 情绪分析API正常响应
- [ ] 情绪记录正确保存到数据库
- [ ] 记忆正确提取和保存
- [ ] 记忆检索功能正常
- [ ] 情绪趋势分析正常

### 前端验证

- [ ] 情绪系统正常初始化
- [ ] 记忆系统正常初始化
- [ ] 情绪分析正常工作
- [ ] 记忆提取正常工作
- [ ] 可视化组件正常显示
- [ ] ChatWindow集成正常

### 集成验证

- [ ] 情绪分析与记忆提取协同工作
- [ ] 个性化问候正常生成
- [ ] 记忆上下文正确添加到AI指令
- [ ] 情绪趋势正确计算
- [ ] 统计数据显示正常

---

## 🐛 常见问题

### 1. AI服务不可用

**问题**: AI分析失败

**解决**: 系统会自动降级到基础关键词分析

### 2. 记忆未保存

**问题**: 记忆提取了但没有保存

**解决**: 检查MemoryManager配置，确保记忆保存逻辑正确

### 3. 情绪记录未保存

**问题**: 情绪分析成功但记录未保存

**解决**: 检查数据库连接和表结构

### 4. 前端组件不显示

**问题**: 可视化组件不显示数据

**解决**: 检查userId是否正确，确保有数据

---

## 📝 测试数据

### 测试用户ID

使用测试用户ID: `1`

### 测试文本示例

```typescript
// 积极情绪
"我今天非常开心！"
"完成了重要任务，感觉很满足"
"今天天气真好，心情很愉快"

// 消极情绪
"今天工作很累，心情不好"
"最近有点焦虑，不知道怎么办"
"感觉有点孤独"

// 中性情绪
"今天很平静"
"没什么特别的感觉"
```

---

## 🎯 下一步

1. [ ] 运行所有测试，确保通过
2. [ ] 在真实环境中测试
3. [ ] 性能测试和优化
4. [ ] 用户体验测试
5. [ ] 文档完善

---

**完成人**: AI助手  
**完成时间**: 2025-12-28

