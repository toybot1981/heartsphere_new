# 心理导师智能体系统 - 使用指南

## 📋 目录
1. [系统概述](#系统概述)
2. [快速开始](#快速开始)
3. [API 使用示例](#api-使用示例)
4. [功能详解](#功能详解)
5. [配置说明](#配置说明)
6. [常见问题](#常见问题)

---

## 系统概述

MindScape AI Clinic 后端是一个专业的心理健康智能体系统，支持 5 种主流心理治疗流派：

### 🎯 支持的疗法

| 疗法 | 治疗师 | 专长领域 |
|------|--------|---------|
| **CBT** (认知行为疗法) | Dr. Cognos 🧠 | 焦虑、抑郁、恐惧、完美主义、社交恐惧、失眠 |
| **DBT** (辩证行为疗法) | Sage Harmony ⚖️ | 情绪波动、成瘾、情绪淤堵、双相倾向 |
| **心理动力学** | Prof. Freudia 🛋️ | 原生家庭、创伤、依恋、讨好、哀悼 |
| **ACT** (接纳承诺疗法) | Guide River 🌊 | 灾难化思维、职业倦怠、空心病、存在主义 |
| **人本主义** | Alex Beacon ❤️ | 自尊、亲密关系、婚姻沟通、学业压力 |

### ✨ 核心功能

- ✅ **智能会话管理** - 诊前评估、实时对话、会话总结
- ✅ **上下文记忆** - 短期记忆 (Redis) + 长期记忆 (MongoDB)
- ✅ **心理学事实提取** - 自动识别情绪模式、认知扭曲、应对策略
- ✅ **深度知识库** - 生成 1000+ 字的专业学术解析
- ✅ **疗法智能推荐** - 基于用户困扰匹配最佳疗法
- ✅ **17 个临床案例** - 涵盖各种心理问题的真实案例

---

## 快速开始

### 1. 启动后端服务

```bash
# 进入后端目录
cd aistudio/backend

# 启动 Spring Boot 应用
mvn spring-boot:run

# 或者使用 IDE 运行 Application.java
```

### 2. 验证服务状态

```bash
curl http://localhost:8082/api/psychology/health
```

**预期响应**:
```json
{
  "status": "UP",
  "service": "Psychology Mentor Service",
  "version": "1.0.0"
}
```

### 3. 获取所有疗法

```bash
curl http://localhost:8082/api/psychology/methods
```

---

## API 使用示例

### 场景 1: 开始一次 CBT 咨询会话

```bash
curl -X POST http://localhost:8082/api/psychology/sessions/start \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user-001",
    "moodScore": 5,
    "stressLevel": 7,
    "sleepQuality": 4,
    "primaryConcern": "工作压力大，经常焦虑失眠",
    "goals": ["学会管理焦虑", "改善睡眠质量"],
    "selectedMethodId": "cbt",
    "hasPreviousTherapy": false
  }'
```

**响应示例**:
```json
{
  "sessionId": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "user-001",
  "therapyMethodId": "cbt",
  "status": "IN_PROGRESS",
  "currentPhase": 1,
  "startTime": "2025-12-27T10:30:00",
  "intake": { ... }
}
```

### 场景 2: 发送消息

```bash
curl -X POST http://localhost:8082/api/psychology/sessions/{sessionId}/message \
  -H "Content-Type: application/json" \
  -d '{
    "message": "我最近总是担心工作做不好，晚上睡不着觉，脑子里一直在转"
  }'
```

**Dr. Cognos 的回复示例**:
```
我理解你现在的感受。让我们一起来探索一下：

当你想到"工作做不好"时，具体是什么样的想法在困扰你？
你有没有注意到，这些想法出现时，你的身体有什么感觉？

我们可以尝试记录一下这些自动思维，看看它们是否准确。
这是心理咨询，不能替代专业医疗诊断。
```

### 场景 3: 结束会话并获取总结

```bash
curl -X POST http://localhost:8082/api/psychology/sessions/{sessionId}/end
```

**会话总结示例**:
```json
{
  "sessionId": "550e8400-...",
  "status": "COMPLETED",
  "sessionSummary": "1. 核心问题：工作焦虑伴随失眠，存在灾难化思维倾向\n2. 识别出的关键模式：'我必须把工作做得完美'的非理性信念\n3. 习得的技巧：认知重构技术、三栏技术记录自动思维\n4. 下次会话建议：练习行为实验，验证'工作做不好'的恐惧",
  "keyIssues": ["工作焦虑", "灾难化思维"],
  "learnedTechniques": ["认知重构", "自动思维监控"],
  "endTime": "2025-12-27T11:00:00"
}
```

### 场景 4: 根据困扰推荐疗法

```bash
curl "http://localhost:8082/api/psychology/cases/recommend?concern=原生家庭创伤"
```

**推荐结果**:
```json
[
  {
    "id": "psychodynamic",
    "name": "心理动力学疗法",
    "shortName": "PDT",
    "therapistName": "Freudia 教授",
    "therapistAvatar": "🛋️",
    "description": "深潜潜意识，探索早年经历如何塑造当下的关系模式。"
  }
]
```

### 场景 5: 生成深度知识库内容

```bash
curl -X POST http://localhost:8082/api/psychology/deep-dive \
  -H "Content-Type: application/json" \
  -d '{
    "methodId": "cbt",
    "phaseTitle": "认知模型入门",
    "phaseDescription": "理解情境、想法与情绪的联动机制"
  }'
```

**生成的内容** (1000+ 字):
```markdown
# 认知行为疗法（CBT）核心知识点：认知模型入门

## 理论起源与哲学背景

认知行为疗法（CBT）由 Aaron T. Beck 在 20 世纪 60 年代创立...

## 神经科学机制

从神经科学角度来看，CBT 能够通过前额叶皮层对杏仁核的调节...

... (全文超过 1000 字)
```

---

## 功能详解

### 🧠 自动心理学事实提取

系统会自动从对话中提取以下信息：

#### 1. 个人信息
- 年龄、职业、婚姻状况
- 教育背景、家庭状况

#### 2. 情绪模式
- 识别 10+ 种情绪（焦虑、抑郁、愤怒、恐惧、悲伤等）
- 情绪触发源
- 情绪强度和频率

#### 3. 认知扭曲
- 12 种认知扭曲类型：
  - 灾难化、非黑即白、过度概括、心理过滤
  - 否定正面、读心术、预言、放大缩小
  - 情绪推理、应该陈述、标签化等

#### 4. 应对策略
- 积极策略：运动、冥想、社交支持
- 消极策略：逃避、拖延、回避

#### 5. 触发因素
- 工作压力、考试、社交、冲突、批评、拒绝等

#### 6. 价值观
- 家庭、事业、自由、健康、成长、创造力、友谊等

### 📚 学习路径（每个疗法 4 阶段）

#### CBT 学习路径
1. **认知模型入门** (1周) - 理解情境-想法-情绪-行为
2. **自动思维监控** (2周) - 识别和记录自动思维
3. **挑战认知扭曲** (3周) - 苏格拉底式提问、认知重构
4. **行为实验设计** (2周) - 验证恐惧想法的真实性

#### DBT 学习路径
1. **核心正念技能** (2周) - 观察、描述、参与
2. **痛苦承受 TIPP** (2周) - 温度、运动、呼吸、放松
3. **情绪调节矩阵** (3周) - 识别情绪、相反行动
4. **人际效能 DEAR MAN** (2周) - 坚定表达、维护边界

（其他疗法类似，各 4 个阶段）

### 🏥 17 个临床案例库

系统内置 17 个真实临床案例，涵盖：

| 分类 | 案例数 | 案例 |
|------|--------|------|
| 亲密关系 | 3 | 夫妻沟通、回避型依恋、权力争夺 |
| 情绪障碍 | 3 | 情绪淤堵、广泛性焦虑、躁郁边缘 |
| 职场与自我 | 2 | 冒充者综合征、职业倦怠 |
| 焦虑障碍 | 2 | 社交恐惧、广泛性焦虑 |
| 原生家庭 | 3 | 讨好型人格、代际创伤、家庭创伤 |
| 其他 | 4 | 成瘾、空心病、身材焦虑、失眠等 |

每个案例包含：
- 典型表现
- 心理溯源
- 治疗处方
- 推荐疗法
- 难度级别

---

## 配置说明

### application.yml 配置

```yaml
spring:
  # Redis 配置（短期记忆）
  data:
    redis:
      host: localhost
      port: 6379

  # MongoDB 配置（长期记忆）
  data:
    mongodb:
      host: localhost
      port: 27017
      database: heartsphere_psychology

# 通义千问配置
spring:
  ai:
    dashscope:
      api-key: ${DASHSCOPE_API_KEY}
      chat:
        options:
          model: qwen-plus
          temperature: 0.7

# 心理导师配置
psychology:
  enabled: true
  context:
    enable-long-memory: true
    enable-fact-extraction: true
    max-session-tokens: 8000
```

### 环境变量

```bash
# 通义千问 API Key
export DASHSCOPE_API_KEY=your-api-key-here

# Redis 连接（可选，默认 localhost）
export REDIS_HOST=localhost
export REDIS_PORT=6379

# MongoDB 连接（可选，默认 localhost）
export MONGODB_HOST=localhost
export MONGODB_PORT=27017
```

---

## 常见问题

### Q1: 如何更换 AI 模型？

修改 `application.yml` 中的模型配置：

```yaml
spring:
  ai:
    dashscope:
      chat:
        options:
          model: qwen-turbo  # 或 qwen-max, qwen-plus
```

### Q2: 长期记忆存储在哪里？

默认存储在 MongoDB 的 `user_facts` 集合中。可以通过以下方式查看：

```javascript
// MongoDB Shell
use heartsphere_psychology
db.user_facts.find().pretty()

// 查看某个用户的所有事实
db.user_facts.find({userId: "user-001"})
```

### Q3: 如何清理会话历史？

```bash
# Redis 清理（短期记忆）
redis-cli FLUSHDB

# MongoDB 清理（长期记忆）
# 注意：这会删除所有用户数据！
mong heartsphere_psychology
db.user_facts.deleteMany({})
db.user_preferences.deleteMany({})
db.episodes.deleteMany({})
```

### Q4: 支持多用户并发吗？

✅ 完全支持。每个用户有独立的：
- 会话空间
- 心理学画像
- 长期记忆
- 上下文优化

### Q5: 如何添加新的疗法？

1. 在 `therapy-methods.yml` 中添加新疗法配置
2. 重启服务
3. 新疗法会自动加载

### Q6: 如何自定义系统提示词？

编辑 `therapy-methods.yml` 中对应疗法的 `system-instruction` 字段。

---

## 技术支持

- 📧 技术问题：提交 GitHub Issue
- 📚 文档：`docs/开发/CONTEXT_ENGINE_V3_COMPLETE_GUIDE.md`
- 🧪 测试：`aistudio/backend/src/test/java/com/heartsphere/aistudio/service/psychology/`

---

## 版本历史

- **v1.0.0** (2025-12-27)
  - ✅ 初始版本
  - ✅ 5 种疗法支持
  - ✅ 17 个临床案例
  - ✅ 完整的上下文管理
  - ✅ 心理学事实提取

---

**免责声明**: 本系统提供心理教育和模拟练习，不能替代专业医疗诊断。如遇严重心理危机，请立即寻求专业医疗帮助。

📞 中国心理危机干预热线：400-161-9995
