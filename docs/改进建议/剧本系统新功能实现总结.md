# å‰§æœ¬ç³»ç»Ÿæ–°åŠŸèƒ½å®ç°æ€»ç»“

## âœ… å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

### 1. æ¡ä»¶åˆ†æ”¯ç³»ç»Ÿ
- **ç±»å‹å®šä¹‰**ï¼šåœ¨ `StoryOption` ä¸­æ·»åŠ äº† `conditions` å­—æ®µ
- **æ¡ä»¶ç±»å‹**ï¼šæ”¯æŒå¥½æ„Ÿåº¦ã€äº‹ä»¶ã€ç‰©å“ã€æ—¶é—´ç­‰æ¡ä»¶æ£€æŸ¥
- **è¿ç®—ç¬¦**ï¼šæ”¯æŒ `>=`, `<=`, `==`, `!=`, `>`, `<`, `has`, `not_has`
- **é€»è¾‘**ï¼šæ‰€æœ‰æ¡ä»¶å¿…é¡»æ»¡è¶³ï¼ˆANDé€»è¾‘ï¼‰æ‰ä¼šæ˜¾ç¤ºé€‰é¡¹
- **å®ç°ä½ç½®**ï¼š`ChatWindow.tsx` çš„ `checkOptionConditions` å’Œ `renderChoices` å‡½æ•°

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```json
{
  "id": "opt_1",
  "text": "éšè—é€‰é¡¹ï¼ˆéœ€è¦å¥½æ„Ÿåº¦>=50ï¼‰",
  "nextNodeId": "node_2",
  "conditions": [
    {
      "type": "favorability",
      "target": "character_123",
      "operator": ">=",
      "value": 50
    }
  ]
}
```

### 2. å¤šè§’è‰²äº’åŠ¨ç³»ç»Ÿ
- **ç±»å‹å®šä¹‰**ï¼šåœ¨ `StoryNode` ä¸­æ·»åŠ äº† `multiCharacterDialogue` å­—æ®µ
- **åŠŸèƒ½**ï¼šæ”¯æŒå¤šä¸ªè§’è‰²åœ¨åŒä¸€èŠ‚ç‚¹ä¸­è¿›è¡Œå¯¹è¯
- **é¡ºåºæ§åˆ¶**ï¼šé€šè¿‡ `order` å­—æ®µæ§åˆ¶å¯¹è¯æ˜¾ç¤ºé¡ºåº
- **å®ç°ä½ç½®**ï¼š`ChatWindow.tsx` çš„ `handleScenarioTransition` å‡½æ•°

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```json
{
  "id": "node_1",
  "title": "å¤šäººå¯¹è¯åœºæ™¯",
  "multiCharacterDialogue": [
    {
      "characterId": "char_1",
      "content": "ä½ å¥½ï¼",
      "order": 1
    },
    {
      "characterId": "char_2",
      "content": "å¾ˆé«˜å…´è§åˆ°ä½ ï¼",
      "order": 2
    }
  ]
}
```

### 3. å¤šç»“å±€ç³»ç»Ÿ
- **èŠ‚ç‚¹ç±»å‹**ï¼šæ·»åŠ äº† `ending` èŠ‚ç‚¹ç±»å‹
- **æ˜¾ç¤º**ï¼šç»“å±€èŠ‚ç‚¹ä¼šåœ¨å†…å®¹å‰æ·»åŠ ã€ç»“å±€ã€‘æ ‡è®°
- **å®ç°ä½ç½®**ï¼š`ChatWindow.tsx` çš„ `handleScenarioTransition` å‡½æ•°

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```json
{
  "id": "ending_good",
  "title": "å¥½ç»“å±€",
  "nodeType": "ending",
  "prompt": "ä½ ä»¬ä»æ­¤è¿‡ä¸Šäº†å¹¸ç¦çš„ç”Ÿæ´»...",
  "options": []
}
```

### 4. éšæœºäº‹ä»¶ç³»ç»Ÿ
- **ç±»å‹å®šä¹‰**ï¼šåœ¨ `StoryNode` ä¸­æ·»åŠ äº† `randomEvents` å­—æ®µ
- **åŠŸèƒ½**ï¼šè¿›å…¥èŠ‚ç‚¹æ—¶æŒ‰æ¦‚ç‡è§¦å‘éšæœºäº‹ä»¶
- **æ•ˆæœ**ï¼šå¯ä»¥è§¦å‘äº‹ä»¶ã€ç‰©å“ã€å¥½æ„Ÿåº¦å˜åŒ–
- **å®ç°ä½ç½®**ï¼š`ChatWindow.tsx` çš„ `handleScenarioTransition` å‡½æ•°

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```json
{
  "id": "node_1",
  "randomEvents": [
    {
      "id": "random_1",
      "probability": 0.3,
      "effect": {
        "type": "item",
        "target": "item_key"
      }
    }
  ]
}
```

### 5. æ—¶é—´ç³»ç»Ÿ
- **çŠ¶æ€è¿½è¸ª**ï¼šæ·»åŠ äº† `startTime` å’Œ `currentTime` å­—æ®µ
- **é™æ—¶èŠ‚ç‚¹**ï¼šæ”¯æŒ `timeLimit`ï¼ˆç§’ï¼‰å’Œ `timeoutNodeId`
- **åŠŸèƒ½**ï¼šè¶…æ—¶åè‡ªåŠ¨è·³è½¬åˆ°æŒ‡å®šèŠ‚ç‚¹
- **å®ç°ä½ç½®**ï¼š`ChatWindow.tsx` çš„ `handleScenarioTransition` å‡½æ•°

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```json
{
  "id": "node_timed",
  "title": "é™æ—¶é€‰æ‹©",
  "timeLimit": 30,
  "timeoutNodeId": "node_timeout",
  "prompt": "ä½ å¿…é¡»åœ¨30ç§’å†…åšå‡ºé€‰æ‹©..."
}
```

### 6. è®¿é—®èŠ‚ç‚¹è¿½è¸ª
- **çŠ¶æ€è¿½è¸ª**ï¼šæ·»åŠ äº† `visitedNodes` å­—æ®µ
- **åŠŸèƒ½**ï¼šè®°å½•ç©å®¶å·²è®¿é—®çš„èŠ‚ç‚¹ï¼Œå¯ç”¨äºåç»­åŠŸèƒ½æ‰©å±•
- **å®ç°ä½ç½®**ï¼š`ChatWindow.tsx` å’Œ `gameStateReducer.ts`

## ğŸ“ ç¼–è¾‘å™¨æ”¯æŒçŠ¶æ€

### å·²å®ç°
- âœ… çŠ¶æ€å½±å“ç¼–è¾‘ï¼ˆeffectsï¼‰ - ScenarioBuilder å’Œ MobileScenarioBuilder
- âœ… èŠ‚ç‚¹ç±»å‹é€‰æ‹©ï¼ˆfixed/ai-dynamicï¼‰

### å¾…å®Œå–„ï¼ˆéœ€è¦åœ¨ç¼–è¾‘å™¨ä¸­æ·»åŠ UIï¼‰
- â³ æ¡ä»¶ç¼–è¾‘UIï¼ˆconditionsï¼‰
- â³ å¤šè§’è‰²å¯¹è¯ç¼–è¾‘UIï¼ˆmultiCharacterDialogueï¼‰
- â³ éšæœºäº‹ä»¶ç¼–è¾‘UIï¼ˆrandomEventsï¼‰
- â³ æ—¶é—´ç³»ç»Ÿç¼–è¾‘UIï¼ˆtimeLimit, timeoutNodeIdï¼‰
- â³ ç»“å±€èŠ‚ç‚¹ç±»å‹é€‰æ‹©

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. æ¡ä»¶åˆ†æ”¯
åœ¨é€‰é¡¹JSONä¸­æ·»åŠ  `conditions` æ•°ç»„ï¼š
```json
{
  "conditions": [
    {
      "type": "favorability",
      "target": "character_id",
      "operator": ">=",
      "value": 50
    },
    {
      "type": "event",
      "target": "event_met_character",
      "operator": "has"
    }
  ]
}
```

### 2. å¤šè§’è‰²å¯¹è¯
åœ¨èŠ‚ç‚¹JSONä¸­æ·»åŠ  `multiCharacterDialogue` æ•°ç»„ï¼š
```json
{
  "multiCharacterDialogue": [
    {
      "characterId": "char_1",
      "content": "è§’è‰²1çš„å¯¹è¯",
      "order": 1
    }
  ]
}
```

### 3. éšæœºäº‹ä»¶
åœ¨èŠ‚ç‚¹JSONä¸­æ·»åŠ  `randomEvents` æ•°ç»„ï¼š
```json
{
  "randomEvents": [
    {
      "id": "event_1",
      "probability": 0.5,
      "effect": {
        "type": "event",
        "target": "random_event_triggered"
      }
    }
  ]
}
```

### 4. æ—¶é—´ç³»ç»Ÿ
åœ¨èŠ‚ç‚¹JSONä¸­æ·»åŠ æ—¶é—´é™åˆ¶ï¼š
```json
{
  "timeLimit": 60,
  "timeoutNodeId": "node_timeout"
}
```

### 5. ç»“å±€èŠ‚ç‚¹
è®¾ç½®èŠ‚ç‚¹ç±»å‹ä¸º `ending`ï¼š
```json
{
  "nodeType": "ending",
  "prompt": "ç»“å±€å†…å®¹..."
}
```

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **æ¡ä»¶æ£€æŸ¥**ï¼šæ‰€æœ‰æ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³ï¼ˆANDé€»è¾‘ï¼‰
2. **å¥½æ„Ÿåº¦èŒƒå›´**ï¼šå¥½æ„Ÿåº¦å€¼é™åˆ¶åœ¨ 0-100 ä¹‹é—´
3. **äº‹ä»¶/ç‰©å“å»é‡**ï¼šç›¸åŒçš„äº‹ä»¶æˆ–ç‰©å“IDä¸ä¼šé‡å¤æ·»åŠ 
4. **æ—¶é—´ç³»ç»Ÿ**ï¼š`timeLimit` ä»¥ç§’ä¸ºå•ä½
5. **å‘åå…¼å®¹**ï¼šæ‰€æœ‰æ–°å­—æ®µéƒ½æ˜¯å¯é€‰çš„ï¼Œä¸å½±å“ç°æœ‰å‰§æœ¬

## ğŸ”„ åç»­å·¥ä½œå»ºè®®

1. åœ¨ ScenarioBuilder ä¸­æ·»åŠ å®Œæ•´çš„ç¼–è¾‘UI
2. æ·»åŠ æ¡ä»¶é¢„è§ˆåŠŸèƒ½ï¼ˆæ˜¾ç¤ºå“ªäº›é€‰é¡¹ä¼šè¢«éšè—ï¼‰
3. æ·»åŠ æ—¶é—´ç³»ç»Ÿçš„å¯è§†åŒ–æ˜¾ç¤º
4. æ·»åŠ ç»“å±€ç»Ÿè®¡åŠŸèƒ½ï¼ˆè®°å½•ç©å®¶è¾¾åˆ°çš„ç»“å±€ï¼‰
5. ä¼˜åŒ–éšæœºäº‹ä»¶çš„è§¦å‘åé¦ˆ

