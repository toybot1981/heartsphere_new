# é˜¶æ®µä¸€ï¼šåŸºç¡€è®°å¿†ç³»ç»Ÿ - å¼€å‘æ€»ç»“

**æ–‡æ¡£ç‰ˆæœ¬**: V1.0  
**ç¼–å†™æ—¥æœŸ**: 2025-12-28

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. é¡¹ç›®ç»“æ„ âœ…

å·²åˆ›å»ºå®Œæ•´çš„åŒ…ç»“æ„ï¼š
```
backend/src/main/java/com/heartsphere/memory/
â”œâ”€â”€ model/              # æ•°æ®æ¨¡å‹ï¼ˆ13ä¸ªæ–‡ä»¶ï¼‰
â”œâ”€â”€ service/            # æœåŠ¡æ¥å£ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰
â”œâ”€â”€ service/impl/       # æœåŠ¡å®ç°ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
â”œâ”€â”€ repository/         # Repositoryï¼ˆå¾…åˆ›å»ºï¼‰
â”œâ”€â”€ controller/         # REST APIï¼ˆå¾…åˆ›å»ºï¼‰
â””â”€â”€ config/            # é…ç½®ç±»ï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰
```

### 2. æ•°æ®æ¨¡å‹ âœ…

å·²åˆ›å»ºæ‰€æœ‰å¿…è¦çš„æ•°æ®æ¨¡å‹ï¼š
- âœ… `ChatMessage` - å¯¹è¯æ¶ˆæ¯
- âœ… `UserFact` - ç”¨æˆ·äº‹å®
- âœ… `UserPreference` - ç”¨æˆ·åå¥½
- âœ… `UserMemory` - ç”¨æˆ·è®°å¿†
- âœ… `ConversationContext` - å¯¹è¯ä¸Šä¸‹æ–‡
- âœ… `UserProfile` - ç”¨æˆ·ç”»åƒ
- âœ… æ‰€æœ‰æšä¸¾ç±»ï¼ˆMessageRole, FactCategory, PreferenceTypeç­‰ï¼‰

### 3. æœåŠ¡æ¥å£ âœ…

å·²å®šä¹‰æ‰€æœ‰æœåŠ¡æ¥å£ï¼š
- âœ… `ShortMemoryService` - çŸ­æœŸè®°å¿†æœåŠ¡æ¥å£
- âœ… `LongMemoryService` - é•¿æœŸè®°å¿†æœåŠ¡æ¥å£
- âœ… `MemoryExtractor` - è®°å¿†æå–å™¨æ¥å£
- âœ… `MemoryManager` - è®°å¿†ç®¡ç†å™¨æ¥å£

### 4. æœåŠ¡å®ç° âœ…

å·²å®ç°ï¼š
- âœ… `RedisShortMemoryService` - RedisçŸ­æœŸè®°å¿†æœåŠ¡å®ç°

### 5. é…ç½® âœ…

- âœ… æ·»åŠ Rediså’ŒMongoDBä¾èµ–åˆ°pom.xml
- âœ… é…ç½®application.ymlï¼ˆRediså’ŒMongoDBè¿æ¥ï¼‰
- âœ… åˆ›å»ºRedisConfigé…ç½®ç±»
- âœ… åˆ›å»ºMongoConfigé…ç½®ç±»
- âœ… åˆ›å»ºMemoryPropertiesé…ç½®å±æ€§ç±»
- âœ… åˆ›å»ºMongoDBç´¢å¼•åˆå§‹åŒ–è„šæœ¬

---

## ğŸš§ ä¸‹ä¸€æ­¥å·¥ä½œ

### ç«‹å³å¼€å§‹ï¼ˆWeek 1-2ï¼‰

1. **å®Œå–„RedisShortMemoryServiceæµ‹è¯•**
   - ç¼–å†™å•å…ƒæµ‹è¯•
   - æµ‹è¯•æ‰€æœ‰æ–¹æ³•
   - æµ‹è¯•è¾¹ç•Œæƒ…å†µ

2. **åˆ›å»ºMongoDB Repository**
   - `UserFactRepository`
   - `UserPreferenceRepository`
   - `UserMemoryRepository`

3. **å®ç°MongoLongMemoryService**
   - å®ç°ç”¨æˆ·äº‹å®CRUD
   - å®ç°ç”¨æˆ·åå¥½CRUD
   - å®ç°è®°å¿†æ£€ç´¢

---

## ğŸ“ å·²åˆ›å»ºçš„æ–‡ä»¶æ¸…å•

### æ•°æ®æ¨¡å‹ï¼ˆ13ä¸ªæ–‡ä»¶ï¼‰

1. `model/MessageRole.java`
2. `model/ChatMessage.java`
3. `model/FactCategory.java`
4. `model/UserFact.java`
5. `model/PreferenceType.java`
6. `model/UserPreference.java`
7. `model/MemoryType.java`
8. `model/MemoryImportance.java`
9. `model/MemorySource.java`
10. `model/UserMemory.java`
11. `model/ConversationContext.java`
12. `model/UserProfile.java`

### æœåŠ¡æ¥å£ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰

1. `service/ShortMemoryService.java`
2. `service/LongMemoryService.java`
3. `service/MemoryExtractor.java`
4. `service/MemoryManager.java`

### æœåŠ¡å®ç°ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰

1. `service/impl/RedisShortMemoryService.java`

### é…ç½®ç±»ï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰

1. `config/RedisConfig.java`
2. `config/MongoConfig.java`
3. `config/MemoryProperties.java`

### é…ç½®æ–‡ä»¶

1. `resources/db/mongodb/init-indexes.js` - MongoDBç´¢å¼•è„šæœ¬

### æ–‡æ¡£

1. `é˜¶æ®µä¸€å¼€å‘ä»»åŠ¡æ¸…å•.md` - è¯¦ç»†ä»»åŠ¡æ¸…å•
2. `é˜¶æ®µä¸€å¼€å‘å¯åŠ¨æŒ‡å—.md` - å¼€å‘å¯åŠ¨æŒ‡å—
3. `é˜¶æ®µä¸€å¼€å‘è¿›åº¦.md` - å¼€å‘è¿›åº¦è·Ÿè¸ª
4. `é˜¶æ®µä¸€å¼€å‘æ€»ç»“.md` - æœ¬æ–‡æ¡£

---

## ğŸ”§ é…ç½®è¯´æ˜

### application.ymlé…ç½®

å·²æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```yaml
spring:
  data:
    redis:
      host: localhost
      port: 6379
      database: 0
      timeout: 2000ms
    mongodb:
      uri: mongodb://localhost:27017/heartsphere

heartsphere:
  memory:
    short-memory:
      message-ttl: 604800  # 7å¤©
      max-messages-per-session: 100
      working-memory-ttl: 86400  # 24å°æ—¶
    long-memory:
      extraction-importance-threshold: 0.7
      extraction-confidence-threshold: 0.6
    extraction:
      enable-llm-extraction: true
      enable-rule-extraction: true
      batch-size: 10
```

### pom.xmlä¾èµ–

å·²æ·»åŠ ï¼š
- `spring-boot-starter-data-redis`
- `spring-boot-starter-data-mongodb`

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æ•°æ®åº“

```bash
# å¯åŠ¨Rediså’ŒMongoDB
./scripts/start-databases.sh
```

### 2. åˆå§‹åŒ–MongoDBç´¢å¼•

```bash
mongosh heartsphere < backend/src/main/resources/db/mongodb/init-indexes.js
```

### 3. ç¼–è¯‘é¡¹ç›®

```bash
cd backend
mvn clean compile
```

### 4. è¿è¡Œæµ‹è¯•

```bash
mvn test
```

---

## ğŸ“ å¼€å‘å»ºè®®

### 1. å¼€å‘é¡ºåº

å»ºè®®æŒ‰ç…§ä»¥ä¸‹é¡ºåºå¼€å‘ï¼š

1. **Week 1-2**ï¼šå®Œå–„çŸ­æœŸè®°å¿†ç³»ç»Ÿ
   - å®Œå–„RedisShortMemoryService
   - ç¼–å†™å•å…ƒæµ‹è¯•
   - æ€§èƒ½æµ‹è¯•

2. **Week 3-4**ï¼šå®ç°é•¿æœŸè®°å¿†ç³»ç»Ÿ
   - åˆ›å»ºRepository
   - å®ç°MongoLongMemoryService
   - ç¼–å†™å•å…ƒæµ‹è¯•

3. **Week 5**ï¼šå®ç°è®°å¿†æå–å’Œæ£€ç´¢
   - å®ç°MemoryExtractor
   - å®ç°MemoryManager
   - ç¼–å†™å•å…ƒæµ‹è¯•

4. **Week 6**ï¼šå®ç°APIå’Œé›†æˆæµ‹è¯•
   - å®ç°MemoryController
   - ç¼–å†™é›†æˆæµ‹è¯•
   - ç¼–å†™æ–‡æ¡£

### 2. ä»£ç è§„èŒƒ

- ä½¿ç”¨Lombokç®€åŒ–ä»£ç 
- æ·»åŠ å¿…è¦çš„JavaDocæ³¨é‡Š
- ä½¿ç”¨ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†
- æ·»åŠ æ—¥å¿—è®°å½•

### 3. æµ‹è¯•ç­–ç•¥

- æ¯ä¸ªåŠŸèƒ½å®Œæˆåç«‹å³ç¼–å†™æµ‹è¯•
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- é›†æˆæµ‹è¯•è¦†ç›–ä¸»è¦æµç¨‹

---

## ğŸ¯ å½“å‰çŠ¶æ€

**å®Œæˆåº¦**ï¼š30%

**å·²å®Œæˆ**ï¼š
- âœ… é¡¹ç›®ç»“æ„æ­å»º
- âœ… æ•°æ®æ¨¡å‹å®šä¹‰
- âœ… æœåŠ¡æ¥å£å®šä¹‰
- âœ… é…ç½®ç±»åˆ›å»º
- âœ… RedisçŸ­æœŸè®°å¿†æœåŠ¡åŸºç¡€å®ç°

**è¿›è¡Œä¸­**ï¼š
- ğŸš§ RedisçŸ­æœŸè®°å¿†æœåŠ¡å®Œå–„å’Œæµ‹è¯•

**å¾…å®Œæˆ**ï¼š
- â³ MongoDB Repository
- â³ MongoLongMemoryService
- â³ MemoryExtractor
- â³ MemoryManager
- â³ REST API

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [é˜¶æ®µä¸€è¯¦ç»†è®¾è®¡](./02-é˜¶æ®µä¸€ï¼šåŸºç¡€è®°å¿†ç³»ç»Ÿ.md)
- [å¼€å‘ä»»åŠ¡æ¸…å•](./é˜¶æ®µä¸€å¼€å‘ä»»åŠ¡æ¸…å•.md)
- [å¼€å‘å¯åŠ¨æŒ‡å—](./é˜¶æ®µä¸€å¼€å‘å¯åŠ¨æŒ‡å—.md)
- [å¼€å‘è¿›åº¦](./é˜¶æ®µä¸€å¼€å‘è¿›åº¦.md)

---

**ç»§ç»­å¼€å‘ï¼** ğŸš€

