# 记忆系统快速优化实施指南

**文档版本**: V1.0  
**编写日期**: 2025-12-29

---

## 🚀 快速优化（30分钟内完成）

### 1. MongoDB索引优化（5分钟）

**执行**:
```bash
# 确保索引已创建
mongosh heartsphere < backend/src/main/resources/db/mongodb/init-indexes.js
```

**验证**:
```bash
mongosh heartsphere --eval "db.user_memories.getIndexes()"
```

---

### 2. Redis连接池优化（5分钟）

**修改**: `application.yml`

```yaml
spring:
  data:
    redis:
      lettuce:
        pool:
          max-active: 20      # 从8增加到20
          max-idle: 10        # 从8增加到10
          min-idle: 5         # 新增
          max-wait: 2000ms    # 新增
```

**效果**: 提高并发处理能力

---

### 3. MongoDB连接池优化（5分钟）

**修改**: `application.yml`

```yaml
spring:
  data:
    mongodb:
      options:
        max-pool-size: 100
        min-pool-size: 10
        max-idle-time-ms: 30000
```

**效果**: 提高数据库连接效率

---

### 4. 异步处理优化（10分钟）

**修改**: `MemoryManagerImpl.java`

```java
@Bean
public Executor memoryExtractionExecutor() {
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
    executor.setCorePoolSize(5);
    executor.setMaxPoolSize(10);
    executor.setQueueCapacity(100);
    executor.setThreadNamePrefix("memory-extraction-");
    executor.initialize();
    return executor;
}
```

**效果**: 优化异步记忆提取性能

---

### 5. 日志级别优化（5分钟）

**修改**: `application.yml`

```yaml
logging:
  level:
    com.heartsphere.memory: DEBUG  # 开发环境
    # com.heartsphere.memory: INFO  # 生产环境
```

**效果**: 更好的调试能力

---

## 📊 优化效果预期

### 性能提升

- **Redis操作**: 提升 20-30%
- **MongoDB查询**: 提升 30-40%
- **并发处理**: 提升 50%+

### 资源使用

- **连接数**: 更合理的使用
- **内存**: 优化后可能略有增加
- **CPU**: 异步处理减少阻塞

---

## ✅ 优化检查清单

- [ ] MongoDB索引已创建
- [ ] Redis连接池已优化
- [ ] MongoDB连接池已优化
- [ ] 异步处理已优化
- [ ] 日志级别已调整
- [ ] 测试通过
- [ ] 性能验证

---

## 🎯 下一步

优化完成后：
1. 运行测试验证
2. 执行性能测试
3. 监控系统指标
4. 根据结果进一步优化

---

**快速优化完成！** ✅

