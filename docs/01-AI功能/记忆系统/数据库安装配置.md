# Redis和MongoDB安装配置指南

**文档版本**: V1.0  
**编写日期**: 2025-12-28

---

## 一、安装状态

### ✅ 当前状态

- **Redis**: 已安装 (v7.2.3)，正在运行
- **MongoDB**: 已安装 (v7.0.2)，正在运行

---

## 二、服务管理

### 2.1 快速启动/停止

使用项目提供的脚本：

```bash
# 启动所有数据库服务
./scripts/start-databases.sh

# 停止所有数据库服务
./scripts/stop-databases.sh
```

### 2.2 手动管理

#### Redis

**启动Redis**:
```bash
redis-server
# 或后台运行
redis-server --daemonize yes
```

**停止Redis**:
```bash
redis-cli shutdown
```

**连接Redis**:
```bash
redis-cli
# 测试连接
redis-cli ping  # 应该返回 PONG
```

**Redis配置**:
- 默认端口: `6379`
- 配置文件: `/usr/local/etc/redis.conf`
- 数据目录: `/usr/local/var/db/redis/`

#### MongoDB

**启动MongoDB**:
```bash
mongod --dbpath /usr/local/var/mongodb \
       --logpath /usr/local/var/log/mongodb/mongo.log \
       --fork
```

**停止MongoDB**:
```bash
# 方式1: 使用mongosh
mongosh admin --eval "db.shutdownServer()"

# 方式2: 使用mongo (旧版本)
mongo admin --eval "db.shutdownServer()"

# 方式3: 强制停止
pkill mongod
```

**连接MongoDB**:
```bash
# 使用mongosh (推荐)
mongosh

# 或使用mongo (旧版本)
mongo
```

**MongoDB配置**:
- 默认端口: `27017`
- 数据目录: `/usr/local/var/mongodb`
- 日志目录: `/usr/local/var/log/mongodb/`

---

## 三、验证安装

### 3.1 验证Redis

```bash
# 测试连接
redis-cli ping
# 应该返回: PONG

# 查看版本
redis-cli info server | grep redis_version
# 应该显示: redis_version:7.2.3
```

### 3.2 验证MongoDB

```bash
# 测试连接
mongosh --eval "db.version()"
# 应该返回: 7.0.2

# 或使用mongo
mongo --eval "db.version()"
```

---

## 四、Spring Boot配置

### 4.1 Redis配置

在 `application.yml` 中配置：

```yaml
spring:
  data:
    redis:
      host: localhost
      port: 6379
      password: # 如果设置了密码
      database: 0
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
```

### 4.2 MongoDB配置

在 `application.yml` 中配置：

```yaml
spring:
  data:
    mongodb:
      uri: mongodb://localhost:27017/heartsphere
      # 或分别配置
      # host: localhost
      # port: 27017
      # database: heartsphere
```

---

## 五、常用操作

### 5.1 Redis常用命令

```bash
# 连接Redis
redis-cli

# 查看所有key
KEYS *

# 查看key的值
GET key_name

# 设置key
SET key_name value

# 删除key
DEL key_name

# 查看数据库信息
INFO

# 清空当前数据库
FLUSHDB

# 清空所有数据库
FLUSHALL
```

### 5.2 MongoDB常用命令

```bash
# 连接MongoDB
mongosh

# 查看所有数据库
show dbs

# 使用数据库
use heartsphere

# 查看所有集合
show collections

# 查询集合
db.collection_name.find()

# 统计文档数量
db.collection_name.count()

# 删除集合
db.collection_name.drop()

# 删除数据库
db.dropDatabase()
```

---

## 六、故障排查

### 6.1 Redis问题

**问题**: Redis无法启动
```bash
# 检查端口是否被占用
lsof -i :6379

# 检查Redis日志
tail -f /usr/local/var/log/redis.log
```

**问题**: Redis连接失败
```bash
# 检查Redis是否运行
pgrep -f redis-server

# 检查防火墙设置
```

### 6.2 MongoDB问题

**问题**: MongoDB无法启动
```bash
# 检查端口是否被占用
lsof -i :27017

# 检查数据目录权限
ls -la /usr/local/var/mongodb

# 查看MongoDB日志
tail -f /usr/local/var/log/mongodb/mongo.log
```

**问题**: MongoDB连接失败
```bash
# 检查MongoDB是否运行
pgrep -f mongod

# 检查数据目录锁文件
rm /usr/local/var/mongodb/mongod.lock  # 如果MongoDB异常退出
```

---

## 七、性能优化建议

### 7.1 Redis优化

1. **内存限制**: 在配置文件中设置 `maxmemory` 和 `maxmemory-policy`
2. **持久化**: 根据需要配置 RDB 或 AOF
3. **连接池**: 在应用中使用连接池

### 7.2 MongoDB优化

1. **索引**: 为常用查询字段创建索引
2. **分片**: 大数据量时考虑分片
3. **副本集**: 生产环境建议使用副本集

---

## 八、安全建议

### 8.1 Redis安全

1. **设置密码**: 在配置文件中设置 `requirepass`
2. **绑定IP**: 限制Redis只监听本地IP
3. **禁用危险命令**: 禁用 `FLUSHALL`、`CONFIG` 等命令

### 8.2 MongoDB安全

1. **启用认证**: 创建用户并启用认证
2. **网络隔离**: 限制MongoDB只监听本地IP
3. **定期备份**: 定期备份数据库

---

## 九、总结

✅ **Redis和MongoDB已成功安装并运行**

- Redis: `localhost:6379`
- MongoDB: `localhost:27017`

可以使用提供的脚本快速启动和停止服务，或手动管理。建议在生产环境中配置认证和备份策略。

