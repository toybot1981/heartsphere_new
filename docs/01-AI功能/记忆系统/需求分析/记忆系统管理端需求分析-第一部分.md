# 记忆系统管理端需求分析 - 第一部分：总体概述与基础管理

**文档版本**: V1.0  
**编写日期**: 2025-12-29  
**功能模块**: 记忆系统管理端  
**目标**: 为记忆系统提供后台管理功能，支持管理员对记忆系统进行监控、配置和管理

---

## 一、需求概述

### 1.1 背景

记忆系统是HeartSphere的核心功能之一，包括短时记忆和长时记忆两个层次。为了确保记忆系统的正常运行和优化，需要提供完善的后台管理功能，让管理员能够：

1. **监控系统状态**：实时监控记忆系统的运行状态
2. **管理记忆数据**：管理用户记忆数据的存储和检索
3. **配置系统参数**：配置记忆系统的各项参数
4. **查看统计分析**：查看记忆系统的使用统计和分析数据
5. **处理异常情况**：处理系统异常和数据问题

### 1.2 核心功能模块

管理端分为以下几个部分：

**第一部分：总体概述与基础管理**
- 系统概览
- 基础配置管理
- 用户记忆管理

**第二部分：短时记忆管理**
- 短时记忆监控
- 会话管理
- 缓存管理

**第三部分：长时记忆管理**
- 长时记忆数据管理
- 记忆提取管理
- 记忆检索管理

**第四部分：统计分析与管理工具**
- 使用统计分析
- 性能监控
- 数据维护工具

### 1.3 设计原则

1. **简洁易用**：管理界面简洁直观，易于操作
2. **权限控制**：严格权限控制，确保数据安全
3. **实时监控**：提供实时监控功能，及时发现问题
4. **数据保护**：保护用户隐私，敏感数据脱敏处理
5. **可扩展性**：设计可扩展，支持未来功能扩展

---

## 二、系统概览

### 2.1 仪表板

#### 2.1.1 功能描述

提供记忆系统的整体概览，显示关键指标和状态信息。

#### 2.1.2 关键指标

**1. 系统状态**

- **系统运行状态**：正常运行/异常/维护中
- **服务可用性**：服务可用率（如99.9%）
- **最后更新时间**：数据最后更新时间

**2. 数据统计**

- **用户总数**：使用记忆系统的用户总数
- **活跃用户数**：最近24小时/7天的活跃用户数
- **记忆数据总量**：短时记忆和长时记忆的数据总量
- **记忆提取总数**：累计记忆提取次数
- **记忆检索总数**：累计记忆检索次数

**3. 性能指标**

- **平均响应时间**：记忆检索的平均响应时间
- **成功率**：操作成功率
- **错误率**：操作错误率
- **缓存命中率**：缓存命中率

**4. 趋势图表**

- **用户增长趋势**：用户数量增长趋势图
- **使用量趋势**：记忆使用量趋势图
- **性能趋势**：系统性能趋势图

#### 2.1.3 实时监控

- **实时数据更新**：关键指标实时更新
- **异常告警**：系统异常时显示告警信息
- **快速操作**：提供快速操作入口

---

### 2.2 导航菜单

#### 2.2.1 菜单结构

- **系统概览**：仪表板
- **基础管理**
  - 系统配置
  - 用户记忆管理
- **短时记忆管理**
  - 会话监控
  - 缓存管理
- **长时记忆管理**
  - 记忆数据管理
  - 提取管理
  - 检索管理
- **统计分析**
  - 使用统计
  - 性能分析
- **系统工具**
  - 数据维护
  - 日志查询

---

## 三、基础配置管理

### 3.1 系统配置

#### 3.1.1 功能描述

管理记忆系统的全局配置参数。

#### 3.1.2 配置项

**1. 短时记忆配置**

- **存储方式**：Redis配置（地址、端口、密码等）
- **会话过期时间**：会话数据的过期时间
- **最大会话数**：每个用户的最大会话数
- **缓存容量**：缓存的最大容量限制

**2. 长时记忆配置**

- **存储方式**：MongoDB配置（地址、端口、数据库名等）
- **集合名称**：各类型记忆数据的集合名称
- **索引配置**：索引配置和优化
- **数据保留策略**：数据的保留期限和归档策略

**3. 记忆提取配置**

- **提取策略**：自动提取/手动提取
- **提取频率**：记忆提取的频率设置
- **提取规则**：记忆提取的规则配置
- **提取模型**：使用的提取模型配置

**4. 记忆检索配置**

- **检索策略**：检索策略配置（滚动窗口、摘要等）
- **检索数量**：每次检索返回的记忆数量
- **检索优先级**：记忆检索的优先级设置

#### 3.1.3 配置管理

- **查看配置**：查看当前配置
- **修改配置**：修改配置参数（需要权限）
- **配置验证**：修改前验证配置有效性
- **配置保存**：保存配置更改
- **配置历史**：查看配置变更历史
- **配置回滚**：回滚到之前的配置版本

---

### 3.2 用户记忆管理

#### 3.2.1 功能描述

管理用户的记忆数据，包括查看、搜索、删除等操作。

#### 3.2.2 用户搜索

- **用户ID搜索**：按用户ID搜索
- **用户名搜索**：按用户名搜索
- **邮箱搜索**：按邮箱搜索
- **高级搜索**：多条件组合搜索

#### 3.2.3 用户记忆查看

**1. 基本信息**

- **用户ID**：用户唯一标识
- **用户名**：用户名称
- **注册时间**：用户注册时间
- **最后活动时间**：用户最后活动时间

**2. 记忆统计**

- **短时记忆数量**：当前会话数量
- **长时记忆数量**：长时记忆数据总数
- **用户偏好数量**：用户偏好记录数
- **用户事实数量**：用户事实记录数
- **事件数量**：事件记录数

**3. 记忆列表**

- **记忆类型**：偏好/事实/事件
- **记忆内容**：记忆内容预览（脱敏后）
- **创建时间**：记忆创建时间
- **最后更新时间**：最后更新时间
- **重要性评分**：记忆的重要性评分

#### 3.2.4 记忆操作

- **查看详情**：查看记忆的详细信息
- **编辑记忆**：编辑记忆内容（需要权限）
- **删除记忆**：删除指定的记忆（需要权限和确认）
- **批量操作**：批量删除、导出等操作
- **导出数据**：导出用户的记忆数据（用于备份或分析）

#### 3.2.5 隐私保护

- **数据脱敏**：显示的数据进行脱敏处理
- **权限控制**：敏感操作需要权限确认
- **操作日志**：记录所有操作日志
- **数据加密**：敏感数据加密存储和传输

---

## 四、权限管理

### 4.1 角色权限

#### 4.1.1 角色定义

- **超级管理员**：拥有所有权限
- **系统管理员**：拥有系统配置和管理权限
- **数据管理员**：拥有数据查看和管理权限
- **运维人员**：拥有监控和日志查看权限
- **普通管理员**：拥有基础的查看权限

#### 4.1.2 权限列表

**1. 系统配置权限**

- 查看系统配置
- 修改系统配置
- 查看配置历史
- 回滚配置

**2. 用户数据权限**

- 查看用户列表
- 查看用户记忆数据
- 编辑用户记忆（受限）
- 删除用户记忆（受限）
- 导出用户数据

**3. 监控权限**

- 查看系统监控
- 查看统计数据
- 查看性能指标
- 查看告警信息

**4. 日志权限**

- 查看操作日志
- 查看系统日志
- 导出日志

---

## 五、数据结构设计

### 5.1 系统配置表

**表名**: `memory_system_configs`

**字段设计**:
- `id` (BIGINT, PRIMARY KEY): 配置ID
- `config_key` (VARCHAR, NOT NULL, UNIQUE): 配置键
- `config_value` (TEXT, NOT NULL): 配置值（JSON格式）
- `config_type` (VARCHAR, NOT NULL): 配置类型（short_term/long_term/extraction/retrieval）
- `description` (TEXT): 配置说明
- `is_enabled` (BOOLEAN, DEFAULT TRUE): 是否启用
- `updated_at` (DATETIME, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP): 更新时间
- `updated_by` (BIGINT): 更新人ID

**索引**:
- `idx_config_key` (config_key)
- `idx_config_type` (config_type)

---

### 5.2 配置变更日志表

**表名**: `memory_config_change_logs`

**字段设计**:
- `id` (BIGINT, PRIMARY KEY): 日志ID
- `config_id` (BIGINT, NOT NULL): 配置ID
- `change_type` (VARCHAR, NOT NULL): 变更类型（create/update/delete）
- `old_value` (TEXT): 旧值
- `new_value` (TEXT): 新值
- `change_reason` (TEXT): 变更原因
- `changed_by` (BIGINT, NOT NULL): 变更人ID
- `changed_at` (DATETIME, DEFAULT CURRENT_TIMESTAMP): 变更时间

**索引**:
- `idx_config` (config_id, changed_at)
- `idx_changed_by` (changed_by, changed_at)

---

## 六、API接口设计

### 6.1 系统概览接口

**接口**: `GET /api/admin/memory/dashboard`

**功能**: 获取系统概览数据

**响应数据**:
- `systemStatus` (object): 系统状态
- `statistics` (object): 统计数据
- `performanceMetrics` (object): 性能指标
- `trends` (array): 趋势数据

---

### 6.2 系统配置接口

**接口**: `GET /api/admin/memory/configs`

**功能**: 获取系统配置列表

**请求参数**:
- `configType` (string): 配置类型

**响应数据**:
- `configs` (array): 配置列表

---

**接口**: `POST /api/admin/memory/config`

**功能**: 创建或更新系统配置

**请求参数**:
- `configKey` (string, required): 配置键
- `configValue` (object, required): 配置值
- `configType` (string, required): 配置类型
- `description` (string): 配置说明

**响应数据**:
- `configId` (long): 配置ID
- `success` (boolean): 是否成功

---

### 6.3 用户记忆管理接口

**接口**: `GET /api/admin/memory/users`

**功能**: 搜索用户

**请求参数**:
- `keyword` (string): 搜索关键词
- `page` (integer): 页码
- `size` (integer): 每页数量

**响应数据**:
- `users` (array): 用户列表
- `total` (integer): 总记录数

---

**接口**: `GET /api/admin/memory/user/{userId}/memories`

**功能**: 获取用户的记忆数据

**请求参数**:
- `memoryType` (string): 记忆类型
- `page` (integer): 页码
- `size` (integer): 每页数量

**响应数据**:
- `memories` (array): 记忆列表（脱敏后）
- `total` (integer): 总记录数

---

**接口**: `DELETE /api/admin/memory/user/{userId}/memory/{memoryId}`

**功能**: 删除用户的记忆（需要权限）

**响应数据**:
- `success` (boolean): 是否成功

---

## 七、实施计划

### 7.1 第一阶段：基础功能（1周）

- [ ] 设计管理端整体架构
- [ ] 开发系统概览仪表板
- [ ] 开发基础配置管理功能
- [ ] 开发用户记忆管理基础功能
- [ ] 实现权限控制

### 7.2 后续阶段

- 第二部分：短时记忆管理
- 第三部分：长时记忆管理
- 第四部分：统计分析与管理工具

---

## 八、验收标准

### 8.1 功能验收

- ✅ 系统概览能够正确显示关键指标
- ✅ 系统配置功能完整可用
- ✅ 用户记忆管理功能正常
- ✅ 权限控制有效

### 8.2 性能验收

- ✅ 页面加载时间 < 2秒
- ✅ 数据查询响应时间 < 1秒
- ✅ 系统稳定可靠

---

**文档状态**: 第一部分需求分析已完成，待后续部分补充

