# è®°å¿†ç³»ç»Ÿæµ‹è¯•æŒ‡å—

**æ–‡æ¡£ç‰ˆæœ¬**: V1.0  
**ç¼–å†™æ—¥æœŸ**: 2025-12-28

---

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›è®°å¿†ç³»ç»Ÿçš„æµ‹è¯•æŒ‡å—ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œæ‰‹åŠ¨æµ‹è¯•æ–¹æ³•ã€‚

---

## ğŸ§ª æµ‹è¯•ç¯å¢ƒå‡†å¤‡

### 1. å¯åŠ¨æ•°æ®åº“

```bash
# å¯åŠ¨Rediså’ŒMongoDB
./scripts/start-databases.sh

# éªŒè¯æœåŠ¡çŠ¶æ€
redis-cli ping  # åº”è¯¥è¿”å› PONG
mongosh --eval "db.version()"  # åº”è¯¥è¿”å›MongoDBç‰ˆæœ¬
```

### 2. åˆå§‹åŒ–MongoDBç´¢å¼•

```bash
mongosh heartsphere < backend/src/main/resources/db/mongodb/init-indexes.js
```

### 3. ç¼–è¯‘é¡¹ç›®

```bash
cd backend
mvn clean compile
```

---

## ğŸ”¬ å•å…ƒæµ‹è¯•

### 1. RedisShortMemoryServiceæµ‹è¯•

**æ–‡ä»¶**: `backend/src/test/java/com/heartsphere/memory/service/impl/RedisShortMemoryServiceTest.java`

**æµ‹è¯•è¦ç‚¹**ï¼š
- âœ… æ¶ˆæ¯ä¿å­˜å’Œæ£€ç´¢
- âœ… æ¶ˆæ¯æ•°é‡é™åˆ¶
- âœ… TTLè®¾ç½®
- âœ… å·¥ä½œè®°å¿†ç®¡ç†
- âœ… ä¼šè¯ç®¡ç†

### 2. MongoLongMemoryServiceæµ‹è¯•

**æ–‡ä»¶**: `backend/src/test/java/com/heartsphere/memory/service/impl/MongoLongMemoryServiceTest.java`

**æµ‹è¯•è¦ç‚¹**ï¼š
- âœ… ç”¨æˆ·äº‹å®CRUD
- âœ… ç”¨æˆ·åå¥½CRUD
- âœ… è®°å¿†æ£€ç´¢
- âœ… æ–‡æœ¬æœç´¢
- âœ… ä¸Šä¸‹æ–‡æ£€ç´¢

### 3. MemoryManagerImplæµ‹è¯•

**æ–‡ä»¶**: `backend/src/test/java/com/heartsphere/memory/service/impl/MemoryManagerImplTest.java`

**æµ‹è¯•è¦ç‚¹**ï¼š
- âœ… æ¶ˆæ¯ä¿å­˜
- âœ… å¯¹è¯ä¸Šä¸‹æ–‡æ„å»º
- âœ… è®°å¿†æå–
- âœ… è®°å¿†æ£€ç´¢
- âœ… ç”¨æˆ·ç”»åƒæ„å»º

### 4. TemperatureMemoryServiceæµ‹è¯•

**æ–‡ä»¶**: `backend/src/test/java/com/heartsphere/memory/service/TemperatureMemoryServiceTest.java`

**æµ‹è¯•è¦ç‚¹**ï¼š
- âœ… æƒ…ç»ªè®°å¿†æå–
- âœ… æƒ…ç»ªè®°å¿†æ£€ç´¢
- âœ… æƒ…ç»ªè¶‹åŠ¿åˆ†æ

---

## ğŸ”— é›†æˆæµ‹è¯•

### 1. è®°å¿†ç³»ç»Ÿé›†æˆæµ‹è¯•

**æ–‡ä»¶**: `backend/src/test/java/com/heartsphere/memory/integration/MemorySystemIntegrationTest.java`

**æµ‹è¯•åœºæ™¯**ï¼š
1. å®Œæ•´æµç¨‹ï¼šä¿å­˜æ¶ˆæ¯ â†’ æå–è®°å¿† â†’ æ£€ç´¢è®°å¿†
2. æ¸©åº¦æ„Ÿç³»ç»Ÿé›†æˆï¼šæƒ…ç»ªè®°å½• â†’ æå–è®°å¿† â†’ æ£€ç´¢è®°å¿†
3. å¤šç”¨æˆ·åœºæ™¯ï¼šå¹¶å‘æµ‹è¯•

### 2. æ¸©åº¦æ„Ÿç³»ç»Ÿé›†æˆæµ‹è¯•

**æ–‡ä»¶**: `backend/src/test/java/com/heartsphere/memory/integration/TemperatureMemoryIntegrationTest.java`

**æµ‹è¯•åœºæ™¯**ï¼š
1. æƒ…ç»ªè®°å½•ä¿å­˜ â†’ è‡ªåŠ¨æå–è®°å¿†
2. æƒ…ç»ªè®°å¿†æ£€ç´¢
3. æƒ…ç»ªè¶‹åŠ¿åˆ†æ

---

## ğŸ–¥ï¸ æ‰‹åŠ¨æµ‹è¯•

### 1. Redisè¿æ¥æµ‹è¯•

```bash
# ä½¿ç”¨redis-cliæµ‹è¯•
redis-cli
> SET test:key "hello"
> GET test:key
> DEL test:key
```

### 2. MongoDBè¿æ¥æµ‹è¯•

```bash
# ä½¿ç”¨mongoshæµ‹è¯•
mongosh heartsphere
> db.user_memories.insertOne({userId: "test", type: "EMOTION_PATTERN", content: "test"})
> db.user_memories.find({userId: "test"})
> db.user_memories.deleteMany({userId: "test"})
```

### 3. APIæµ‹è¯•ï¼ˆä½¿ç”¨curlï¼‰

```bash
# ä¿å­˜æ¶ˆæ¯
curl -X POST http://localhost:8081/api/memory/v1/sessions/test-session/messages \
  -H "Content-Type: application/json" \
  -d '{
    "role": "USER",
    "content": "æˆ‘ä»Šå¤©å¾ˆå¼€å¿ƒ",
    "userId": "test-user"
  }'

# è·å–æ¶ˆæ¯
curl http://localhost:8081/api/memory/v1/sessions/test-session/messages?limit=10

# æ£€ç´¢è®°å¿†
curl http://localhost:8081/api/memory/v1/users/test-user/memories/search?query=å¼€å¿ƒ&limit=10
```

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### 1. çŸ­æœŸè®°å¿†æ€§èƒ½æµ‹è¯•

**ç›®æ ‡**ï¼š
- æ¶ˆæ¯ä¿å­˜å»¶è¿Ÿ < 10ms
- æ¶ˆæ¯æ£€ç´¢å»¶è¿Ÿ < 5ms
- æ”¯æŒ1000+å¹¶å‘ç”¨æˆ·

### 2. é•¿æœŸè®°å¿†æ€§èƒ½æµ‹è¯•

**ç›®æ ‡**ï¼š
- è®°å¿†ä¿å­˜å»¶è¿Ÿ < 50ms
- è®°å¿†æ£€ç´¢å»¶è¿Ÿ < 100ms
- æ–‡æœ¬æœç´¢å»¶è¿Ÿ < 200ms

### 3. å‹åŠ›æµ‹è¯•

ä½¿ç”¨JMeteræˆ–ç±»ä¼¼å·¥å…·è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼š
- å¹¶å‘ç”¨æˆ·æ•°ï¼š100, 500, 1000
- æµ‹è¯•æ—¶é•¿ï¼š5åˆ†é’Ÿ
- è§‚å¯ŸæŒ‡æ ‡ï¼šå“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€ååé‡

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŠŸèƒ½æµ‹è¯•

- [ ] çŸ­æœŸè®°å¿†æ¶ˆæ¯ä¿å­˜å’Œæ£€ç´¢
- [ ] é•¿æœŸè®°å¿†CRUDæ“ä½œ
- [ ] è®°å¿†æå–åŠŸèƒ½
- [ ] è®°å¿†æ£€ç´¢åŠŸèƒ½
- [ ] æ¸©åº¦æ„Ÿç³»ç»Ÿé›†æˆ
- [ ] ç”¨æˆ·ç”»åƒæ„å»º

### æ€§èƒ½æµ‹è¯•

- [ ] çŸ­æœŸè®°å¿†è¯»å†™æ€§èƒ½
- [ ] é•¿æœŸè®°å¿†æ£€ç´¢æ€§èƒ½
- [ ] å¹¶å‘æ€§èƒ½æµ‹è¯•
- [ ] å‹åŠ›æµ‹è¯•

### é›†æˆæµ‹è¯•

- [ ] ä¸æ¸©åº¦æ„Ÿç³»ç»Ÿé›†æˆ
- [ ] ä¸AIæœåŠ¡é›†æˆ
- [ ] ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: Redisè¿æ¥å¤±è´¥ï¼Ÿ

**A**: æ£€æŸ¥ï¼š
1. Redisæ˜¯å¦è¿è¡Œï¼š`redis-cli ping`
2. é…ç½®æ˜¯å¦æ­£ç¡®ï¼š`application.yml`
3. ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`lsof -i :6379`

### Q2: MongoDBè¿æ¥å¤±è´¥ï¼Ÿ

**A**: æ£€æŸ¥ï¼š
1. MongoDBæ˜¯å¦è¿è¡Œï¼š`mongosh --eval "db.version()"`
2. é…ç½®æ˜¯å¦æ­£ç¡®ï¼š`application.yml`
3. æ•°æ®åº“æ˜¯å¦å­˜åœ¨ï¼š`mongosh heartsphere`

### Q3: æµ‹è¯•å¤±è´¥ï¼Ÿ

**A**: æ£€æŸ¥ï¼š
1. æµ‹è¯•æ•°æ®æ˜¯å¦æ¸…ç†
2. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
3. ä¾èµ–æœåŠ¡æ˜¯å¦å¯åŠ¨

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [é˜¶æ®µä¸€è¯¦ç»†è®¾è®¡](./02-é˜¶æ®µä¸€ï¼šåŸºç¡€è®°å¿†ç³»ç»Ÿ.md)
- [æ¸©åº¦æ„Ÿç³»ç»Ÿé›†æˆè¯´æ˜](./æ¸©åº¦æ„Ÿç³»ç»Ÿé›†æˆè¯´æ˜.md)
- [APIæ–‡æ¡£](./07-APIæ–‡æ¡£.md)

---

**å¼€å§‹æµ‹è¯•ï¼** ğŸš€

