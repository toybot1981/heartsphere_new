# AI Agent 记忆系统

**文档版本**: V1.0  
**编写日期**: 2025-12-28  
**系统名称**: Memory System - AI Agent 记忆系统  
**目标**: 设计并实现一个完整的AI Agent记忆系统，支持从短期记忆到长期记忆的多层次记忆架构，让心域的角色和参与者都具备记忆能力

---

## 📚 文档目录

1. **[需求分析与架构设计](./01-需求分析与架构设计.md)** - 整体需求、理论依据、架构设计
2. **[实施优先级与路线图](./实施优先级与路线图.md)** ⭐ - **实施优先级和路线图（重要）**
3. **[阶段一：基础记忆系统](./02-阶段一：基础记忆系统.md)** ⭐ - 短期记忆和长期记忆基础能力（**优先实施**）
4. **[阶段二：角色记忆系统](./03-阶段二：角色记忆系统.md)** ⭐ - E-SOUL角色记忆能力（**优先实施**）
5. **[阶段三：参与者记忆系统](./04-阶段三：参与者记忆系统.md)** ⏸️ - 参与者记忆和交互记忆（**暂缓实施**）
6. **[阶段四：高级记忆能力](./05-阶段四：高级记忆能力.md)** - 向量搜索、语义检索、记忆关联
7. **[阶段五：记忆系统优化](./06-阶段五：记忆系统优化.md)** - 性能优化、记忆巩固、衰减机制
8. **[长期记忆与短期记忆设计详解](./长期记忆与短期记忆设计详解.md)** - 详细设计说明
9. **[用户记忆与参与者记忆的区别](./用户记忆与参与者记忆的区别.md)** - 概念对比说明
10. **[API文档](./07-API文档.md)** - REST API接口说明
11. **[使用指南](./08-使用指南.md)** - 开发者使用指南和最佳实践
12. **[数据库安装配置](./数据库安装配置.md)** - Redis和MongoDB安装配置

---

## 🎯 核心目标

### 1. 记忆架构
- ✅ **双层记忆架构**：短期记忆（Redis） + 长期记忆（MongoDB）
- ✅ **多主体记忆**：用户记忆、角色记忆、参与者记忆
- ✅ **记忆生命周期**：从短期到长期的自然过渡
- ✅ **记忆检索**：高效的多维度记忆检索

### 2. 角色记忆能力
- ✅ **角色自身记忆**：每个E-SOUL角色拥有独立的记忆体系
- ✅ **角色与用户记忆**：记录角色与用户之间的交互历史
- ✅ **角色场景记忆**：记录角色在不同场景切片中的记忆
- ✅ **角色关系记忆**：记录角色与其他角色的关系

### 3. 参与者记忆能力 ⏸️ **暂缓实施**
- ⏸️ **参与者身份记忆**：记录参与者在心域中的身份和角色
- ⏸️ **参与者交互记忆**：记录参与者之间的交互历史
- ⏸️ **参与者关系网络**：构建参与者之间的关系图谱
- ⏸️ **参与者偏好记忆**：记录参与者的偏好和行为模式

### 4. 高级能力
- ✅ **语义搜索**：基于向量嵌入的语义记忆检索
- ✅ **记忆关联**：建立记忆之间的关联关系
- ✅ **记忆巩固**：智能的短期到长期记忆转换
- ✅ **记忆衰减**：基于时间的记忆重要性衰减

---

## 📊 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                    记忆系统 (Memory System)                   │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌──────────────────┐         ┌──────────────────┐          │
│  │  短期记忆        │         │  长期记忆        │          │
│  │  (Short Memory)  │         │  (Long Memory)   │          │
│  ├──────────────────┤         ├──────────────────┤          │
│  │ • 对话上下文     │         │ • 用户事实       │          │
│  │ • 工作记忆       │         │ • 用户偏好       │          │
│  │ • 会话状态       │         │ • 角色记忆       │          │
│  │ • 临时数据       │         │ • 参与者记忆     │          │
│  │                  │         │ • 关系记忆       │          │
│  └──────────────────┘         └──────────────────┘          │
│           │                              │                   │
│           └──────────┬───────────────────┘                   │
│                      │                                       │
│           ┌──────────▼───────────────────┐                   │
│           │   记忆管理器                 │                   │
│           │  (Memory Manager)            │                   │
│           ├──────────────────────────────┤                   │
│           │ • 记忆存储                   │                   │
│           │ • 记忆检索                   │                   │
│           │ • 记忆巩固                   │                   │
│           │ • 记忆关联                   │                   │
│           │ • 记忆衰减                   │                   │
│           └──────────────────────────────┘                   │
│                      │                                       │
│           ┌──────────▼───────────────────┐                   │
│           │   记忆主体管理器              │                   │
│           │  (Memory Subject Manager)    │                   │
│           ├──────────────────────────────┤                   │
│           │ • 用户记忆                   │                   │
│           │ • 角色记忆 (E-SOUL)          │                   │
│           │ • 参与者记忆                 │                   │
│           │ • 关系记忆                   │                   │
│           └──────────────────────────────┘                   │
│                      │                                       │
│           ┌──────────▼───────────────────┐                   │
│           │   存储层 (Storage Layer)     │                   │
│           ├──────────────────────────────┤                   │
│           │ • Redis (短期记忆)           │                   │
│           │ • MongoDB (长期记忆)         │                   │
│           │ • 向量数据库 (语义搜索)      │                   │
│           └──────────────────────────────┘                   │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

---

## 🚀 分阶段实施计划

### ⭐ 优先级说明

**当前优先级**：
1. **阶段一**：基础记忆系统（用户记忆）✅ **优先实施**
2. **阶段二**：角色记忆系统（AI角色记忆）✅ **优先实施**
3. **阶段三**：参与者记忆系统 ⏸️ **暂缓实施**
4. **阶段四**：高级记忆能力 🔄 **后续实施**
5. **阶段五**：记忆系统优化 🔄 **后续实施**

---

### 阶段一：基础记忆系统（4-6周）⭐ **优先实施**

**目标**：建立记忆系统的基础架构，实现用户记忆的基础能力

**核心功能**：
- 短期记忆管理（Redis）
- 长期记忆管理（MongoDB）
- 用户事实和偏好存储
- 基础记忆检索
- 记忆提取和存储
- REST API基础接口

**交付物**：
- 短期记忆服务（ShortMemoryService）
- 长期记忆服务（LongMemoryService）
- 记忆管理器（MemoryManager）
- 记忆提取器（MemoryExtractor）
- 基础API接口（20+）

**关键能力**：
- ✅ 用户与AI对话的上下文管理
- ✅ 用户信息的自动提取和存储
- ✅ 用户偏好的记录和检索
- ✅ 跨会话的用户记忆检索

---

### 阶段二：角色记忆系统（4-6周）⭐ **优先实施**

**目标**：让心域的E-SOUL角色具备独立的记忆能力

**核心功能**：
- 角色自身记忆（角色背景、性格等）
- 角色与用户交互记忆
- 角色场景记忆（不同场景切片中的记忆）
- 角色关系记忆（角色与其他角色的关系）
- 角色记忆检索和更新

**交付物**：
- 角色记忆服务（CharacterMemoryService）
- 角色记忆数据模型
- 角色记忆API
- 角色记忆集成到对话系统

**关键能力**：
- ✅ 每个E-SOUL角色拥有独立的记忆体系
- ✅ 角色能够记住与用户的交互历史
- ✅ 角色在不同场景中的记忆隔离
- ✅ 角色能够根据记忆调整对话风格

---

### 阶段三：参与者记忆系统（3-4周）⏸️ **暂缓实施**

**状态**：当前暂缓，待用户记忆和角色记忆稳定后再实施

**目标**：实现参与者的记忆能力，支持多用户交互场景

**核心功能**：
- 参与者记忆模型
- 参与者交互记忆
- 参与者关系网络
- 参与者偏好记忆
- 多参与者场景记忆

**交付物**：
- 参与者记忆服务
- 参与者记忆API
- 关系网络构建

**说明**：此阶段功能将在用户记忆和角色记忆系统稳定运行后再考虑实施。

---

### 阶段四：高级记忆能力（6-8周）🔄 **后续实施**

**目标**：实现语义搜索、记忆关联等高级能力

**核心功能**：
- 向量嵌入和语义搜索
- 记忆关联网络
- 智能记忆检索
- 记忆重要性评估
- 记忆巩固机制

**交付物**：
- 向量搜索服务
- 记忆关联服务
- 高级检索API
- 记忆分析工具

---

### 阶段五：记忆系统优化（4-6周）🔄 **后续实施**

**目标**：性能优化、记忆衰减、系统稳定性提升

**核心功能**：
- 记忆衰减机制
- 记忆压缩和归档
- 性能优化
- 缓存策略
- 监控和诊断

**交付物**：
- 优化后的服务
- 监控系统
- 性能报告
- 运维文档

---

## 📈 技术栈

- **后端框架**：Spring Boot 3.x
- **短期存储**：Redis
- **长期存储**：MongoDB
- **向量数据库**：Milvus / FAISS（可选）
- **AI模型**：大模型统一接入层
- **嵌入模型**：text-embedding-ada-002 或开源模型

---

## 🔗 相关文档

- [大模型统一接入层](../大模型统一接入层/README.md)
- [心域连接需求](../../10-心域连接/需求分析/心域连接功能需求分析-第一阶段.md)
- [温度感系统](../../02-温度感系统/需求分析/增加系统温度感需求分析-第二阶段.md)

---

## 📝 设计原则

1. **认知科学基础**：基于人类记忆系统的认知科学研究
2. **分层架构**：清晰的短期记忆和长期记忆分离
3. **多主体支持**：用户、角色、参与者多主体记忆（当前优先：用户+角色）
4. **可扩展性**：支持未来扩展更多记忆类型和主体
5. **性能优先**：保证记忆检索和存储的高性能
6. **隐私保护**：确保记忆数据的隐私和安全
7. **聚焦核心**：优先实现用户记忆和角色记忆，确保核心功能稳定

---

## 🎓 理论基础

### 认知科学记忆理论

参考人类记忆系统的认知科学研究：

- **短期记忆（Short-term Memory）**
  - 容量限制：7±2个信息块（Miller's Law）
  - 保持时间：几秒到几分钟
  - 易遗忘：需要复述才能保持

- **长期记忆（Long-term Memory）**
  - 容量：几乎无限
  - 保持时间：从几天到终身
  - 巩固过程：从短期记忆经过巩固转为长期记忆

- **记忆巩固（Memory Consolidation）**
  - 重要信息从短期记忆转移到长期记忆
  - 需要重复、强化、关联

- **记忆检索（Memory Retrieval）**
  - 通过线索（cue）触发
  - 上下文相关检索
  - 关联检索

---

## 📞 联系方式

如有问题或建议，请联系开发团队。

