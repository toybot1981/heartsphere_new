# 心域连接功能需求分析与设计文档 - 第二阶段

**文档版本**: V1.0  
**编写日期**: 2025-12-22  
**功能模块**: 心域对外共享系统  
**目标**: 实现心域的对外共享功能，让用户可以将自己的心域分享给其他人，支持灵活的共享权限管理

---

## 一、需求概述

### 1.1 背景

心域是用户精心构建的情感空间，包含多个场景和E-SOUL。用户希望能够将自己的心域分享给其他人，让他们也能够体验和连接这个空间。同时，用户需要能够灵活控制共享的范围和权限。

### 1.2 核心需求

- ✅ **灵活共享**：用户可以选择共享部分场景或全部场景
- ✅ **权限管理**：支持不同的共享权限级别
- ✅ **连接请求**：其他用户可以看到共享的心域并请求连接
- ✅ **审批机制**：心域主人可以审批连接请求
- ✅ **视觉区分**：共享的心域在视觉上更加醒目（星光更大更闪耀）
- ✅ **状态标识**：请求前后显示不同的颜色和状态

### 1.3 设计目标

1. **灵活性**：用户可以根据需要选择共享范围
2. **安全性**：确保用户对共享内容有完全的控制权
3. **易用性**：共享和连接的流程简单直观
4. **视觉吸引力**：共享心域的视觉呈现更加吸引人

---

## 二、共享功能设计

### 2.1 共享范围选择

#### 2.1.1 共享级别设计

**功能描述**: 提供灵活的共享范围选择，满足不同用户的需求

**设计建议**:

我们建议采用**三级共享体系**，从粗粒度到细粒度，让用户有更多控制权：

1. **全部共享（推荐给开放型用户）**
   - **定义**：共享用户的所有世界和场景
   - **适用场景**：
     - 用户希望完全开放心域，让更多人体验
     - 用户的心域内容都是可以公开的
     - 用户希望获得更多互动和反馈
   - **权限控制**：访问者可以体验所有场景和E-SOUL
   - **视觉标识**：在共享列表中显示"完全开放"标签

2. **按世界共享（推荐给组织型用户）**
   - **定义**：按世界（World）维度共享，可以选择共享哪些世界
   - **适用场景**：
     - 用户有多个世界，希望选择性分享
     - 不同世界有不同的主题和内容
     - 希望保持某些世界的私密性
   - **优势**：
     - 比全部共享更灵活
     - 比单场景共享更简单（不需要逐个选择场景）
     - 符合心域的世界-场景层级结构
   - **操作方式**：在世界列表中勾选要共享的世界
   - **权限控制**：访问者只能访问被选中的世界及其所有场景

3. **按场景共享（推荐给精细控制用户）**
   - **定义**：按场景（Era）维度共享，可以选择共享哪些场景
   - **适用场景**：
     - 用户希望精确控制共享内容
     - 某些场景包含敏感或私密内容
     - 希望展示特定主题的场景
   - **操作方式**：
     - 在场景列表中勾选要共享的场景
     - 支持按世界分组显示，方便选择
     - 支持批量选择（如选择某个世界的所有场景）
   - **权限控制**：访问者只能访问被选中的场景

4. **单场景快速共享（推荐给临时分享）**
   - **定义**：快速共享单个场景
   - **适用场景**：
     - 临时想分享某个场景
     - 快速生成分享链接
   - **操作方式**：
     - 在场景卡片上提供"快速分享"按钮
     - 一键生成分享链接
     - 可以快速开启/关闭共享

#### 2.1.2 共享范围建议算法

**功能描述**: 基于用户的心域结构，智能推荐合适的共享范围

**详细需求**:

1. **推荐逻辑**
   - **场景数量**：如果场景数量少（<5个），推荐全部共享
   - **世界数量**：如果世界数量多（>3个），推荐按世界共享
   - **场景分布**：如果场景集中在少数世界，推荐按世界共享
   - **用户偏好**：记录用户之前的共享偏好，推荐相似配置

2. **推荐展示**
   - **推荐标签**：在推荐选项上显示"推荐"标签
   - **推荐理由**：显示推荐理由（如"你有3个世界，建议按世界共享"）
   - **快速应用**：提供"应用推荐"按钮，一键应用推荐配置

3. **配置模板**
   - **公开模板**：全部共享，适合公开内容
   - **精选模板**：选择部分场景，适合展示精品内容
   - **主题模板**：按主题选择场景，适合特定主题分享
   - **自定义模板**：用户保存自己的共享配置模板

#### 2.1.3 共享配置界面设计

**功能描述**: 用户配置共享设置的界面，提供直观、易用的操作体验

**详细需求**:

1. **共享设置入口**
   - **个人中心入口**：在个人中心添加"共享心域"入口，显示当前共享状态
   - **场景管理入口**：在场景管理界面添加共享设置按钮
   - **快捷入口**：在场景卡片上添加快速共享按钮（小图标）
   - **世界管理入口**：在世界管理界面添加"共享此世界"按钮

2. **共享配置界面布局（优化版）**

   **界面一：共享范围选择**
   ```
   ┌─────────────────────────────────────┐
   │  共享我的心域                [关闭]  │
   ├─────────────────────────────────────┤
   │                                      │
   │  选择共享范围：                      │
   │                                      │
   │  ┌──────────────────────────────┐  │
   │  │ ● 全部共享 ⭐推荐              │  │
   │  │   共享所有世界和场景          │  │
   │  │   适合：完全开放的心域        │  │
   │  └──────────────────────────────┘  │
   │                                      │
   │  ┌──────────────────────────────┐  │
   │  │ ○ 按世界共享 ⭐推荐            │  │
   │  │   选择要共享的世界：          │  │
   │  │   ┌────────────────────┐    │  │
   │  │   │ ☑ 世界1：大学时光   │    │  │
   │  │   │   ├─ 场景1.1        │    │  │
   │  │   │   └─ 场景1.2        │    │  │
   │  │   │ ☑ 世界2：职场生活   │    │  │
   │  │   │   ├─ 场景2.1        │    │  │
   │  │   │   └─ 场景2.2        │    │  │
   │  │   │ ☐ 世界3：童年回忆   │    │  │
   │  │   └────────────────────┘    │  │
   │  └──────────────────────────────┘  │
   │                                      │
   │  ┌──────────────────────────────┐  │
   │  │ ○ 按场景共享                  │  │
   │  │   精确选择要共享的场景：      │  │
   │  │   [展开场景列表...]           │  │
   │  └──────────────────────────────┘  │
   │                                      │
   │  统计：将共享 2 个世界，5 个场景     │
   │                                      │
   │  [下一步]                            │
   └─────────────────────────────────────┘
   ```

   **界面二：权限和描述设置**
   ```
   ┌─────────────────────────────────────┐
   │  共享设置                    [上一步]│
   ├─────────────────────────────────────┤
   │                                      │
   │  连接权限：                          │
   │  ┌──────────────────────────────┐  │
   │  │ ● 需要我审批（推荐）          │  │
   │  │   其他人需要请求，我同意后    │  │
   │  │   才能进入                    │  │
   │  └──────────────────────────────┘  │
   │  ┌──────────────────────────────┐  │
   │  │ ○ 自由连接                   │  │
   │  │   任何人可以直接进入，无需   │  │
   │  │   审批                        │  │
   │  └──────────────────────────────┘  │
   │                                      │
   │  共享描述（可选）：                  │
   │  ┌──────────────────────────────┐  │
   │  │ 介绍一下你的心域...            │  │
   │  │                               │  │
   │  │                               │  │
   │  └──────────────────────────────┘  │
   │  已输入 0/200 字                    │
   │                                      │
   │  预览效果：                          │
   │  ┌──────────────────────────────┐  │
   │  │ [心域封面图]                  │  │
   │  │ 心域名称                      │  │
   │  │ 共享描述预览...               │  │
   │  │ 共享范围：2个世界，5个场景    │  │
   │  └──────────────────────────────┘  │
   │                                      │
   │  [保存并开启共享]                    │
   └─────────────────────────────────────┘
   ```

3. **界面交互优化**
   - **步骤指示**：显示当前步骤（如"1/2"）
   - **实时预览**：选择共享范围时实时更新预览
   - **统计信息**：显示"将共享 X 个世界，Y 个场景，Z 个E-SOUL"
   - **推荐提示**：在推荐选项上显示推荐理由
   - **快速操作**：
     - "全选/取消全选"按钮
     - "选择此世界的所有场景"按钮
     - "应用推荐配置"按钮
   - **场景选择交互**：
     - **多选模式**：支持勾选多个场景
     - **全选/取消全选**：快速全选或取消全选
     - **场景预览**：选择时可以预览场景信息
     - **场景统计**：显示已选择的场景数量

4. **共享描述**
   - **可选输入**：用户可以输入一段描述文字
   - **字数限制**：建议200字以内
   - **用途说明**：向访问者介绍这个心域

#### 2.1.3 共享状态管理

**功能描述**: 管理共享的开启、关闭、修改

**详细需求**:

1. **共享状态**
   - **未共享**：默认状态，心域未对外共享
   - **已共享**：心域已开启共享，其他人可以看到
   - **已暂停**：临时暂停共享，已连接的访问者不受影响
   - **已关闭**：关闭共享，断开所有连接

2. **状态切换**
   - **开启共享**：用户可以随时开启共享
   - **暂停共享**：临时暂停，可以随时恢复
   - **关闭共享**：永久关闭，需要重新配置
   - **修改共享范围**：已共享时可以修改共享的场景

3. **状态提示**
   - **状态显示**：在界面上清晰显示当前共享状态
   - **状态切换提示**：切换状态时给出友好提示
   - **影响说明**：说明状态切换对访问者的影响

### 2.2 共享权限设置

#### 2.2.1 连接权限

**功能描述**: 控制谁可以连接和如何连接

**详细需求**:

1. **连接方式**
   - **需要审批**：访问者需要发送连接请求，主人审批后才能进入（推荐）
   - **自由连接**：任何人可以直接进入，无需审批
   - **邀请连接**：只有收到邀请的用户才能连接

2. **审批设置**
   - **自动审批**：满足条件时自动审批（如好友关系）
   - **手动审批**：需要主人手动审批每个请求
   - **审批提示**：有新请求时及时通知主人

3. **访问限制**
   - **访问次数限制**：限制单个访问者的访问次数
   - **访问时长限制**：限制单次访问的时长
   - **访问时间段**：限制可访问的时间段

#### 2.2.2 体验权限

**功能描述**: 控制访问者在心域中的体验权限

**详细需求**:

1. **体验范围**
   - **完整体验**：可以体验所有共享的场景和E-SOUL
   - **受限体验**：只能体验部分内容（如只读模式）
   - **预览模式**：只能预览，不能交互

2. **交互权限**
   - **对话权限**：是否可以与E-SOUL对话
   - **场景切换**：是否可以在场景间切换
   - **内容查看**：是否可以查看日记、记忆等内容

3. **数据权限**
   - **数据保存**：访问者的体验数据是否保存
   - **数据可见**：访问者产生的数据是否对主人可见
   - **数据分享**：访问者是否可以分享体验内容

### 2.3 共享码和链接

#### 2.3.1 共享码生成

**功能描述**: 为共享的心域生成唯一的共享码

**详细需求**:

1. **共享码格式**
   - **格式**：6-8位字母数字组合（如：HS-A3B7C9）
   - **唯一性**：确保每个共享码都是唯一的
   - **可读性**：使用易读的字符，避免混淆（如0和O）

2. **共享码管理**
   - **自动生成**：开启共享时自动生成共享码
   - **重新生成**：可以重新生成共享码（旧的会失效）
   - **有效期**：可以设置共享码的有效期

3. **共享码展示**
   - **二维码**：生成二维码，方便分享
   - **复制链接**：提供可复制的分享链接
   - **分享按钮**：支持一键分享到社交媒体

#### 2.3.2 分享链接

**功能描述**: 生成分享链接，方便传播

**详细需求**:

1. **链接格式**
   - **格式**：`https://heartsphere.app/share/{shareCode}`
   - **短链接**：使用短链接服务生成更短的链接
   - **自定义链接**：支持自定义链接后缀（如：`/share/my-heart`）

2. **链接预览**
   - **预览卡片**：分享链接的预览卡片显示心域信息
   - **封面图**：显示心域封面图
   - **描述信息**：显示共享描述

3. **链接管理**
   - **链接统计**：统计链接的访问次数
   - **链接失效**：关闭共享时链接自动失效
   - **链接密码**：可以为链接设置密码（可选）

---

## 三、连接请求系统

### 3.1 共享心域发现

#### 3.1.1 心域连接入口

**功能描述**: 用户可以浏览和发现共享的心域

**详细需求**:

1. **发现入口**
   - **首页入口**：在首页添加"探索心域"入口
   - **导航栏入口**：在导航栏添加"心域连接"入口
   - **推荐区域**：在个人中心显示推荐的心域

2. **发现界面**
   ```
   ┌─────────────────────────────────────┐
   │  探索心域                    [搜索]  │
   ├─────────────────────────────────────┤
   │  [标签筛选] [排序]                  │
   ├─────────────────────────────────────┤
   │                                      │
   │  ┌────────┐  ┌────────┐            │
   │  │ 心域1  │  │ 心域2  │            │
   │  │ ⭐⭐⭐│  │ ⭐⭐  │            │
   │  │ 已连接 │  │ 待审批 │            │
   │  └────────┘  └────────┘            │
   │                                      │
   │  ┌────────┐  ┌────────┐            │
   │  │ 心域3  │  │ 心域4  │            │
   │  │ ⭐⭐  │  │ ⭐⭐⭐│            │
   │  │ 可连接 │  │ 已连接 │            │
   │  └────────┘  └────────┘            │
   │                                      │
   └─────────────────────────────────────┘
   ```

3. **搜索功能**
   - **关键词搜索**：按心域名称、描述、创建者搜索
   - **标签筛选**：按标签筛选心域
   - **排序功能**：按热度、最新、评分排序

#### 3.1.2 心域卡片设计

**功能描述**: 共享心域在列表中的卡片展示

**详细需求**:

1. **卡片信息**
   - **封面图**：显示心域封面图或主场景图
   - **名称**：显示心域名称（或创建者名称）
   - **描述**：显示共享描述（摘要）
   - **场景数量**：显示共享的场景数量
   - **E-SOUL数量**：显示E-SOUL数量
   - **创建者信息**：显示创建者头像和昵称

2. **星光效果设计（核心视觉元素）**

   **卡片星光实现**：
   - **位置**：卡片右上角或中心位置
   - **尺寸**：
     - 可连接状态：直径 20-25px（比内部E-SOUL大80-120%）
     - 待审批状态：直径 22-27px
     - 已连接状态：直径 25-30px（最大最亮）
   - **亮度**：
     - 可连接：150-180%亮度
     - 待审批：180-200%亮度
     - 已连接：200-270%亮度
   - **光晕**：
     - 可连接：青蓝色光晕，半径 15-20px
     - 待审批：橙色光晕，半径 18-22px
     - 已连接：金色/紫色光晕，半径 20-25px（最明显）
   - **发光边框**：卡片有柔和的发光边框（颜色与状态一致）
   - **状态标识**：显示连接状态（可连接/待审批/已连接）
   - **热度标识**：显示访问热度（如访问人数）

3. **状态颜色系统（与星光效果一致）**

   **可连接状态（未请求）**
   - **卡片边框**：青蓝色发光边框（#4FC3F7，透明度30%）
   - **星光颜色**：青蓝色（#4FC3F7）
   - **背景渐变**：淡蓝色渐变背景（可选）
   - **按钮文字**："请求连接"（青蓝色按钮）
   - **用户感受**：清新、友好、可接近

   **待审批状态（已请求，等待同意）**
   - **卡片边框**：橙色发光边框（#FFB74D，透明度30%）
   - **星光颜色**：暖橙色（#FFB74D）
   - **背景渐变**：淡橙色渐变背景（可选）
   - **按钮文字**："等待审批中..."（橙色按钮，禁用状态）
   - **动画效果**：星光有"心跳"脉冲动画（表达期待）
   - **用户感受**：温暖、期待、等待中

   **已连接状态（已同意，可以进入）**
   - **卡片边框**：金色/紫色发光边框（#FFD54F 或 #BA68C8，透明度40%）
   - **星光颜色**：金色（#FFD54F）或紫色（#BA68C8）
   - **背景渐变**：金色/紫色渐变背景（更明显）
   - **按钮文字**："进入心域"（金色/紫色按钮）
   - **动画效果**：
     - 星光快速闪烁和脉冲
     - 星环效果（围绕星光的环形光效）
     - 粒子轨迹效果
   - **特殊标识**：可以添加"已连接"徽章
   - **用户感受**：成功、珍贵、特殊、兴奋

   **已拒绝状态**
   - **卡片边框**：灰色边框（#90A4AE，无发光）
   - **星光颜色**：暗淡灰色（#90A4AE）
   - **背景**：灰色半透明遮罩
   - **按钮文字**："已拒绝"或"重新请求"（灰色按钮）
   - **动画效果**：几乎静止，或非常缓慢的闪烁
   - **用户感受**：不可用、已关闭

4. **卡片交互效果**
   - **悬停效果**：
     - 鼠标悬停时星光效果增强（亮度+20%，尺寸+10%）
     - 卡片轻微放大（scale 1.02-1.05）
     - 显示更多信息（如详细描述）
   - **点击反馈**：
     - 点击时有按压动画
     - 状态切换时有平滑的颜色过渡动画
   - **加载状态**：
     - 请求发送时显示加载动画
     - 星光变为加载动画（旋转或脉冲）

5. **热度标识（可选）**
   - **访问人数**：显示"已有 X 人访问"
   - **连接人数**：显示"已有 X 人连接"
   - **热度图标**：使用火焰或星星图标表示热度
   - **热度颜色**：根据热度使用不同颜色（如红色表示高热度）

#### 3.1.3 心域详情页

**功能描述**: 查看共享心域的详细信息

**详细需求**:

1. **详情信息**
   - **完整描述**：显示完整的共享描述
   - **场景预览**：预览共享的场景列表
   - **E-SOUL预览**：预览E-SOUL列表（可选）
   - **创建者信息**：显示创建者详细信息
   - **访问统计**：显示访问人数、连接人数等（可选）

2. **操作按钮**
   - **请求连接**：发送连接请求（如果未连接）
   - **查看请求状态**：查看连接请求状态（如果已发送请求）
   - **进入心域**：直接进入心域（如果已连接）
   - **取消连接**：取消连接（如果已连接）

3. **预览内容**
   - **场景截图**：显示场景的截图预览
   - **E-SOUL展示**：展示部分E-SOUL（可能模糊处理）
   - **体验说明**：说明体验方式和权限

### 3.2 连接请求流程

#### 3.2.1 发送连接请求

**功能描述**: 用户向心域主人发送连接请求

**详细需求**:

1. **请求信息**
   - **请求消息**：用户可以附带一条请求消息（可选）
   - **自我介绍**：用户可以简单介绍自己
   - **访问目的**：用户可以说明访问目的

2. **请求发送**
   - **一键发送**：点击"请求连接"按钮即可发送
   - **确认对话框**：发送前显示确认对话框（可选）
   - **发送反馈**：发送成功时显示友好提示

3. **请求状态**
   - **待审批**：请求已发送，等待主人审批
   - **已通过**：请求已通过，可以进入
   - **已拒绝**：请求被拒绝
   - **已取消**：用户自己取消了请求

#### 3.2.2 审批连接请求

**功能描述**: 心域主人审批连接请求

**详细需求**:

1. **请求列表**
   - **请求管理入口**：在个人中心或共享设置中进入
   - **请求列表界面**：显示所有待审批的请求
   - **请求详情**：点击查看请求详情和申请者信息

2. **审批操作**
   - **通过**：批准连接请求，申请者可以进入
   - **拒绝**：拒绝连接请求，可以附带拒绝理由
   - **忽略**：忽略请求（可选，保持待审批状态）

3. **批量操作**
   - **批量通过**：可以批量通过多个请求
   - **批量拒绝**：可以批量拒绝多个请求
   - **筛选功能**：可以按状态、时间筛选请求

4. **审批通知**
   - **通知申请者**：审批结果通知申请者
   - **通知方式**：站内消息、邮件等（可选）
   - **通知内容**：显示审批结果和理由（如果有）

#### 3.2.3 连接状态管理

**功能描述**: 管理已建立的连接

**详细需求**:

1. **连接列表**
   - **已连接用户**：显示所有已连接的用户列表
   - **连接信息**：显示连接时间、访问次数等
   - **访问统计**：显示访问统计信息

2. **连接管理**
   - **断开连接**：可以主动断开与某个用户的连接
   - **权限调整**：可以调整已连接用户的访问权限
   - **访问限制**：可以限制访问频率、时长等

3. **连接状态同步**
   - **实时更新**：连接状态实时更新
   - **状态通知**：状态变化时通知相关用户
   - **状态持久化**：连接状态保存在数据库中

---

## 四、视觉设计规范

### 4.1 共享心域的星光效果设计

**目标**: 让共享的心域在视觉上更加醒目，星光更大更闪耀，同时通过颜色清晰表达连接状态

**详细需求**:

1. **星光尺寸对比（核心要求：比内部E-SOUL更大）**
   - **内部E-SOUL**：标准星光大小（基准值：4-7px）
   - **共享心域（未连接）**：星光大小增加**80-120%**（约7-15px）
   - **共享心域（已连接）**：星光大小再增加**30-50%**（约10-20px）
   - **视觉层次**：确保共享心域的星光明显大于内部E-SOUL，形成清晰的视觉层次

2. **星光亮度对比（核心要求：更闪耀）**
   - **内部E-SOUL**：标准亮度（基准值：100%）
   - **共享心域（未连接）**：亮度增加**50-80%**（150-180%）
   - **共享心域（已连接）**：亮度再增加**30-50%**（195-270%）
   - **发光效果**：共享心域有更明显的发光光晕效果（光晕半径增加50-100%）

3. **星光动画效果**
   - **闪烁频率**：
     - 内部E-SOUL：正常闪烁（1-2秒周期）
     - 共享心域：闪烁更频繁（0.5-1秒周期）
   - **脉冲效果**：
     - 共享心域有更明显的脉冲动画（呼吸效果）
     - 脉冲幅度增加50-100%
   - **粒子效果**：
     - 共享心域周围有更多的星光粒子（2-3倍）
     - 粒子运动更活跃
   - **旋转效果**（可选）：
     - 共享心域可以添加轻微的旋转动画
     - 增加视觉吸引力

4. **星光颜色系统（核心设计：状态颜色区分）**

   **状态颜色设计原则**：
   - 使用**温暖、友好的色调**，符合心域的温度感
   - 颜色要有**明显的区分度**，让用户一眼就能识别状态
   - 颜色要**传达情感**，不仅仅是功能标识

   **具体颜色方案**：

   a) **可连接状态（未请求）**
   - **主色调**：**青蓝色/天蓝色**（#4FC3F7 / #29B6F6）
   - **含义**：清新、开放、邀请
   - **视觉效果**：
     - 星光：明亮的青蓝色，有柔和的蓝色光晕
     - 粒子：淡蓝色粒子围绕
     - 动画：缓慢的脉冲，吸引注意但不刺眼
   - **用户感受**："这个心域可以连接，很友好"

   b) **待审批状态（已请求，等待主人同意）**
   - **主色调**：**暖橙色/琥珀色**（#FFB74D / #FFA726）
   - **含义**：期待、温暖、等待
   - **视觉效果**：
     - 星光：温暖的橙色，有金色光晕
     - 粒子：橙黄色粒子，闪烁更频繁
     - 动画：中等频率的脉冲，表达期待感
   - **用户感受**："我已经请求了，在等待主人的回应"
   - **特殊效果**：可以添加轻微的"心跳"动画，表达期待

   c) **已连接状态（已同意，可以进入）**
   - **主色调**：**金色/暖黄色**（#FFD54F / #FFC107）或**紫色/紫罗兰**（#BA68C8 / #AB47BC）
   - **含义**：成功、珍贵、特殊关系
   - **视觉效果**：
     - 星光：明亮的金色或紫色，有强烈的光晕
     - 粒子：金色/紫色粒子，数量最多，运动最活跃
     - 动画：快速闪烁和脉冲，表达兴奋和活力
   - **用户感受**："我可以进入这个心域了，很特别"
   - **特殊效果**：
     - 可以添加"星环"效果（围绕星光的环形光效）
     - 可以添加"星光轨迹"（粒子形成轨迹）

   d) **已拒绝状态（请求被拒绝）**
   - **主色调**：**灰色/灰蓝色**（#90A4AE / #78909C）
   - **含义**：不可用、已关闭
   - **视觉效果**：
     - 星光：暗淡的灰色，无光晕或微弱光晕
     - 粒子：灰色粒子，数量减少，运动缓慢
     - 动画：几乎静止，或非常缓慢的闪烁
   - **用户感受**："这个心域暂时不可连接"

   e) **已暂停状态（主人暂停共享）**
   - **主色调**：**淡紫色/淡蓝色**（#CE93D8 / #81D4FA）
   - **含义**：暂时不可用，但可能恢复
   - **视觉效果**：
     - 星光：较暗的淡紫色/淡蓝色
     - 粒子：减少，运动缓慢
     - 动画：缓慢的脉冲

5. **状态转换动画**
   - **请求发送**：从青蓝色平滑过渡到橙色（0.5秒动画）
   - **连接成功**：从橙色快速闪烁后变为金色/紫色（1秒动画，带庆祝效果）
   - **连接被拒**：从橙色淡出到灰色（0.5秒动画）
   - **动画原则**：所有状态转换都要有平滑的过渡动画，避免突兀

6. **视觉层次设计**
   ```
   视觉优先级（从高到低）：
   1. 已连接的心域（金色/紫色，最大最亮）
   2. 待审批的心域（橙色，中等大小，温暖）
   3. 可连接的心域（青蓝色，中等大小，清新）
   4. 内部E-SOUL（标准大小，标准亮度）
   ```

### 4.2 状态视觉区分

**目标**: 通过颜色和视觉效果清晰区分不同的连接状态

**详细需求**:

1. **卡片边框颜色**
   - **可连接**：蓝色/青色边框，柔和的发光
   - **待审批**：橙色/黄色边框，缓慢闪烁
   - **已连接**：金色/紫色边框，持续发光
   - **已拒绝**：灰色边框，无发光

2. **状态图标**
   - **可连接**：显示"+"或"连接"图标
   - **待审批**：显示"时钟"或"等待"图标
   - **已连接**：显示"✓"或"已连接"图标
   - **已拒绝**：显示"✗"或"已拒绝"图标

3. **状态文字**
   - **可连接**："请求连接"
   - **待审批**："等待审批"
   - **已连接**："已连接"或"进入"
   - **已拒绝**："已拒绝"或"重新请求"

### 4.3 交互反馈

**目标**: 通过交互反馈增强用户体验

**详细需求**:

1. **悬停效果**
   - **卡片放大**：鼠标悬停时卡片轻微放大
   - **星光增强**：悬停时星光效果增强
   - **信息显示**：显示更多信息（如状态说明）

2. **点击反馈**
   - **点击动画**：点击时有按压反馈动画
   - **状态切换动画**：状态切换时的平滑过渡动画
   - **成功反馈**：操作成功时的确认动画

3. **加载状态**
   - **请求发送**：发送请求时显示加载动画
   - **审批处理**：审批处理时显示加载动画
   - **状态更新**：状态更新时的过渡动画

---

## 五、技术实现方案

### 5.1 数据结构设计

```typescript
// 共享配置
interface ShareConfig {
  id: number;
  userId: number;
  shareType: 'all' | 'partial' | 'single';
  sharedEraIds: number[]; // 共享的场景ID列表（部分共享时）
  shareCode: string; // 共享码
  shareLink: string; // 分享链接
  description?: string; // 共享描述
  permission: 'approval' | 'free' | 'invite'; // 连接权限
  status: 'active' | 'paused' | 'closed'; // 共享状态
  createdAt: number;
  updatedAt: number;
}

// 连接请求
interface ConnectionRequest {
  id: number;
  shareConfigId: number; // 关联的共享配置
  requesterId: number; // 申请者ID
  ownerId: number; // 心域主人ID
  message?: string; // 请求消息
  status: 'pending' | 'approved' | 'rejected' | 'cancelled';
  createdAt: number;
  respondedAt?: number;
  responseMessage?: string; // 审批回复消息
}

// 连接关系
interface Connection {
  id: number;
  shareConfigId: number;
  visitorId: number; // 访问者ID
  ownerId: number; // 心域主人ID
  status: 'active' | 'disconnected';
  connectedAt: number;
  lastVisitAt?: number;
  visitCount: number;
}
```

### 5.2 API接口设计

**后端接口**:

1. `POST /api/share/create` - 创建共享配置
   - 请求体：`{ shareType, sharedEraIds, description, permission }`
   - 返回：共享配置（包含shareCode和shareLink）

2. `PUT /api/share/{id}` - 更新共享配置
   - 请求体：`{ shareType, sharedEraIds, description, permission, status }`
   - 返回：更新后的共享配置

3. `GET /api/share/{shareCode}` - 获取共享信息（公开）
   - 返回：共享配置和心域基本信息

4. `GET /api/share/my` - 获取我的共享配置
   - 返回：当前用户的共享配置列表

5. `POST /api/share/connection-request` - 发送连接请求
   - 请求体：`{ shareCode, message }`
   - 返回：连接请求信息

6. `GET /api/share/connection-requests` - 获取连接请求列表（主人视角）
   - 请求参数：`status` (pending/approved/rejected)
   - 返回：连接请求列表

7. `PUT /api/share/connection-request/{id}` - 审批连接请求
   - 请求体：`{ status: 'approved' | 'rejected', responseMessage? }`
   - 返回：操作结果

8. `GET /api/share/connections` - 获取连接列表
   - 返回：已建立的连接列表

9. `DELETE /api/share/connection/{id}` - 断开连接
   - 返回：操作结果

10. `GET /api/share/discover` - 发现共享心域（公开）
    - 请求参数：`keyword`, `tags`, `sort`, `page`, `size`
    - 返回：共享心域列表

### 5.3 数据库设计

```sql
-- 共享配置表
CREATE TABLE share_configs (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL COMMENT '心域主人ID',
  share_type VARCHAR(20) NOT NULL COMMENT '共享类型：all, partial, single',
  shared_era_ids TEXT COMMENT '共享的场景ID列表（JSON数组）',
  share_code VARCHAR(20) NOT NULL COMMENT '共享码',
  share_link VARCHAR(500) COMMENT '分享链接',
  description TEXT COMMENT '共享描述',
  permission VARCHAR(20) NOT NULL DEFAULT 'approval' COMMENT '连接权限：approval, free, invite',
  status VARCHAR(20) NOT NULL DEFAULT 'active' COMMENT '状态：active, paused, closed',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  UNIQUE KEY uk_share_code (share_code),
  INDEX idx_user_id (user_id),
  INDEX idx_status (status)
);

-- 连接请求表
CREATE TABLE connection_requests (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  share_config_id BIGINT NOT NULL COMMENT '共享配置ID',
  requester_id BIGINT NOT NULL COMMENT '申请者ID',
  owner_id BIGINT NOT NULL COMMENT '心域主人ID',
  message TEXT COMMENT '请求消息',
  status VARCHAR(20) NOT NULL DEFAULT 'pending' COMMENT '状态：pending, approved, rejected, cancelled',
  response_message TEXT COMMENT '审批回复消息',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  responded_at DATETIME NULL COMMENT '审批时间',
  FOREIGN KEY (share_config_id) REFERENCES share_configs(id) ON DELETE CASCADE,
  FOREIGN KEY (requester_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (owner_id) REFERENCES users(id) ON DELETE CASCADE,
  INDEX idx_share_config (share_config_id),
  INDEX idx_requester (requester_id),
  INDEX idx_owner_status (owner_id, status),
  UNIQUE KEY uk_share_requester (share_config_id, requester_id)
);

-- 连接关系表
CREATE TABLE connections (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  share_config_id BIGINT NOT NULL COMMENT '共享配置ID',
  visitor_id BIGINT NOT NULL COMMENT '访问者ID',
  owner_id BIGINT NOT NULL COMMENT '心域主人ID',
  status VARCHAR(20) NOT NULL DEFAULT 'active' COMMENT '状态：active, disconnected',
  connected_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '连接时间',
  last_visit_at DATETIME NULL COMMENT '最后访问时间',
  visit_count INT DEFAULT 0 COMMENT '访问次数',
  FOREIGN KEY (share_config_id) REFERENCES share_configs(id) ON DELETE CASCADE,
  FOREIGN KEY (visitor_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (owner_id) REFERENCES users(id) ON DELETE CASCADE,
  INDEX idx_share_config (share_config_id),
  INDEX idx_visitor (visitor_id),
  INDEX idx_owner (owner_id),
  UNIQUE KEY uk_share_visitor (share_config_id, visitor_id)
);
```

---

## 六、实施计划

### 6.1 第一阶段：共享配置功能（1-2周）

- [ ] 设计共享配置界面
- [ ] 实现共享范围选择（全部/部分/单个）
- [ ] 实现共享权限设置
- [ ] 实现共享码和链接生成
- [ ] 实现共享状态管理

### 6.2 第二阶段：连接请求系统（1-2周）

- [ ] 实现共享心域发现界面
- [ ] 实现心域卡片展示（带状态颜色）
- [ ] 实现连接请求发送功能
- [ ] 实现连接请求审批功能
- [ ] 实现连接状态管理

### 6.3 第三阶段：视觉优化（1周）

- [ ] 实现共享心域的星光效果增强
- [ ] 实现状态颜色的视觉区分
- [ ] 实现交互反馈动画
- [ ] 优化整体视觉体验

### 6.4 第四阶段：测试和优化（1周）

- [ ] 功能测试
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] Bug修复

---

## 七、预期效果

1. **灵活性**：用户可以根据需要灵活选择共享范围
2. **安全性**：通过审批机制确保用户对共享内容的控制
3. **吸引力**：共享心域的视觉呈现更加吸引人
4. **易用性**：共享和连接的流程简单直观

---

**下一阶段预览**: 
- 第三阶段将涵盖访问他人心域功能（体验模式、数据隔离、暖心留言等）

