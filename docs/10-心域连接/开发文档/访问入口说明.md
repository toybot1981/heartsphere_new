# 心域共享访问入口说明

**文档版本**: V1.0  
**更新日期**: 2025-12-28

---

## 一、访问入口位置

### 1.1 分享链接访问

**URL格式**: `http://localhost:5173/share/{shareCode}`

**示例**: 
- `http://localhost:5173/share/HS-A3B7C9`
- `http://localhost:5173/share/HS-XXXXXX`

**说明**:
- 通过分享链接或共享码访问他人心域
- 自动检测体验模式并处理连接请求

### 1.2 共享配置入口

**位置**: 个人中心、场景管理页面等

**组件**: `ShareButton`

**使用方式**:
```tsx
import { ShareButton } from '@/components/heartsphere-share/ShareButton';

// 在个人中心
<ShareButton variant="button" />

// 在导航栏
<ShareButton variant="icon" />

// 在场景管理
<ShareButton variant="text" />
```

---

## 二、访问流程

### 2.1 通过分享链接访问

1. **用户A创建共享配置**
   - 点击"共享心域"按钮
   - 设置共享范围和权限
   - 获取共享码和分享链接

2. **用户B访问分享链接**
   - 打开分享链接：`/share/{shareCode}`
   - 系统自动加载共享配置
   - 根据权限类型处理：
     - **自由连接**：直接进入体验模式
     - **需要审批**：显示连接请求模态框

3. **进入体验模式**
   - 自动设置体验模式上下文
   - 显示体验模式标识栏
   - 数据自动隔离

### 2.2 通过共享码访问

1. **用户B输入共享码**
   - 在应用中输入共享码
   - 或直接访问 `/share/{shareCode}`

2. **系统处理**
   - 验证共享码
   - 加载共享配置
   - 根据权限处理连接

---

## 三、集成位置

### 3.1 在个人中心添加

```tsx
// 在 UserProfile 组件中
import { ShareButton } from '@/components/heartsphere-share/ShareButton';

function UserProfile() {
  return (
    <div>
      <h1>个人中心</h1>
      <ShareButton variant="button" />
      {/* 其他内容 */}
    </div>
  );
}
```

### 3.2 在导航栏添加

```tsx
// 在导航栏组件中
import { ShareButton } from '@/components/heartsphere-share/ShareButton';

function NavigationBar() {
  return (
    <nav>
      <ShareButton variant="icon" />
      {/* 其他导航项 */}
    </nav>
  );
}
```

### 3.3 在场景管理添加

```tsx
// 在场景管理页面
import { ShareButton } from '@/components/heartsphere-share/ShareButton';

function SceneManagement() {
  return (
    <div>
      <div className="flex items-center justify-between">
        <h1>场景管理</h1>
        <ShareButton variant="text" />
      </div>
      {/* 场景列表 */}
    </div>
  );
}
```

---

## 四、URL路由配置

### 4.1 当前实现

应用使用基于路径的简单路由（不依赖React Router）：

```typescript
// 在 App.tsx 中
const pathname = window.location.pathname;
const shareMatch = pathname.match(/^\/share\/(.+)$/);
if (shareMatch) {
  const shareCode = shareMatch[1];
  return <SharePageSimple shareCode={shareCode} />;
}
```

### 4.2 访问路径

- **分享页面**: `/share/{shareCode}`
- **主应用**: `/` 或其他路径

---

## 五、使用示例

### 5.1 创建共享配置

```tsx
import { ShareButton } from '@/components/heartsphere-share/ShareButton';

function MyComponent() {
  return (
    <div>
      <ShareButton 
        variant="button"
        className="my-custom-class"
      />
    </div>
  );
}
```

### 5.2 访问分享链接

用户访问：`http://localhost:5173/share/HS-A3B7C9`

系统自动：
1. 加载共享配置
2. 检查访问权限
3. 处理连接请求或直接进入体验模式

---

## 六、注意事项

1. **URL格式**: 确保共享码格式正确（HS-XXXXXX）
2. **权限检查**: 系统会自动检查访问权限
3. **登录状态**: 某些操作需要用户登录
4. **体验模式**: 进入体验模式后会自动显示标识栏

---

## 七、测试访问

### 7.1 测试步骤

1. **创建共享配置**:
   - 登录用户A
   - 点击"共享心域"按钮
   - 创建共享配置，获取共享码

2. **访问分享链接**:
   - 在浏览器中访问：`http://localhost:5173/share/{shareCode}`
   - 或使用共享码访问

3. **验证功能**:
   - 检查页面是否正确加载
   - 检查权限处理是否正确
   - 检查体验模式是否正确进入

---

**文档维护**: 如有变更，请及时更新本文档



