# 心域连接后台管理端需求分析

**文档版本**: V1.0  
**编写日期**: 2025-12-29  
**功能模块**: 心域连接后台管理端  
**目标**: 为管理员提供心域连接功能的统一管理和监控平台

---

## 一、需求概述

### 1.1 背景

心域连接功能包括三个阶段：
1. **第一阶段**：快速连接心域内部的E-SOUL
2. **第二阶段**：心域外部共享（分享心域给其他用户）
3. **第三阶段**：访问他人心域体验（体验模式和暖心留言）

为了有效管理和监控这些功能，需要提供后台管理端，让管理员能够：
- 监控心域连接的使用情况
- 管理共享配置和连接请求
- 处理异常情况和投诉
- 查看统计数据和报表

### 1.2 核心功能

- ✅ **共享配置管理**：管理用户的共享配置
- ✅ **连接请求管理**：管理用户之间的连接请求
- ✅ **访问记录管理**：查看和管理访问记录
- ✅ **留言管理**：管理暖心留言
- ✅ **数据统计**：查看使用统计和数据分析
- ✅ **异常处理**：处理异常情况和投诉

### 1.3 设计目标

1. **统一管理**：统一管理所有心域连接相关功能
2. **实时监控**：实时监控使用情况和异常
3. **数据可视化**：通过图表和报表展示数据
4. **便捷操作**：提供便捷的管理操作
5. **权限控制**：完善的权限控制机制

---

## 二、功能需求分析

### 2.1 共享配置管理模块

#### 2.1.1 功能描述

管理用户的共享配置，包括查看、审核、禁用等操作。

#### 2.1.2 功能内容

**1. 共享配置列表**

- **列表展示**：显示所有用户的共享配置列表
- **筛选功能**：按用户、共享类型、状态等筛选
- **搜索功能**：支持搜索用户名称、心域名称等
- **排序功能**：支持按创建时间、使用次数等排序

**2. 共享配置详情**

- **基本信息**：查看共享配置的基本信息（用户、心域、共享类型等）
- **共享范围**：查看共享的场景列表和权限设置
- **使用统计**：查看共享配置的使用统计（访问次数、访问人数等）
- **状态信息**：查看共享配置的状态（启用/禁用/暂停）

**3. 共享配置操作**

- **查看详情**：查看共享配置的详细信息
- **禁用/启用**：禁用或启用共享配置
- **暂停共享**：临时暂停共享
- **删除配置**：删除共享配置（需谨慎）
- **导出数据**：导出共享配置数据

**4. 批量操作**

- **批量禁用**：批量禁用共享配置
- **批量删除**：批量删除共享配置
- **批量导出**：批量导出数据

---

### 2.2 连接请求管理模块

#### 2.2.1 功能描述

管理用户之间的连接请求，包括查看、审核、处理等操作。

#### 2.2.2 功能内容

**1. 连接请求列表**

- **列表展示**：显示所有连接请求列表
- **状态筛选**：按状态筛选（待处理/已同意/已拒绝/已取消）
- **时间筛选**：按时间范围筛选
- **用户筛选**：按申请用户或目标用户筛选

**2. 连接请求详情**

- **请求信息**：查看请求的详细信息（申请用户、目标用户、申请时间等）
- **处理历史**：查看请求的处理历史
- **关联信息**：查看关联的共享配置信息

**3. 连接请求操作**

- **查看详情**：查看连接请求的详细信息
- **审核请求**：审核连接请求（同意/拒绝）
- **取消请求**：取消连接请求
- **批量处理**：批量处理连接请求

**4. 异常处理**

- **异常请求识别**：识别异常的连接请求（如频繁申请、恶意申请等）
- **处理异常**：处理异常请求（如拒绝、限制等）
- **记录日志**：记录异常处理日志

---

### 2.3 访问记录管理模块

#### 2.3.1 功能描述

查看和管理用户访问他人心域的记录。

#### 2.3.2 功能内容

**1. 访问记录列表**

- **列表展示**：显示所有访问记录
- **筛选功能**：按访问者、被访问者、时间等筛选
- **统计信息**：显示访问次数、访问时长等统计信息

**2. 访问记录详情**

- **访问信息**：查看访问的详细信息（访问者、被访问者、访问时间、访问时长等）
- **访问场景**：查看访问了哪些场景
- **访问行为**：查看访问行为（如对话轮数等，不包含详细内容）

**3. 访问记录操作**

- **查看详情**：查看访问记录的详细信息
- **导出数据**：导出访问记录数据
- **统计分析**：进行访问数据的统计分析

---

### 2.4 留言管理模块

#### 2.4.1 功能描述

管理用户之间的暖心留言，包括查看、审核、删除等操作。

#### 2.4.2 功能内容

**1. 留言列表**

- **列表展示**：显示所有留言列表
- **筛选功能**：按留言者、接收者、留言类型、时间等筛选
- **搜索功能**：支持搜索留言内容（脱敏后）

**2. 留言详情**

- **留言信息**：查看留言的详细信息（留言者、接收者、留言内容、留言类型等）
- **回复信息**：查看留言的回复信息（如果有）
- **关联信息**：查看关联的共享配置和访问记录

**3. 留言操作**

- **查看详情**：查看留言的详细信息
- **审核留言**：审核留言内容（如发现不当内容）
- **删除留言**：删除不当留言
- **回复管理**：管理留言的回复（如删除不当回复）

**4. 内容审核**

- **自动审核**：系统自动审核留言内容
- **人工审核**：人工审核可疑留言
- **违规处理**：处理违规留言

---

### 2.5 数据统计模块

#### 2.5.1 功能描述

提供心域连接功能的数据统计和分析。

#### 2.5.2 功能内容

**1. 总体统计**

- **用户统计**：共享用户数、连接用户数、访问用户数等
- **共享统计**：共享配置总数、活跃共享数、共享类型分布等
- **连接统计**：连接请求总数、成功连接数、连接成功率等
- **访问统计**：访问总次数、访问总时长、平均访问时长等
- **留言统计**：留言总数、留言类型分布、回复率等

**2. 趋势分析**

- **时间趋势**：按时间维度分析使用趋势（日/周/月）
- **增长趋势**：分析各项指标的增长趋势
- **活跃度分析**：分析用户活跃度变化

**3. 数据可视化**

- **图表展示**：使用图表展示统计数据（柱状图、折线图、饼图等）
- **报表生成**：生成统计报表
- **数据导出**：导出统计数据

**4. 自定义统计**

- **自定义查询**：支持自定义查询条件
- **自定义报表**：支持生成自定义报表
- **数据对比**：支持不同时间段的数据对比

---

### 2.6 异常处理模块

#### 2.6.1 功能描述

处理心域连接功能中的异常情况和投诉。

#### 2.6.2 功能内容

**1. 异常监控**

- **异常识别**：自动识别异常情况（如异常访问、恶意连接等）
- **异常列表**：显示异常情况列表
- **异常分类**：按类型分类异常情况

**2. 投诉处理**

- **投诉列表**：显示用户投诉列表
- **投诉详情**：查看投诉的详细信息
- **投诉处理**：处理用户投诉
- **处理反馈**：向用户反馈处理结果

**3. 违规处理**

- **违规识别**：识别违规行为（如恶意共享、不当留言等）
- **违规处理**：处理违规行为（如禁用、限制等）
- **处理记录**：记录违规处理记录

**4. 安全监控**

- **安全事件**：监控安全相关事件
- **风险评估**：评估系统安全风险
- **应急响应**：对安全事件进行应急响应

---

## 三、界面设计需求

### 3.1 主界面布局

- **顶部导航**：功能模块导航栏
- **左侧菜单**：功能菜单列表
- **主内容区**：显示具体功能内容
- **底部信息**：系统信息和版权信息

### 3.2 功能模块界面

**1. 共享配置管理界面**

- **列表视图**：表格形式展示共享配置列表
- **详情视图**：弹窗或页面形式展示详情
- **操作按钮**：禁用、启用、删除等操作按钮
- **筛选搜索**：筛选和搜索功能区域

**2. 连接请求管理界面**

- **列表视图**：表格形式展示连接请求列表
- **详情视图**：弹窗形式展示请求详情
- **审核操作**：同意、拒绝等审核按钮
- **状态标识**：不同状态的颜色标识

**3. 访问记录管理界面**

- **列表视图**：表格形式展示访问记录
- **详情视图**：弹窗形式展示访问详情
- **统计图表**：访问统计图表
- **导出功能**：数据导出按钮

**4. 留言管理界面**

- **列表视图**：卡片或表格形式展示留言列表
- **详情视图**：弹窗形式展示留言详情
- **内容预览**：留言内容预览（脱敏后）
- **审核操作**：审核、删除等操作按钮

**5. 数据统计界面**

- **仪表板**：总体统计仪表板
- **图表区域**：各种统计图表
- **时间选择**：时间范围选择器
- **报表导出**：报表导出功能

**6. 异常处理界面**

- **异常列表**：异常情况列表
- **详情视图**：异常详情和处理界面
- **处理操作**：处理异常的操作按钮
- **处理记录**：处理历史记录

---

## 四、权限设计

### 4.1 角色定义

- **超级管理员**：拥有所有权限
- **运营管理员**：拥有日常管理权限（查看、审核、处理）
- **数据管理员**：拥有数据查看和导出权限
- **客服管理员**：拥有投诉处理和用户服务权限

### 4.2 权限列表

**1. 共享配置管理权限**

- **查看权限**：查看共享配置列表和详情
- **编辑权限**：编辑共享配置（禁用/启用/删除）
- **导出权限**：导出共享配置数据

**2. 连接请求管理权限**

- **查看权限**：查看连接请求列表和详情
- **审核权限**：审核连接请求（同意/拒绝）
- **处理权限**：处理异常请求

**3. 访问记录管理权限**

- **查看权限**：查看访问记录列表和详情
- **导出权限**：导出访问记录数据
- **统计权限**：查看访问统计数据

**4. 留言管理权限**

- **查看权限**：查看留言列表和详情
- **审核权限**：审核留言内容
- **删除权限**：删除不当留言

**5. 数据统计权限**

- **查看权限**：查看统计数据
- **导出权限**：导出统计数据
- **报表权限**：生成统计报表

**6. 异常处理权限**

- **查看权限**：查看异常情况
- **处理权限**：处理异常和投诉
- **管理权限**：管理异常处理规则

---

## 五、数据结构设计

### 5.1 管理操作日志表

**表名**: `admin_operation_logs`

**字段设计**:
- `id` (BIGINT, PRIMARY KEY): 日志ID
- `admin_id` (BIGINT, NOT NULL): 管理员ID
- `operation_type` (VARCHAR, NOT NULL): 操作类型（view/edit/delete/export）
- `module` (VARCHAR, NOT NULL): 功能模块
- `target_id` (BIGINT): 目标对象ID
- `operation_content` (TEXT): 操作内容
- `operation_result` (VARCHAR): 操作结果（success/failed）
- `ip_address` (VARCHAR): IP地址
- `created_at` (DATETIME, DEFAULT CURRENT_TIMESTAMP): 操作时间

**索引**:
- `idx_admin_time` (admin_id, created_at)
- `idx_module` (module, created_at)

---

### 5.2 异常处理记录表

**表名**: `exception_handling_records`

**字段设计**:
- `id` (BIGINT, PRIMARY KEY): 记录ID
- `exception_type` (VARCHAR, NOT NULL): 异常类型
- `exception_content` (TEXT, NOT NULL): 异常内容
- `related_user_id` (BIGINT): 相关用户ID
- `related_data_id` (BIGINT): 相关数据ID
- `severity` (VARCHAR, NOT NULL): 严重程度（high/medium/low）
- `status` (VARCHAR, NOT NULL): 处理状态（pending/processing/resolved）
- `handler_id` (BIGINT): 处理人ID
- `handle_result` (TEXT): 处理结果
- `created_at` (DATETIME, DEFAULT CURRENT_TIMESTAMP): 创建时间
- `updated_at` (DATETIME, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP): 更新时间

**索引**:
- `idx_status` (status, severity, created_at)
- `idx_handler` (handler_id)

---

## 六、API接口设计

### 6.1 共享配置管理接口

**接口**: `GET /api/admin/heartsphere-connection/share-configs`

**功能**: 获取共享配置列表

**请求参数**:
- `userId` (long): 用户ID
- `shareType` (string): 共享类型
- `status` (string): 状态
- `page` (integer): 页码
- `size` (integer): 每页数量

**响应数据**:
- `configs` (array): 共享配置列表
- `total` (integer): 总记录数

---

**接口**: `GET /api/admin/heartsphere-connection/share-configs/{id}`

**功能**: 获取共享配置详情

**响应数据**:
- `config` (object): 共享配置详情
- `statistics` (object): 使用统计

---

**接口**: `POST /api/admin/heartsphere-connection/share-configs/{id}/disable`

**功能**: 禁用共享配置

**响应数据**:
- `success` (boolean): 是否成功

---

### 6.2 连接请求管理接口

**接口**: `GET /api/admin/heartsphere-connection/connection-requests`

**功能**: 获取连接请求列表

**请求参数**:
- `status` (string): 状态
- `startDate` (date): 开始日期
- `endDate` (date): 结束日期
- `page` (integer): 页码
- `size` (integer): 每页数量

**响应数据**:
- `requests` (array): 连接请求列表
- `total` (integer): 总记录数

---

**接口**: `POST /api/admin/heartsphere-connection/connection-requests/{id}/approve`

**功能**: 审核通过连接请求

**响应数据**:
- `success` (boolean): 是否成功

---

**接口**: `POST /api/admin/heartsphere-connection/connection-requests/{id}/reject`

**功能**: 拒绝连接请求

**请求参数**:
- `reason` (string): 拒绝原因

**响应数据**:
- `success` (boolean): 是否成功

---

### 6.3 访问记录管理接口

**接口**: `GET /api/admin/heartsphere-connection/access-records`

**功能**: 获取访问记录列表

**请求参数**:
- `visitorId` (long): 访问者ID
- `ownerId` (long): 心域主人ID
- `startDate` (date): 开始日期
- `endDate` (date): 结束日期
- `page` (integer): 页码
- `size` (integer): 每页数量

**响应数据**:
- `records` (array): 访问记录列表
- `total` (integer): 总记录数

---

**接口**: `GET /api/admin/heartsphere-connection/access-records/{id}`

**功能**: 获取访问记录详情

**响应数据**:
- `record` (object): 访问记录详情

---

**接口**: `POST /api/admin/heartsphere-connection/access-records/export`

**功能**: 导出访问记录

**请求参数**:
- `conditions` (object): 导出条件

**响应数据**:
- `exportId` (long): 导出任务ID
- `downloadUrl` (string): 下载链接

---

### 6.4 留言管理接口

**接口**: `GET /api/admin/heartsphere-connection/warm-messages`

**功能**: 获取留言列表

**请求参数**:
- `visitorId` (long): 留言者ID
- `ownerId` (long): 接收者ID
- `contentType` (string): 留言类型
- `startDate` (date): 开始日期
- `endDate` (date): 结束日期
- `page` (integer): 页码
- `size` (integer): 每页数量

**响应数据**:
- `messages` (array): 留言列表（脱敏后）
- `total` (integer): 总记录数

---

**接口**: `GET /api/admin/heartsphere-connection/warm-messages/{id}`

**功能**: 获取留言详情

**响应数据**:
- `message` (object): 留言详情（脱敏后）

---

**接口**: `DELETE /api/admin/heartsphere-connection/warm-messages/{id}`

**功能**: 删除留言（需要权限）

**请求参数**:
- `reason` (string): 删除原因

**响应数据**:
- `success` (boolean): 是否成功

---

### 6.5 数据统计接口

**接口**: `GET /api/admin/heartsphere-connection/statistics/overview`

**功能**: 获取总体统计数据

**请求参数**:
- `timeRange` (object): 时间范围

**响应数据**:
- `userStats` (object): 用户统计
- `shareStats` (object): 共享统计
- `connectionStats` (object): 连接统计
- `accessStats` (object): 访问统计
- `messageStats` (object): 留言统计

---

**接口**: `GET /api/admin/heartsphere-connection/statistics/trends`

**功能**: 获取趋势分析数据

**请求参数**:
- `metric` (string): 指标类型
- `timeRange` (object): 时间范围
- `granularity` (string): 粒度（day/week/month）

**响应数据**:
- `trends` (array): 趋势数据
- `charts` (array): 图表数据

---

**接口**: `POST /api/admin/heartsphere-connection/statistics/report`

**功能**: 生成统计报表

**请求参数**:
- `reportType` (string, required): 报表类型
- `timeRange` (object, required): 时间范围
- `format` (string): 报表格式（pdf/excel/html）

**响应数据**:
- `reportId` (long): 报表ID
- `downloadUrl` (string): 下载链接

---

### 6.6 异常处理接口

**接口**: `GET /api/admin/heartsphere-connection/exceptions`

**功能**: 获取异常情况列表

**请求参数**:
- `exceptionType` (string): 异常类型
- `severity` (string): 严重程度
- `status` (string): 处理状态
- `page` (integer): 页码
- `size` (integer): 每页数量

**响应数据**:
- `exceptions` (array): 异常情况列表
- `total` (integer): 总记录数

---

**接口**: `POST /api/admin/heartsphere-connection/exceptions/{id}/handle`

**功能**: 处理异常情况

**请求参数**:
- `handleAction` (string, required): 处理操作
- `handleResult` (string, required): 处理结果
- `notes` (string): 处理备注

**响应数据**:
- `success` (boolean): 是否成功

---

**接口**: `GET /api/admin/heartsphere-connection/complaints`

**功能**: 获取投诉列表

**请求参数**:
- `status` (string): 处理状态
- `page` (integer): 页码
- `size` (integer): 每页数量

**响应数据**:
- `complaints` (array): 投诉列表
- `total` (integer): 总记录数

---

**接口**: `POST /api/admin/heartsphere-connection/complaints/{id}/handle`

**功能**: 处理投诉

**请求参数**:
- `handleResult` (string, required): 处理结果
- `responseMessage` (string): 回复消息
- `notes` (string): 处理备注

**响应数据**:
- `success` (boolean): 是否成功

---

## 七、实施计划

### 7.1 第一阶段：基础功能（1-2周）

- [ ] 设计管理端整体架构
- [ ] 开发共享配置管理功能
- [ ] 开发连接请求管理功能
- [ ] 开发基础的数据展示功能
- [ ] 实现权限控制

### 7.2 第二阶段：扩展功能（1周）

- [ ] 开发访问记录管理功能
- [ ] 开发留言管理功能
- [ ] 开发数据统计功能
- [ ] 实现数据可视化

### 7.3 第三阶段：异常处理（1周）

- [ ] 开发异常监控功能
- [ ] 开发投诉处理功能
- [ ] 开发违规处理功能
- [ ] 实现安全监控

### 7.4 第四阶段：优化完善（1周）

- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 功能测试
- [ ] 文档完善

---

## 八、验收标准

### 8.1 功能验收

- ✅ 共享配置管理功能完整可用
- ✅ 连接请求管理功能正常
- ✅ 访问记录管理功能完整
- ✅ 留言管理功能可用
- ✅ 数据统计功能正常
- ✅ 异常处理功能有效
- ✅ 权限控制完善

### 8.2 性能验收

- ✅ 页面加载时间 < 2秒
- ✅ 数据查询响应时间 < 1秒
- ✅ 报表生成时间 < 30秒
- ✅ 系统稳定可靠

### 8.3 用户体验验收

- ✅ 界面简洁直观，易于操作
- ✅ 数据展示清晰明了
- ✅ 操作流程顺畅
- ✅ 错误提示友好

---

## 九、风险和注意事项

### 9.1 技术风险

- **数据量大**：随着用户增长，数据量可能很大，需要优化查询性能
- **并发访问**：管理端可能有多个管理员同时访问，需要处理并发
- **数据安全**：管理端涉及敏感数据，需要严格的安全措施

### 9.2 业务风险

- **权限滥用**：需要严格权限控制，防止权限滥用
- **误操作**：需要操作确认机制，防止误操作
- **数据泄露**：需要数据脱敏，保护用户隐私

### 9.3 注意事项

- 所有操作都要有完整的日志记录
- 敏感数据要进行脱敏处理
- 重要操作需要权限确认
- 定期备份管理数据
- 建立异常监控和告警机制

---

**文档状态**: 需求分析已完成
