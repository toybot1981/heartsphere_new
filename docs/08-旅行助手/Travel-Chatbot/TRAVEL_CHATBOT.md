# æ—…æ¸¸å‡ºè¡ŒåŠ©æ‰‹ Chatbot - å¤š Agent ååŒæ¶æ„

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### å¤š Agent ååŒæ¶æ„

```
ç”¨æˆ·å¯¹è¯
    â†“
ä¸»æ—…æ¸¸åŠ©æ‰‹ Agent (travel-chat-assistant)
    â†“
æ„å›¾è¯†åˆ« â†’ è·¯ç”±åˆ°ä¸“é—¨ Agent
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸“é—¨ Agentï¼ˆå¹¶è¡Œæˆ–é¡ºåºæ‰§è¡Œï¼‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ flight-search-agent (èˆªç­æŸ¥è¯¢)    â”‚
â”‚ â€¢ hotel-search-agent (é…’åº—æŸ¥è¯¢)      â”‚
â”‚ â€¢ itinerary-planning-agent (è¡Œç¨‹è§„åˆ’)â”‚
â”‚ â€¢ booking-agent (é¢„è®¢å¤„ç†)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç»“æœæ•´åˆ â†’ è¿”å›ç»™ç”¨æˆ·
```

## ğŸ¤– Agent åˆ—è¡¨

### 1. ä¸»æ—…æ¸¸åŠ©æ‰‹ Agent
- **ID**: `travel-chat-assistant`
- **ç±»å‹**: å¯¹è¯å¼ Agent
- **èŒè´£**: 
  - ç†è§£ç”¨æˆ·æ„å›¾
  - è·¯ç”±åˆ°ç›¸åº”çš„ä¸“é—¨ Agent
  - æ•´åˆå¤šä¸ª Agent çš„ç»“æœ
  - æä¾›å‹å¥½çš„å¯¹è¯ä½“éªŒ

### 2. ä¸“é—¨ Agent

#### èˆªç­æŸ¥è¯¢ä¸“å®¶ (flight-search-agent)
- **èŒè´£**: ä¸“é—¨å¤„ç†èˆªç­æŸ¥è¯¢
- **å·¥å…·**: `search_flights`
- **èƒ½åŠ›**: ç†è§£å‡ºå‘åœ°ã€ç›®çš„åœ°ã€æ—¥æœŸï¼ŒæŸ¥è¯¢å¹¶å±•ç¤ºèˆªç­ä¿¡æ¯

#### é…’åº—æŸ¥è¯¢ä¸“å®¶ (hotel-search-agent)
- **èŒè´£**: ä¸“é—¨å¤„ç†é…’åº—æŸ¥è¯¢
- **å·¥å…·**: `search_hotels`
- **èƒ½åŠ›**: ç†è§£åŸå¸‚ã€æ—¥æœŸã€äººæ•°ã€æ˜Ÿçº§ï¼ŒæŸ¥è¯¢å¹¶å±•ç¤ºé…’åº—ä¿¡æ¯

#### è¡Œç¨‹è§„åˆ’ä¸“å®¶ (itinerary-planning-agent)
- **èŒè´£**: ä¸“é—¨è§„åˆ’æ—…è¡Œè¡Œç¨‹
- **å·¥å…·**: `get_travel_advice`
- **èƒ½åŠ›**: æ ¹æ®ç›®çš„åœ°ã€å¤©æ•°ã€å…´è¶£ã€é¢„ç®—ï¼Œè§„åˆ’å®Œæ•´è¡Œç¨‹

#### é¢„è®¢å¤„ç†ä¸“å®¶ (booking-agent)
- **èŒè´£**: ä¸“é—¨å¤„ç†é¢„è®¢äº‹åŠ¡
- **å·¥å…·**: `book_flight`, `book_hotel`
- **èƒ½åŠ›**: ç¡®è®¤é¢„è®¢ä¿¡æ¯ï¼Œå®Œæˆé¢„è®¢ï¼Œæä¾›ç¡®è®¤ç»“æœ

## ğŸ”„ å·¥ä½œæµè®¾è®¡

### è·¯ç”±å·¥ä½œæµ

ä¸» Agent ä½¿ç”¨è·¯ç”±å·¥ä½œæµï¼Œæ ¹æ®ç”¨æˆ·æ„å›¾æ™ºèƒ½è·¯ç”±ï¼š

1. **æ„å›¾è¯†åˆ«èŠ‚ç‚¹** (`intent_recognition`)
   - åˆ†æç”¨æˆ·æ¶ˆæ¯
   - è¯†åˆ«æ„å›¾ç±»å‹ï¼šflight_search, hotel_search, itinerary_planning, booking

2. **è·¯ç”±èŠ‚ç‚¹**
   - `flight_search_route` â†’ è°ƒç”¨èˆªç­æŸ¥è¯¢ Agent
   - `hotel_search_route` â†’ è°ƒç”¨é…’åº—æŸ¥è¯¢ Agent
   - `itinerary_planning_route` â†’ è°ƒç”¨è¡Œç¨‹è§„åˆ’ Agent
   - `booking_route` â†’ è°ƒç”¨é¢„è®¢å¤„ç† Agent

3. **ç»“æœæ•´åˆ**
   - æ”¶é›†å„ Agent çš„ç»“æœ
   - æ•´åˆä¸ºå®Œæ•´çš„å›å¤
   - è¿”å›ç»™ç”¨æˆ·

### å¤æ‚ä»»åŠ¡å·¥ä½œæµ

å¯¹äºå¤æ‚ä»»åŠ¡ï¼ˆå¦‚ï¼šæŸ¥è¯¢èˆªç­+é…’åº—+è§„åˆ’è¡Œç¨‹ï¼‰ï¼Œä¸» Agent å¯ä»¥ï¼š

1. **é¡ºåºæ‰§è¡Œ**
   - å…ˆæŸ¥è¯¢èˆªç­
   - å†æŸ¥è¯¢é…’åº—
   - æœ€åè§„åˆ’è¡Œç¨‹
   - æ•´åˆæ‰€æœ‰ç»“æœ

2. **å¹¶è¡Œæ‰§è¡Œ**
   - åŒæ—¶æŸ¥è¯¢èˆªç­å’Œé…’åº—
   - ç„¶åè§„åˆ’è¡Œç¨‹
   - æé«˜æ•ˆç‡

## ğŸ’¬ å¯¹è¯ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç®€å•æŸ¥è¯¢
```
ç”¨æˆ·: å¸®æˆ‘æŸ¥è¯¢ä»åŒ—äº¬åˆ°ä¸Šæµ·çš„èˆªç­ï¼Œ12æœˆ25æ—¥
  â†“
ä¸» Agent: è¯†åˆ«æ„å›¾ â†’ flight_search
  â†“
èˆªç­æŸ¥è¯¢ Agent: è°ƒç”¨ search_flights å·¥å…·
  â†“
ä¸» Agent: æ•´åˆç»“æœï¼Œè¿”å›ç»™ç”¨æˆ·
```

### ç¤ºä¾‹ 2: å¤æ‚ä»»åŠ¡
```
ç”¨æˆ·: æˆ‘æƒ³å»åŒ—äº¬æ—…æ¸¸3å¤©ï¼Œå¸®æˆ‘æŸ¥ä¸€ä¸‹èˆªç­å’Œé…’åº—ï¼Œå†è§„åˆ’ä¸€ä¸‹è¡Œç¨‹
  â†“
ä¸» Agent: è¯†åˆ«æ„å›¾ â†’ å¤šä¸ªæ„å›¾ï¼ˆflight_search + hotel_search + itinerary_planningï¼‰
  â†“
å¹¶è¡Œæ‰§è¡Œ:
  - èˆªç­æŸ¥è¯¢ Agent: æŸ¥è¯¢èˆªç­
  - é…’åº—æŸ¥è¯¢ Agent: æŸ¥è¯¢é…’åº—
  â†“
é¡ºåºæ‰§è¡Œ:
  - è¡Œç¨‹è§„åˆ’ Agent: è§„åˆ’è¡Œç¨‹ï¼ˆåŸºäºèˆªç­å’Œé…’åº—ç»“æœï¼‰
  â†“
ä¸» Agent: æ•´åˆæ‰€æœ‰ç»“æœï¼Œè¿”å›å®Œæ•´æ–¹æ¡ˆ
```

### ç¤ºä¾‹ 3: é¢„è®¢æµç¨‹
```
ç”¨æˆ·: æˆ‘æƒ³é¢„è®¢åˆšæ‰æŸ¥è¯¢çš„CA1234èˆªç­
  â†“
ä¸» Agent: è¯†åˆ«æ„å›¾ â†’ booking
  â†“
é¢„è®¢ Agent: 
  1. ç¡®è®¤èˆªç­ä¿¡æ¯
  2. è¯¢é—®ä¹˜å®¢ä¿¡æ¯
  3. è°ƒç”¨ book_flight å·¥å…·
  4. è¿”å›é¢„è®¢ç»“æœ
```

## ğŸ› ï¸ API ç«¯ç‚¹

### å¯¹è¯æ¥å£

#### åŒæ­¥å¯¹è¯
```bash
POST /api/travel/chat/message
Content-Type: application/json

{
  "message": "å¸®æˆ‘æŸ¥è¯¢ä»åŒ—äº¬åˆ°ä¸Šæµ·çš„èˆªç­",
  "userId": "user123",
  "history": [
    {"role": "user", "content": "ä½ å¥½"},
    {"role": "assistant", "content": "æ‚¨å¥½ï¼Œæˆ‘æ˜¯æ—…æ¸¸å‡ºè¡ŒåŠ©æ‰‹..."}
  ]
}
```

#### æµå¼å¯¹è¯ï¼ˆSSEï¼‰
```bash
POST /api/travel/chat/stream
Content-Type: application/json

{
  "message": "å¸®æˆ‘æŸ¥è¯¢ä»åŒ—äº¬åˆ°ä¸Šæµ·çš„èˆªç­",
  "userId": "user123"
}
```

å“åº”äº‹ä»¶ï¼š
- `start`: å¼€å§‹å¤„ç†
- `message`: æ¶ˆæ¯ç‰‡æ®µï¼ˆæµå¼è¾“å‡ºï¼‰
- `complete`: å®Œæˆ
- `error`: é”™è¯¯

### å¯¹è¯å†å²
```bash
GET /api/travel/chat/history?userId=user123
```

## ğŸ¨ å‰ç«¯ç•Œé¢

è®¿é—®åœ°å€: http://localhost:8082/travel-chatbot.html

### ç‰¹æ€§
- âœ… å¯¹è¯å¼äº¤äº’ç•Œé¢
- âœ… å®æ—¶æ¶ˆæ¯æ˜¾ç¤º
- âœ… æ‰“å­—æ•ˆæœï¼ˆæµå¼è¾“å‡ºï¼‰
- âœ… ç¤ºä¾‹æŸ¥è¯¢å¿«é€Ÿå…¥å£
- âœ… æš—è‰²æå®¢é£æ ¼
- âœ… å“åº”å¼è®¾è®¡

## ğŸ”§ æŠ€æœ¯å®ç°

### Agent æ‰§è¡Œæµç¨‹

1. **ç”¨æˆ·æ¶ˆæ¯** â†’ `TravelChatController`
2. **è·å–ä¸» Agent** â†’ `travel-chat-assistant`
3. **æ‰§è¡Œ Agent** â†’ æ ¹æ®å·¥ä½œæµè·¯ç”±
4. **å·¥å…·è°ƒç”¨** â†’ å„ä¸“é—¨ Agent è°ƒç”¨ç›¸åº”å·¥å…·
5. **ç»“æœæ•´åˆ** â†’ ä¸» Agent æ•´åˆç»“æœ
6. **è¿”å›ç”¨æˆ·** â†’ å‹å¥½çš„å¯¹è¯å›å¤

### å·¥å…·è°ƒç”¨æœºåˆ¶

æ¯ä¸ªä¸“é—¨ Agent é…ç½®äº†ç›¸åº”çš„å·¥å…·ï¼š
- èˆªç­æŸ¥è¯¢ Agent â†’ `search_flights`
- é…’åº—æŸ¥è¯¢ Agent â†’ `search_hotels`
- è¡Œç¨‹è§„åˆ’ Agent â†’ `get_travel_advice`
- é¢„è®¢å¤„ç† Agent â†’ `book_flight`, `book_hotel`

ä¸» Agent ä¹Ÿé…ç½®äº†æ‰€æœ‰å·¥å…·ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨æˆ–è·¯ç”±åˆ°ä¸“é—¨ Agentã€‚

## ğŸš€ éƒ¨ç½²è¯´æ˜

### 1. é‡å¯æœåŠ¡
```bash
lsof -ti:8082 | xargs kill -9
cd aistudio
mvn spring-boot:run
```

### 2. éªŒè¯ Agent
```bash
curl http://localhost:8082/api/agents | grep travel
```

åº”è¯¥çœ‹åˆ°ï¼š
- `travel-chat-assistant` (ä¸» Agent)
- `flight-search-agent`
- `hotel-search-agent`
- `itinerary-planning-agent`
- `booking-agent`

### 3. æµ‹è¯•å¯¹è¯
```bash
curl -X POST http://localhost:8082/api/travel/chat/message \
  -H "Content-Type: application/json" \
  -d '{
    "message": "å¸®æˆ‘æŸ¥è¯¢ä»åŒ—äº¬åˆ°ä¸Šæµ·çš„èˆªç­ï¼Œ12æœˆ25æ—¥",
    "userId": "test_user"
  }'
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### é€šè¿‡å‰ç«¯ç•Œé¢
1. è®¿é—® http://localhost:8082/travel-chatbot.html
2. åœ¨è¾“å…¥æ¡†è¾“å…¥é—®é¢˜
3. æˆ–ç‚¹å‡»ç¤ºä¾‹æŸ¥è¯¢å¿«é€Ÿå¼€å§‹

### é€šè¿‡ API
```bash
# æŸ¥è¯¢èˆªç­
curl -X POST http://localhost:8082/api/travel/chat/message \
  -H "Content-Type: application/json" \
  -d '{"message":"æŸ¥è¯¢ä»åŒ—äº¬åˆ°ä¸Šæµ·çš„èˆªç­ï¼Œ12æœˆ25æ—¥","userId":"user1"}'

# æŸ¥è¯¢é…’åº—
curl -X POST http://localhost:8082/api/travel/chat/message \
  -H "Content-Type: application/json" \
  -d '{"message":"æˆ‘æƒ³åœ¨åŒ—äº¬æ‰¾ä¸€å®¶4æ˜Ÿçº§é…’åº—ï¼Œ12æœˆ25æ—¥å…¥ä½ï¼Œ28æ—¥é€€æˆ¿","userId":"user1"}'

# è§„åˆ’è¡Œç¨‹
curl -X POST http://localhost:8082/api/travel/chat/message \
  -H "Content-Type: application/json" \
  -d '{"message":"å¸®æˆ‘è§„åˆ’ä¸€ä¸ª3å¤©çš„åŒ—äº¬æ—…æ¸¸è¡Œç¨‹ï¼Œé¢„ç®—ä¸­ç­‰","userId":"user1"}'
```

## ğŸ”® æœªæ¥æ‰©å±•

### MCP é›†æˆ
æœªæ¥å¯ä»¥é€šè¿‡ MCP å½¢å¼é›†æˆï¼š
1. **çœŸå®èˆªç­æ•°æ® MCP** - æ›¿æ¢æ¨¡æ‹Ÿæ•°æ®
2. **çœŸå®é…’åº—æ•°æ® MCP** - æ›¿æ¢æ¨¡æ‹Ÿæ•°æ®
3. **æ”¯ä»˜ç½‘å…³ MCP** - å®ŒæˆçœŸå®é¢„è®¢
4. **é€šçŸ¥æœåŠ¡ MCP** - å‘é€èˆªç­æé†’
5. **åœ°å›¾æœåŠ¡ MCP** - æä¾›å¯¼èˆªå’Œä½ç½®æœåŠ¡

### å·¥ä½œæµä¼˜åŒ–
1. **æ›´æ™ºèƒ½çš„è·¯ç”±** - åŸºäº LLM çš„æ„å›¾è¯†åˆ«
2. **å¹¶è¡Œä¼˜åŒ–** - è‡ªåŠ¨è¯†åˆ«å¯å¹¶è¡Œæ‰§è¡Œçš„ä»»åŠ¡
3. **ä¸Šä¸‹æ–‡è®°å¿†** - è®°ä½ç”¨æˆ·åå¥½å’Œå†å²
4. **å¤šè½®å¯¹è¯** - æ”¯æŒå¤æ‚çš„å¤šè½®äº¤äº’

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å½“å‰ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®** - å®é™…ç”Ÿäº§ç¯å¢ƒéœ€è¦é›†æˆçœŸå® API
2. **å¯¹è¯å†å²** - å½“å‰åœ¨å†…å­˜ä¸­ï¼Œå»ºè®®æŒä¹…åŒ–åˆ°æ•°æ®åº“
3. **æµå¼è¾“å‡º** - å½“å‰ç®€åŒ–å®ç°ï¼Œå¯ä»¥ä¼˜åŒ–ä¸ºçœŸæ­£çš„æµå¼è¾“å‡º
4. **é”™è¯¯å¤„ç†** - éœ€è¦æ›´å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
5. **ç”¨æˆ·è®¤è¯** - å»ºè®®æ·»åŠ ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶








