# 添加系统预设事件和物品端点说明

## 概述

前端已经更新为调用 `/api/scenario-events/system` 和 `/api/scenario-items/system` 端点来加载系统预设的事件和物品。需要在后端Controller中添加这些端点。

## 需要添加的代码

### 1. ScenarioEventController.java

在 `ScenarioEventController` 类中添加以下方法：

```java
@GetMapping("/system")
public ResponseEntity<ApiResponse<List<ScenarioEventDTO>>> getSystemEvents() {
    List<ScenarioEventDTO> events = scenarioEventService.getSystemEvents();
    return ResponseEntity.ok(ApiResponse.success(events));
}
```

### 2. ScenarioItemController.java

在 `ScenarioItemController` 类中添加以下方法：

```java
@GetMapping("/system")
public ResponseEntity<ApiResponse<List<ScenarioItemDTO>>> getSystemItems() {
    List<ScenarioItemDTO> items = scenarioItemService.getSystemItems();
    return ResponseEntity.ok(ApiResponse.success(items));
}
```

### 3. ScenarioEventService.java

确保 `ScenarioEventService` 类中有 `getSystemEvents` 方法。如果没有，添加：

```java
public List<ScenarioEventDTO> getSystemEvents() {
    return scenarioEventRepository.findByIsSystemTrueAndIsDeletedFalse().stream()
            .map(DTOMapper::toScenarioEventDTO)
            .collect(Collectors.toList());
}
```

### 4. ScenarioItemService.java

确保 `ScenarioItemService` 类中有 `getSystemItems` 方法。如果没有，添加：

```java
public List<ScenarioItemDTO> getSystemItems() {
    return scenarioItemRepository.findByIsSystemTrueAndIsDeletedFalse().stream()
            .map(DTOMapper::toScenarioItemDTO)
            .collect(Collectors.toList());
}
```

## 文件位置

根据标准Spring Boot结构，这些文件应该位于：

- `backend/src/main/java/com/heartsphere/controller/ScenarioEventController.java`
- `backend/src/main/java/com/heartsphere/controller/ScenarioItemController.java`
- `backend/src/main/java/com/heartsphere/service/ScenarioEventService.java`
- `backend/src/main/java/com/heartsphere/service/ScenarioItemService.java`

## Repository方法

确保Repository中有相应的方法：

- `ScenarioEventRepository.findByIsSystemTrueAndIsDeletedFalse()`
- `ScenarioItemRepository.findByIsSystemTrueAndIsDeletedFalse()`

这些方法应该已经在之前创建Repository时实现了。

## 前端代码

前端代码已经更新：

1. `frontend/services/api/scenario/event.ts` - 已添加 `getSystemEvents()` 方法
2. `frontend/services/api/scenario/item.ts` - 已添加 `getSystemItems()` 方法
3. `frontend/admin/components/EventsManagement.tsx` - 已更新为调用系统预设端点
4. `frontend/admin/components/ItemsManagement.tsx` - 已更新为调用系统预设端点

## 测试

添加端点后，可以通过以下方式测试：

```bash
# 测试系统预设事件端点
curl -X GET "http://localhost:8081/api/scenario-events/system" \
  -H "Authorization: Bearer <admin_token>"

# 测试系统预设物品端点
curl -X GET "http://localhost:8081/api/scenario-items/system" \
  -H "Authorization: Bearer <admin_token>"
```

## 注意事项

1. 这些端点可能需要管理员权限，确保在Controller方法上添加 `@PreAuthorize("hasRole('ADMIN')")` 注解（如果需要）
2. 确保DTO中包含 `systemEraId` 字段，以便前端能正确显示场景名称
3. 如果后端代码已经存在但端点缺失，只需要添加对应的Controller方法即可

