# åˆ é™¤æ—§åŒæ­¥æœåŠ¡ - è¿ç§»å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åˆ›å»ºåœºæ™¯æ˜ å°„å·¥å…·
- **æ–‡ä»¶**: `frontend/utils/sceneMapping.ts`
- **åŠŸèƒ½**: 
  - `getWorldIdForSceneId()` - è·å–åœºæ™¯å¯¹åº”çš„ä¸–ç•ŒID
  - `saveCustomSceneMapping()` - ä¿å­˜è‡ªå®šä¹‰åœºæ™¯æ˜ å°„
  - `initCustomSceneMappings()` - åˆå§‹åŒ–åœºæ™¯æ˜ å°„

### 2. å¢å¼ºæ–°çš„åŒæ­¥æœåŠ¡
- **æ–‡ä»¶**: `frontend/services/sync/SyncService.ts`
- **æ–°å¢**: `handleLocalDataChange()` æ–¹æ³•ï¼Œå®Œå…¨å…¼å®¹æ—§çš„API

### 3. æ›¿æ¢æ‰€æœ‰å¼•ç”¨
å·²æ›´æ–°ä»¥ä¸‹æ–‡ä»¶ï¼š
- âœ… `frontend/App.tsx` - ç§»é™¤æ—§å¯¼å…¥ï¼Œæ·»åŠ åœºæ™¯æ˜ å°„åˆå§‹åŒ–
- âœ… `frontend/hooks/useCharacterHandlers.ts` - ä½¿ç”¨æ–°çš„å·¥å…·å‡½æ•°
- âœ… `frontend/hooks/useScriptHandlers.ts` - ä½¿ç”¨æ–°çš„å·¥å…·å‡½æ•°
- âœ… `frontend/mobile/MobileApp.tsx` - ä½¿ç”¨æ–°çš„å·¥å…·å‡½æ•°å’ŒåŒæ­¥æœåŠ¡
- âœ… `frontend/hooks/useDataLoader.ts` - å·²ä½¿ç”¨æ–°çš„åŒæ­¥æœåŠ¡
- âœ… `frontend/hooks/useJournalHandlers.ts` - å·²ä½¿ç”¨æ–°çš„åŒæ­¥æœåŠ¡
- âœ… `frontend/services/sync/syncConfig.ts` - å·²ä½¿ç”¨æ–°çš„åŒæ­¥æœåŠ¡

### 4. åˆ é™¤æ—§æ–‡ä»¶
- âœ… **å·²åˆ é™¤**: `frontend/services/syncService.ts`

## ğŸ“‹ è¿ç§»å¯¹ç…§è¡¨

| æ—§API | æ–°API/å·¥å…· | çŠ¶æ€ |
|-------|-----------|------|
| `syncService.init()` | `initCustomSceneMappings()` | âœ… å·²è¿ç§» |
| `syncService.getWorldIdForSceneId()` | `getWorldIdForSceneId()` (ä» `utils/sceneMapping`) | âœ… å·²è¿ç§» |
| `syncService.saveCustomSceneMapping()` | `saveCustomSceneMapping()` (ä» `utils/sceneMapping`) | âœ… å·²è¿ç§» |
| `syncService.handleLocalDataChange()` | `syncService.handleLocalDataChange()` (æ–°çš„ SyncService) | âœ… å·²è¿ç§» |
| `syncService.syncData()` | `syncService.syncAllPendingEntities()` | âœ… å·²ç¦ç”¨ |
| `syncService.startPeriodicSync()` | `syncService.startAutoSync()` | âœ… å·²ç¦ç”¨ |

## ğŸ” éªŒè¯æ¸…å•

è¯·æ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š
- [ ] åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨
- [ ] åœºæ™¯æ˜ å°„åŠŸèƒ½æ­£å¸¸
- [ ] åŒæ­¥åŠŸèƒ½æ­£å¸¸ï¼ˆä¸å†é‡å¤åˆ›å»ºï¼‰
- [ ] æ²¡æœ‰æ§åˆ¶å°é”™è¯¯
- [ ] æ‰€æœ‰å¯¼å…¥è·¯å¾„æ­£ç¡®

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åœºæ™¯æ˜ å°„åˆå§‹åŒ–**: åº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆå§‹åŒ–åœºæ™¯æ˜ å°„
2. **å…¼å®¹æ€§**: æ–°çš„ `SyncService.handleLocalDataChange()` å®Œå…¨å…¼å®¹æ—§çš„API
3. **è‡ªåŠ¨åŒæ­¥**: æ–°çš„åŒæ­¥æœåŠ¡æ¯30ç§’è‡ªåŠ¨åŒæ­¥ä¸€æ¬¡å¾…åŒæ­¥çš„å®ä½“
4. **é˜²é‡å¤**: æ–°çš„åŒæ­¥æœåŠ¡å·²æ·»åŠ é˜²é‡å¤å¤„ç†æœºåˆ¶

## ğŸ› å¦‚æœå‡ºç°é—®é¢˜

### é—®é¢˜1: å¯¼å…¥é”™è¯¯
å¦‚æœå‡ºç° `Cannot find module './services/syncService'` é”™è¯¯ï¼š
- æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶æ˜¯å¦å·²æ›´æ–°å¯¼å…¥è·¯å¾„
- ç¡®ä¿ä½¿ç”¨ `from './services/sync/SyncService'` æˆ– `from '../services/sync/SyncService'`

### é—®é¢˜2: åœºæ™¯æ˜ å°„é”™è¯¯
å¦‚æœå‡ºç°åœºæ™¯æ˜ å°„ç›¸å…³é”™è¯¯ï¼š
- ç¡®ä¿ `frontend/utils/sceneMapping.ts` æ–‡ä»¶å­˜åœ¨
- ç¡®ä¿åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨äº† `initCustomSceneMappings()`

### é—®é¢˜3: åŒæ­¥åŠŸèƒ½å¼‚å¸¸
å¦‚æœåŒæ­¥åŠŸèƒ½å¼‚å¸¸ï¼š
- æ£€æŸ¥æ–°çš„ `SyncService` æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
- æ£€æŸ¥ `initSyncConfigs()` æ˜¯å¦å·²è°ƒç”¨
- æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤åŒæ­¥æœåŠ¡çŠ¶æ€

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

1. é€æ­¥å°† `handleLocalDataChange` çš„è°ƒç”¨è¿ç§»åˆ°æ–°çš„ `markEntityForSync + syncEntity` æ–¹å¼
2. è€ƒè™‘æ·»åŠ åŒæ­¥çŠ¶æ€çš„å¯è§†åŒ–æŒ‡ç¤ºå™¨
3. ä¼˜åŒ–åŒæ­¥é¢‘ç‡å’Œç­–ç•¥




