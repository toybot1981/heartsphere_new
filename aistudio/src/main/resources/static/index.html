<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent æµ‹è¯•å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 20px;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        /* å¯¹è¯ç•Œé¢æ ·å¼ */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .agent-selector {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .agent-selector select {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.assistant {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.assistant .message-content {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .chat-input button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        /* å¤šæ¨¡æ€æµ‹è¯•æ ·å¼ */
        .modal-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .modal-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 10px;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .result-box {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            min-height: 100px;
        }

        .result-image {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }

        .result-audio {
            margin-top: 10px;
        }

        .result-video {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }

        /* å·¥ä½œæµæµ‹è¯•æ ·å¼ */
        .workflow-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .workflow-type {
            margin-bottom: 20px;
        }

        .workflow-type label {
            display: block;
            margin-bottom: 10px;
            color: #666;
            font-weight: 500;
        }

        .workflow-type select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .workflow-input {
            margin-bottom: 15px;
        }

        .workflow-result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            max-height: 400px;
            overflow-y: auto;
        }

        .step-result {
            margin-bottom: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            font-size: 13px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– AI Agent æµ‹è¯•å¹³å°</h1>
            <p>åŸºäº Spring AI Alibaba çš„æ™ºèƒ½ Agent æµ‹è¯•</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('chat')">ğŸ’¬ å¯¹è¯æµ‹è¯•</button>
            <button class="tab" onclick="switchTab('multimodal')">ğŸ¨ å¤šæ¨¡æ€æµ‹è¯•</button>
            <button class="tab" onclick="switchTab('workflow')">âš™ï¸ å·¥ä½œæµæµ‹è¯•</button>
            <button class="tab" onclick="switchTab('amap')">ğŸ—ºï¸ é«˜å¾·åœ°å›¾æµ‹è¯•</button>
        </div>

        <!-- å¯¹è¯æµ‹è¯• -->
        <div id="chat-tab" class="tab-content active">
            <div class="chat-container">
                <div class="agent-selector">
                    <label>é€‰æ‹© Agent:</label>
                    <select id="agentSelect">
                        <option value="">åŠ è½½ä¸­...</option>
                    </select>
                    <button class="btn" onclick="loadAgents()">åˆ·æ–°</button>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div style="text-align: center; color: #999; padding: 40px;">
                        ğŸ‘‹ é€‰æ‹©ä¸€ä¸ª Agent å¼€å§‹å¯¹è¯
                    </div>
                </div>
                
                <div class="chat-input">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="è¾“å…¥æ¶ˆæ¯..." 
                        onkeypress="handleKeyPress(event)"
                        disabled
                    >
                    <button id="sendButton" onclick="sendMessage()" disabled>å‘é€</button>
                </div>
            </div>
        </div>

        <!-- å¤šæ¨¡æ€æµ‹è¯• -->
        <div id="multimodal-tab" class="tab-content">
            <!-- å›¾ç‰‡ç”Ÿæˆ -->
            <div class="modal-section">
                <h3>ğŸ–¼ï¸ å›¾ç‰‡ç”Ÿæˆ</h3>
                <div class="form-group">
                    <label>æç¤ºè¯ (Prompt):</label>
                    <textarea id="imagePrompt" placeholder="ä¾‹å¦‚ï¼šä¸€åªå¯çˆ±çš„å°çŒ«ååœ¨çª—å°ä¸Š"></textarea>
                </div>
                <button class="btn" onclick="generateImage()">ç”Ÿæˆå›¾ç‰‡</button>
                <div id="imageResult" class="result-box" style="display: none;">
                    <div class="loading"></div> æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...
                </div>
            </div>

            <!-- æ–‡æœ¬è½¬è¯­éŸ³ -->
            <div class="modal-section">
                <h3>ğŸ”Š æ–‡æœ¬è½¬è¯­éŸ³ (TTS)</h3>
                <div class="form-group">
                    <label>æ–‡æœ¬å†…å®¹:</label>
                    <textarea id="ttsText" placeholder="è¾“å…¥è¦è½¬æ¢ä¸ºè¯­éŸ³çš„æ–‡æœ¬"></textarea>
                </div>
                <button class="btn" onclick="textToSpeech()">è½¬æ¢ä¸ºè¯­éŸ³</button>
                <div id="ttsResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- è¯­éŸ³è½¬æ–‡æœ¬ -->
            <div class="modal-section">
                <h3>ğŸ¤ è¯­éŸ³è½¬æ–‡æœ¬ (STT)</h3>
                <div class="form-group">
                    <label>ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶:</label>
                    <input type="file" id="audioFile" accept="audio/*">
                </div>
                <button class="btn" onclick="speechToText()">è½¬æ¢ä¸ºæ–‡æœ¬</button>
                <div id="sttResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- è§†é¢‘ç”Ÿæˆ -->
            <div class="modal-section">
                <h3>ğŸ¬ è§†é¢‘ç”Ÿæˆ</h3>
                <div class="form-group">
                    <label>æç¤ºè¯ (Prompt):</label>
                    <textarea id="videoPrompt" placeholder="ä¾‹å¦‚ï¼šä¸€åªå°ç‹—åœ¨è‰åœ°ä¸Šå¥”è·‘"></textarea>
                </div>
                <button class="btn" onclick="generateVideo()">ç”Ÿæˆè§†é¢‘</button>
                <div id="videoResult" class="result-box" style="display: none;">
                    <div class="loading"></div> æ­£åœ¨ç”Ÿæˆè§†é¢‘...
                </div>
            </div>
        </div>

        <!-- é«˜å¾·åœ°å›¾æµ‹è¯• -->
        <div id="amap-tab" class="tab-content">
            <!-- åœ°ç†ç¼–ç  -->
            <div class="modal-section">
                <h3>ğŸ“ åœ°ç†ç¼–ç ï¼ˆåœ°å€è½¬åæ ‡ï¼‰</h3>
                <div class="form-group">
                    <label>åœ°å€:</label>
                    <input type="text" id="geocodeAddress" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬å¸‚æœé˜³åŒº">
                </div>
                <div class="form-group">
                    <label>åŸå¸‚ï¼ˆå¯é€‰ï¼‰:</label>
                    <input type="text" id="geocodeCity" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬">
                </div>
                <button class="btn" onclick="testGeocode()">æŸ¥è¯¢åæ ‡</button>
                <div id="geocodeResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- é€†åœ°ç†ç¼–ç  -->
            <div class="modal-section">
                <h3>ğŸ“ é€†åœ°ç†ç¼–ç ï¼ˆåæ ‡è½¬åœ°å€ï¼‰</h3>
                <div class="form-group">
                    <label>ç»åº¦:</label>
                    <input type="text" id="reverseLng" placeholder="ä¾‹å¦‚ï¼š116.397128">
                </div>
                <div class="form-group">
                    <label>çº¬åº¦:</label>
                    <input type="text" id="reverseLat" placeholder="ä¾‹å¦‚ï¼š39.916527">
                </div>
                <button class="btn" onclick="testReverseGeocode()">æŸ¥è¯¢åœ°å€</button>
                <div id="reverseGeocodeResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- è·¯å¾„è§„åˆ’ -->
            <div class="modal-section">
                <h3>ğŸš— è·¯å¾„è§„åˆ’</h3>
                <div class="form-group">
                    <label>èµ·ç‚¹åæ ‡ï¼ˆç»åº¦,çº¬åº¦ï¼‰:</label>
                    <input type="text" id="routeOrigin" placeholder="ä¾‹å¦‚ï¼š116.397128,39.916527">
                </div>
                <div class="form-group">
                    <label>ç»ˆç‚¹åæ ‡ï¼ˆç»åº¦,çº¬åº¦ï¼‰:</label>
                    <input type="text" id="routeDestination" placeholder="ä¾‹å¦‚ï¼š116.407526,39.904030">
                </div>
                <div class="form-group">
                    <label>ç­–ç•¥:</label>
                    <select id="routeStrategy">
                        <option value="0">é€Ÿåº¦ä¼˜å…ˆ</option>
                        <option value="1">è´¹ç”¨ä¼˜å…ˆ</option>
                        <option value="2">è·ç¦»ä¼˜å…ˆ</option>
                    </select>
                </div>
                <button class="btn" onclick="testRoutePlanning()">è§„åˆ’è·¯å¾„</button>
                <div id="routeResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- POI æœç´¢ -->
            <div class="modal-section">
                <h3>ğŸ” POI æœç´¢</h3>
                <div class="form-group">
                    <label>å…³é”®è¯:</label>
                    <input type="text" id="poiKeywords" placeholder="ä¾‹å¦‚ï¼šé¤å…">
                </div>
                <div class="form-group">
                    <label>åŸå¸‚ï¼ˆå¯é€‰ï¼‰:</label>
                    <input type="text" id="poiCity" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬">
                </div>
                <div class="form-group">
                    <label>ç±»å‹ï¼ˆå¯é€‰ï¼‰:</label>
                    <input type="text" id="poiTypes" placeholder="ä¾‹å¦‚ï¼šé¤é¥®æœåŠ¡">
                </div>
                <button class="btn" onclick="testPOISearch()">æœç´¢ POI</button>
                <div id="poiResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- å¤©æ°”æŸ¥è¯¢ -->
            <div class="modal-section">
                <h3>ğŸŒ¤ï¸ å¤©æ°”æŸ¥è¯¢</h3>
                <div class="form-group">
                    <label>åŸå¸‚:</label>
                    <input type="text" id="weatherCity" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬">
                </div>
                <button class="btn" onclick="testWeather()">æŸ¥è¯¢å¤©æ°”</button>
                <div id="weatherResult" class="result-box" style="display: none;"></div>
            </div>
        </div>

        <!-- é«˜å¾·åœ°å›¾æµ‹è¯• -->
        <div id="amap-tab" class="tab-content">
            <!-- åœ°ç†ç¼–ç  -->
            <div class="modal-section">
                <h3>ğŸ“ åœ°ç†ç¼–ç ï¼ˆåœ°å€è½¬åæ ‡ï¼‰</h3>
                <div class="form-group">
                    <label>åœ°å€:</label>
                    <input type="text" id="geocodeAddress" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬å¸‚æœé˜³åŒº">
                </div>
                <div class="form-group">
                    <label>åŸå¸‚ï¼ˆå¯é€‰ï¼‰:</label>
                    <input type="text" id="geocodeCity" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬">
                </div>
                <button class="btn" onclick="testGeocode()">æŸ¥è¯¢åæ ‡</button>
                <div id="geocodeResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- é€†åœ°ç†ç¼–ç  -->
            <div class="modal-section">
                <h3>ğŸ“ é€†åœ°ç†ç¼–ç ï¼ˆåæ ‡è½¬åœ°å€ï¼‰</h3>
                <div class="form-group">
                    <label>ç»åº¦:</label>
                    <input type="text" id="reverseLng" placeholder="ä¾‹å¦‚ï¼š116.397128">
                </div>
                <div class="form-group">
                    <label>çº¬åº¦:</label>
                    <input type="text" id="reverseLat" placeholder="ä¾‹å¦‚ï¼š39.916527">
                </div>
                <button class="btn" onclick="testReverseGeocode()">æŸ¥è¯¢åœ°å€</button>
                <div id="reverseGeocodeResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- è·¯å¾„è§„åˆ’ -->
            <div class="modal-section">
                <h3>ğŸš— è·¯å¾„è§„åˆ’</h3>
                <div class="form-group">
                    <label>èµ·ç‚¹åæ ‡ï¼ˆç»åº¦,çº¬åº¦ï¼‰:</label>
                    <input type="text" id="routeOrigin" placeholder="ä¾‹å¦‚ï¼š116.397128,39.916527">
                </div>
                <div class="form-group">
                    <label>ç»ˆç‚¹åæ ‡ï¼ˆç»åº¦,çº¬åº¦ï¼‰:</label>
                    <input type="text" id="routeDestination" placeholder="ä¾‹å¦‚ï¼š116.407526,39.904030">
                </div>
                <div class="form-group">
                    <label>ç­–ç•¥:</label>
                    <select id="routeStrategy">
                        <option value="0">é€Ÿåº¦ä¼˜å…ˆ</option>
                        <option value="1">è´¹ç”¨ä¼˜å…ˆ</option>
                        <option value="2">è·ç¦»ä¼˜å…ˆ</option>
                    </select>
                </div>
                <button class="btn" onclick="testRoutePlanning()">è§„åˆ’è·¯å¾„</button>
                <div id="routeResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- POI æœç´¢ -->
            <div class="modal-section">
                <h3>ğŸ” POI æœç´¢</h3>
                <div class="form-group">
                    <label>å…³é”®è¯:</label>
                    <input type="text" id="poiKeywords" placeholder="ä¾‹å¦‚ï¼šé¤å…">
                </div>
                <div class="form-group">
                    <label>åŸå¸‚ï¼ˆå¯é€‰ï¼‰:</label>
                    <input type="text" id="poiCity" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬">
                </div>
                <div class="form-group">
                    <label>ç±»å‹ï¼ˆå¯é€‰ï¼‰:</label>
                    <input type="text" id="poiTypes" placeholder="ä¾‹å¦‚ï¼šé¤é¥®æœåŠ¡">
                </div>
                <button class="btn" onclick="testPOISearch()">æœç´¢ POI</button>
                <div id="poiResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- å¤©æ°”æŸ¥è¯¢ -->
            <div class="modal-section">
                <h3>ğŸŒ¤ï¸ å¤©æ°”æŸ¥è¯¢</h3>
                <div class="form-group">
                    <label>åŸå¸‚:</label>
                    <input type="text" id="weatherCity" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬">
                </div>
                <button class="btn" onclick="testWeather()">æŸ¥è¯¢å¤©æ°”</button>
                <div id="weatherResult" class="result-box" style="display: none;"></div>
            </div>
        </div>

        <!-- å·¥ä½œæµæµ‹è¯• -->
        <div id="workflow-tab" class="tab-content">
            <div class="workflow-section">
                <div class="workflow-type">
                    <label>é€‰æ‹© Agent:</label>
                    <select id="workflowAgentSelect">
                        <option value="">åŠ è½½ä¸­...</option>
                    </select>
                </div>
                
                <div class="workflow-type">
                    <label>å·¥ä½œæµç±»å‹:</label>
                    <select id="workflowType">
                        <option value="sequential">é¡ºåºå·¥ä½œæµ (Sequential)</option>
                        <option value="parallel">å¹¶è¡Œå·¥ä½œæµ (Parallel)</option>
                        <option value="routing">è·¯ç”±å·¥ä½œæµ (Routing)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>è¾“å…¥æ•°æ® (JSON æ ¼å¼):</label>
                    <textarea id="workflowInput" placeholder='{"input": "æµ‹è¯•æ•°æ®"}'>{}</textarea>
                </div>

                <button class="btn" onclick="executeWorkflow()">æ‰§è¡Œå·¥ä½œæµ</button>
                
                <div id="workflowResult" class="workflow-result" style="display: none;">
                    <h4>æ‰§è¡Œç»“æœ:</h4>
                    <div id="workflowResultContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8082/api';
        let currentAgentId = '';

        // é¡µé¢åŠ è½½
        window.onload = function() {
            loadAgents();
            loadWorkflowAgents();
        };

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // åŠ è½½ Agent åˆ—è¡¨
        async function loadAgents() {
            try {
                const response = await fetch(`${API_BASE}/agents`);
                const agents = await response.json();
                
                const select = document.getElementById('agentSelect');
                select.innerHTML = '<option value="">è¯·é€‰æ‹© Agent...</option>';
                
                agents.forEach(agent => {
                    const option = document.createElement('option');
                    option.value = agent.id;
                    option.textContent = `${agent.name} (${agent.id})`;
                    select.appendChild(option);
                });
                
                if (agents.length > 0) {
                    select.disabled = false;
                    document.getElementById('messageInput').disabled = false;
                    document.getElementById('sendButton').disabled = false;
                }
            } catch (error) {
                console.error('åŠ è½½ Agent åˆ—è¡¨å¤±è´¥:', error);
            }
        }

        // åŠ è½½å·¥ä½œæµ Agent åˆ—è¡¨
        async function loadWorkflowAgents() {
            try {
                const response = await fetch(`${API_BASE}/agents`);
                const agents = await response.json();
                
                const select = document.getElementById('workflowAgentSelect');
                select.innerHTML = '<option value="">è¯·é€‰æ‹© Agent...</option>';
                
                agents.forEach(agent => {
                    const option = document.createElement('option');
                    option.value = agent.id;
                    option.textContent = `${agent.name} (${agent.id})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('åŠ è½½ Agent åˆ—è¡¨å¤±è´¥:', error);
            }
        }

        // Agent é€‰æ‹©å˜åŒ–
        document.getElementById('agentSelect').addEventListener('change', function(e) {
            currentAgentId = e.target.value;
            if (currentAgentId) {
                clearMessages();
                addSystemMessage(`å·²åˆ‡æ¢åˆ° Agent: ${e.target.options[e.target.selectedIndex].textContent}`);
            }
        });

        // å¤„ç†å›è½¦é”®
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || !currentAgentId) return;
            
            input.value = '';
            addMessage('user', message);
            
            const loadingId = addMessage('assistant', '<div class="loading"></div> æ­£åœ¨æ€è€ƒ...', true);
            
            try {
                const response = await fetch(`${API_BASE}/agents/${currentAgentId}/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ input: message })
                });
                
                const data = await response.json();
                removeMessage(loadingId);
                
                if (data.success) {
                    const result = data.result;
                    const results = result.results || [];
                    
                    if (results.length > 0) {
                        const output = results[0].output || {};
                        const text = output.text || 'æ²¡æœ‰è¿”å›å†…å®¹';
                        const usage = result.metadata?.usage || {};
                        addMessage('assistant', text, false, usage);
                    } else {
                        addMessage('assistant', 'âŒ æ²¡æœ‰æ”¶åˆ°å›å¤', true);
                    }
                } else {
                    addMessage('assistant', `âŒ é”™è¯¯: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, true);
                }
            } catch (error) {
                removeMessage(loadingId);
                addMessage('assistant', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, true);
            }
        }

        // æ·»åŠ æ¶ˆæ¯
        function addMessage(role, content, isError = false, usage = null) {
            const messagesDiv = document.getElementById('chatMessages');
            const emptyState = messagesDiv.querySelector('.empty-state');
            if (emptyState) emptyState.remove();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.id = `msg-${Date.now()}-${Math.random()}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            if (isError) contentDiv.classList.add('error-message');
            contentDiv.innerHTML = content;
            
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            return messageDiv.id;
        }

        function addSystemMessage(message) {
            addMessage('assistant', `â„¹ï¸ ${message}`, false);
        }

        function removeMessage(messageId) {
            const message = document.getElementById(messageId);
            if (message) message.remove();
        }

        function clearMessages() {
            document.getElementById('chatMessages').innerHTML = '';
        }

        // ç”Ÿæˆå›¾ç‰‡
        async function generateImage() {
            const prompt = document.getElementById('imagePrompt').value.trim();
            if (!prompt) {
                alert('è¯·è¾“å…¥æç¤ºè¯');
                return;
            }

            const resultDiv = document.getElementById('imageResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...';

            try {
                const response = await fetch(`${API_BASE}/multimodal/image/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt, options: {} })
                });

                const data = await response.json();
                if (data.success && data.imageUrl) {
                    resultDiv.innerHTML = `
                        <strong>ç”ŸæˆæˆåŠŸï¼</strong>
                        <img src="${data.imageUrl}" alt="ç”Ÿæˆçš„å›¾ç‰‡" class="result-image">
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ ç”Ÿæˆå¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ–‡æœ¬è½¬è¯­éŸ³
        async function textToSpeech() {
            const text = document.getElementById('ttsText').value.trim();
            if (!text) {
                alert('è¯·è¾“å…¥æ–‡æœ¬å†…å®¹');
                return;
            }

            const resultDiv = document.getElementById('ttsResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨è½¬æ¢...';

            try {
                const response = await fetch(`${API_BASE}/multimodal/audio/tts`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, options: {} })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    resultDiv.innerHTML = `
                        <strong>è½¬æ¢æˆåŠŸï¼</strong>
                        <audio controls class="result-audio">
                            <source src="${url}" type="audio/wav">
                        </audio>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ è½¬æ¢å¤±è´¥</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // è¯­éŸ³è½¬æ–‡æœ¬
        async function speechToText() {
            const fileInput = document.getElementById('audioFile');
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶');
                return;
            }

            const resultDiv = document.getElementById('sttResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨è½¬æ¢...';

            try {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                formData.append('model', 'paraformer-v2');

                const response = await fetch(`${API_BASE}/multimodal/audio/stt`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.success) {
                    resultDiv.innerHTML = `
                        <strong>è½¬æ¢æˆåŠŸï¼</strong>
                        <p>${data.text}</p>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ è½¬æ¢å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // ç”Ÿæˆè§†é¢‘
        async function generateVideo() {
            const prompt = document.getElementById('videoPrompt').value.trim();
            if (!prompt) {
                alert('è¯·è¾“å…¥æç¤ºè¯');
                return;
            }

            const resultDiv = document.getElementById('videoResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨ç”Ÿæˆè§†é¢‘...';

            try {
                const response = await fetch(`${API_BASE}/multimodal/video/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt, options: {} })
                });

                const data = await response.json();
                if (data.success && data.videoUrl) {
                    resultDiv.innerHTML = `
                        <strong>ç”ŸæˆæˆåŠŸï¼</strong>
                        <video controls class="result-video">
                            <source src="${data.videoUrl}" type="video/mp4">
                        </video>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ ç”Ÿæˆå¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // é«˜å¾·åœ°å›¾æµ‹è¯•å‡½æ•°
        async function testGeocode() {
            const address = document.getElementById('geocodeAddress').value.trim();
            if (!address) {
                alert('è¯·è¾“å…¥åœ°å€');
                return;
            }
            
            const city = document.getElementById('geocodeCity').value.trim();
            const resultDiv = document.getElementById('geocodeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æŸ¥è¯¢...';
            
            try {
                const response = await fetch(`${API_BASE}/amap/geocode`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address, city: city || null })
                });
                
                const data = await response.json();
                if (data.success) {
                    const geocodes = data.data?.geocodes || [];
                    if (geocodes.length > 0) {
                        const location = geocodes[0].location;
                        resultDiv.innerHTML = `
                            <strong>æŸ¥è¯¢æˆåŠŸï¼</strong><br>
                            <strong>åæ ‡:</strong> ${location}<br>
                            <strong>è¯¦ç»†åœ°å€:</strong> ${geocodes[0].formatted_address || address}
                        `;
                    } else {
                        resultDiv.innerHTML = '<div class="error-message">æœªæ‰¾åˆ°ç»“æœ</div>';
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ æŸ¥è¯¢å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testReverseGeocode() {
            const lng = document.getElementById('reverseLng').value.trim();
            const lat = document.getElementById('reverseLat').value.trim();
            if (!lng || !lat) {
                alert('è¯·è¾“å…¥ç»çº¬åº¦');
                return;
            }
            
            const resultDiv = document.getElementById('reverseGeocodeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æŸ¥è¯¢...';
            
            try {
                const response = await fetch(`${API_BASE}/amap/reverse-geocode`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ longitude: lng, latitude: lat })
                });
                
                const data = await response.json();
                if (data.success) {
                    const regeocode = data.data?.regeocode || {};
                    resultDiv.innerHTML = `
                        <strong>æŸ¥è¯¢æˆåŠŸï¼</strong><br>
                        <strong>åœ°å€:</strong> ${regeocode.formatted_address || 'æœªçŸ¥'}<br>
                        <strong>çœä»½:</strong> ${regeocode.addressComponent?.province || ''}<br>
                        <strong>åŸå¸‚:</strong> ${regeocode.addressComponent?.city || ''}<br>
                        <strong>åŒºå¿:</strong> ${regeocode.addressComponent?.district || ''}
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ æŸ¥è¯¢å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testRoutePlanning() {
            const origin = document.getElementById('routeOrigin').value.trim();
            const destination = document.getElementById('routeDestination').value.trim();
            const strategy = document.getElementById('routeStrategy').value;
            
            if (!origin || !destination) {
                alert('è¯·è¾“å…¥èµ·ç‚¹å’Œç»ˆç‚¹åæ ‡');
                return;
            }
            
            const resultDiv = document.getElementById('routeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨è§„åˆ’è·¯å¾„...';
            
            try {
                const response = await fetch(`${API_BASE}/amap/route`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ origin, destination, strategy })
                });
                
                const data = await response.json();
                if (data.success) {
                    const route = data.data?.route || {};
                    const paths = route.paths || [];
                    if (paths.length > 0) {
                        const path = paths[0];
                        resultDiv.innerHTML = `
                            <strong>è·¯å¾„è§„åˆ’æˆåŠŸï¼</strong><br>
                            <strong>è·ç¦»:</strong> ${(path.distance / 1000).toFixed(2)} å…¬é‡Œ<br>
                            <strong>é¢„è®¡æ—¶é—´:</strong> ${Math.round(path.duration / 60)} åˆ†é’Ÿ<br>
                            <strong>æ”¶è´¹:</strong> ${path.tolls || 0} å…ƒ<br>
                            <strong>ç­–ç•¥:</strong> ${strategy === '0' ? 'é€Ÿåº¦ä¼˜å…ˆ' : strategy === '1' ? 'è´¹ç”¨ä¼˜å…ˆ' : 'è·ç¦»ä¼˜å…ˆ'}
                        `;
                    } else {
                        resultDiv.innerHTML = '<div class="error-message">æœªæ‰¾åˆ°è·¯å¾„</div>';
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ è§„åˆ’å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testPOISearch() {
            const keywords = document.getElementById('poiKeywords').value.trim();
            if (!keywords) {
                alert('è¯·è¾“å…¥å…³é”®è¯');
                return;
            }
            
            const city = document.getElementById('poiCity').value.trim();
            const types = document.getElementById('poiTypes').value.trim();
            const resultDiv = document.getElementById('poiResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æœç´¢...';
            
            try {
                const response = await fetch(`${API_BASE}/amap/poi/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        keywords, 
                        city: city || null, 
                        types: types || null,
                        page: 1,
                        offset: 10
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    const pois = data.data?.pois || [];
                    if (pois.length > 0) {
                        let html = `<strong>æ‰¾åˆ° ${pois.length} ä¸ªç»“æœ:</strong><br>`;
                        pois.slice(0, 5).forEach(poi => {
                            html += `
                                <div style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
                                    <strong>${poi.name}</strong><br>
                                    <small>åœ°å€: ${poi.address || 'æœªçŸ¥'}</small><br>
                                    <small>åæ ‡: ${poi.location || 'æœªçŸ¥'}</small>
                                </div>
                            `;
                        });
                        resultDiv.innerHTML = html;
                    } else {
                        resultDiv.innerHTML = '<div class="error-message">æœªæ‰¾åˆ°ç»“æœ</div>';
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ æœç´¢å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testWeather() {
            const city = document.getElementById('weatherCity').value.trim();
            if (!city) {
                alert('è¯·è¾“å…¥åŸå¸‚åç§°');
                return;
            }
            
            const resultDiv = document.getElementById('weatherResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æŸ¥è¯¢...';
            
            try {
                const response = await fetch(`${API_BASE}/amap/weather`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ city })
                });
                
                const data = await response.json();
                if (data.success) {
                    const lives = data.data?.lives || [];
                    if (lives.length > 0) {
                        const weather = lives[0];
                        resultDiv.innerHTML = `
                            <strong>${weather.city} å¤©æ°”</strong><br>
                            <strong>å¤©æ°”:</strong> ${weather.weather}<br>
                            <strong>æ¸©åº¦:</strong> ${weather.temperature}Â°C<br>
                            <strong>é£å‘:</strong> ${weather.winddirection}<br>
                            <strong>é£åŠ›:</strong> ${weather.windpower}çº§<br>
                            <strong>æ¹¿åº¦:</strong> ${weather.humidity}%
                        `;
                    } else {
                        resultDiv.innerHTML = '<div class="error-message">æœªæ‰¾åˆ°å¤©æ°”ä¿¡æ¯</div>';
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ æŸ¥è¯¢å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // é«˜å¾·åœ°å›¾æµ‹è¯•å‡½æ•°
        async function testGeocode() {
            const address = document.getElementById('geocodeAddress').value.trim();
            if (!address) {
                alert('è¯·è¾“å…¥åœ°å€');
                return;
            }
            
            const city = document.getElementById('geocodeCity').value.trim();
            const resultDiv = document.getElementById('geocodeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æŸ¥è¯¢...';
            
            try {
                const response = await fetch(`${API_BASE}/amap/geocode`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address, city: city || null })
                });
                
                const data = await response.json();
                if (data.success) {
                    const geocodes = data.data?.geocodes || [];
                    if (geocodes.length > 0) {
                        const location = geocodes[0].location;
                        resultDiv.innerHTML = `
                            <strong>æŸ¥è¯¢æˆåŠŸï¼</strong><br>
                            <strong>åæ ‡:</strong> ${location}<br>
                            <strong>è¯¦ç»†åœ°å€:</strong> ${geocodes[0].formatted_address || address}
                        `;
                    } else {
                        resultDiv.innerHTML = '<div class="error-message">æœªæ‰¾åˆ°ç»“æœ</div>';
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ æŸ¥è¯¢å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testReverseGeocode() {
            const lng = document.getElementById('reverseLng').value.trim();
            const lat = document.getElementById('reverseLat').value.trim();
            if (!lng || !lat) {
                alert('è¯·è¾“å…¥ç»çº¬åº¦');
                return;
            }
            
            const resultDiv = document.getElementById('reverseGeocodeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æŸ¥è¯¢...';
            
            try {
                const response = await fetch(`${API_BASE}/amap/reverse-geocode`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ longitude: lng, latitude: lat })
                });
                
                const data = await response.json();
                if (data.success) {
                    const regeocode = data.data?.regeocode || {};
                    resultDiv.innerHTML = `
                        <strong>æŸ¥è¯¢æˆåŠŸï¼</strong><br>
                        <strong>åœ°å€:</strong> ${regeocode.formatted_address || 'æœªçŸ¥'}<br>
                        <strong>çœä»½:</strong> ${regeocode.addressComponent?.province || ''}<br>
                        <strong>åŸå¸‚:</strong> ${regeocode.addressComponent?.city || ''}<br>
                        <strong>åŒºå¿:</strong> ${regeocode.addressComponent?.district || ''}
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ æŸ¥è¯¢å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testRoutePlanning() {
            const origin = document.getElementById('routeOrigin').value.trim();
            const destination = document.getElementById('routeDestination').value.trim();
            const strategy = document.getElementById('routeStrategy').value;
            
            if (!origin || !destination) {
                alert('è¯·è¾“å…¥èµ·ç‚¹å’Œç»ˆç‚¹åæ ‡');
                return;
            }
            
            const resultDiv = document.getElementById('routeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨è§„åˆ’è·¯å¾„...';
            
            try {
                const response = await fetch(`${API_BASE}/amap/route`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ origin, destination, strategy })
                });
                
                const data = await response.json();
                if (data.success) {
                    const route = data.data?.route || {};
                    const paths = route.paths || [];
                    if (paths.length > 0) {
                        const path = paths[0];
                        resultDiv.innerHTML = `
                            <strong>è·¯å¾„è§„åˆ’æˆåŠŸï¼</strong><br>
                            <strong>è·ç¦»:</strong> ${(path.distance / 1000).toFixed(2)} å…¬é‡Œ<br>
                            <strong>é¢„è®¡æ—¶é—´:</strong> ${Math.round(path.duration / 60)} åˆ†é’Ÿ<br>
                            <strong>æ”¶è´¹:</strong> ${path.tolls || 0} å…ƒ<br>
                            <strong>ç­–ç•¥:</strong> ${strategy === '0' ? 'é€Ÿåº¦ä¼˜å…ˆ' : strategy === '1' ? 'è´¹ç”¨ä¼˜å…ˆ' : 'è·ç¦»ä¼˜å…ˆ'}
                        `;
                    } else {
                        resultDiv.innerHTML = '<div class="error-message">æœªæ‰¾åˆ°è·¯å¾„</div>';
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ è§„åˆ’å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testPOISearch() {
            const keywords = document.getElementById('poiKeywords').value.trim();
            if (!keywords) {
                alert('è¯·è¾“å…¥å…³é”®è¯');
                return;
            }
            
            const city = document.getElementById('poiCity').value.trim();
            const types = document.getElementById('poiTypes').value.trim();
            const resultDiv = document.getElementById('poiResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æœç´¢...';
            
            try {
                const response = await fetch(`${API_BASE}/amap/poi/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        keywords, 
                        city: city || null, 
                        types: types || null,
                        page: 1,
                        offset: 10
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    const pois = data.data?.pois || [];
                    if (pois.length > 0) {
                        let html = `<strong>æ‰¾åˆ° ${pois.length} ä¸ªç»“æœ:</strong><br>`;
                        pois.slice(0, 5).forEach(poi => {
                            html += `
                                <div style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
                                    <strong>${poi.name}</strong><br>
                                    <small>åœ°å€: ${poi.address || 'æœªçŸ¥'}</small><br>
                                    <small>åæ ‡: ${poi.location || 'æœªçŸ¥'}</small>
                                </div>
                            `;
                        });
                        resultDiv.innerHTML = html;
                    } else {
                        resultDiv.innerHTML = '<div class="error-message">æœªæ‰¾åˆ°ç»“æœ</div>';
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ æœç´¢å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        async function testWeather() {
            const city = document.getElementById('weatherCity').value.trim();
            if (!city) {
                alert('è¯·è¾“å…¥åŸå¸‚åç§°');
                return;
            }
            
            const resultDiv = document.getElementById('weatherResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æŸ¥è¯¢...';
            
            try {
                const response = await fetch(`${API_BASE}/amap/weather`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ city })
                });
                
                const data = await response.json();
                if (data.success) {
                    const lives = data.data?.lives || [];
                    if (lives.length > 0) {
                        const weather = lives[0];
                        resultDiv.innerHTML = `
                            <strong>${weather.city} å¤©æ°”</strong><br>
                            <strong>å¤©æ°”:</strong> ${weather.weather}<br>
                            <strong>æ¸©åº¦:</strong> ${weather.temperature}Â°C<br>
                            <strong>é£å‘:</strong> ${weather.winddirection}<br>
                            <strong>é£åŠ›:</strong> ${weather.windpower}çº§<br>
                            <strong>æ¹¿åº¦:</strong> ${weather.humidity}%
                        `;
                    } else {
                        resultDiv.innerHTML = '<div class="error-message">æœªæ‰¾åˆ°å¤©æ°”ä¿¡æ¯</div>';
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error-message">âŒ æŸ¥è¯¢å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ‰§è¡Œå·¥ä½œæµ
        async function executeWorkflow() {
            const agentId = document.getElementById('workflowAgentSelect').value;
            const workflowType = document.getElementById('workflowType').value;
            const inputText = document.getElementById('workflowInput').value.trim();

            if (!agentId) {
                alert('è¯·é€‰æ‹© Agent');
                return;
            }

            let input;
            try {
                input = JSON.parse(inputText || '{}');
            } catch (e) {
                alert('è¾“å…¥æ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ JSON');
                return;
            }

            const resultDiv = document.getElementById('workflowResult');
            const contentDiv = document.getElementById('workflowResultContent');
            resultDiv.style.display = 'block';
            contentDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æ‰§è¡Œå·¥ä½œæµ...';

            try {
                const response = await fetch(`${API_BASE}/workflows/${workflowType}/${agentId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ input })
                });

                const data = await response.json();
                if (data.success && data.result) {
                    const result = data.result;
                    let html = `
                        <div style="margin-bottom: 15px;">
                            <strong>å·¥ä½œæµç±»å‹:</strong> ${result.workflowType}<br>
                            <strong>æ‰§è¡ŒçŠ¶æ€:</strong> ${result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}<br>
                            ${result.error ? `<strong>é”™è¯¯:</strong> ${result.error}<br>` : ''}
                        </div>
                    `;

                    if (result.stepResults && Object.keys(result.stepResults).length > 0) {
                        html += '<strong>æ­¥éª¤ç»“æœ:</strong><br>';
                        for (const [stepId, stepResult] of Object.entries(result.stepResults)) {
                            html += `
                                <div class="step-result">
                                    <strong>${stepId}:</strong> ${JSON.stringify(stepResult, null, 2)}
                                </div>
                            `;
                        }
                    }

                    if (result.finalResult) {
                        html += `
                            <div style="margin-top: 15px;">
                                <strong>æœ€ç»ˆç»“æœ:</strong>
                                <pre style="background: #f0f0f0; padding: 10px; border-radius: 5px; overflow-x: auto;">
${JSON.stringify(result.finalResult, null, 2)}
                                </pre>
                            </div>
                        `;
                    }

                    contentDiv.innerHTML = html;
                } else {
                    contentDiv.innerHTML = `<div class="error-message">âŒ æ‰§è¡Œå¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                contentDiv.innerHTML = `<div class="error-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
